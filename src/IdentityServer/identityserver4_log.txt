2019-08-29 14:45:15.062 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 14:45:15.102 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 14:45:15.102 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 14:45:15.102 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 14:45:15.102 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 14:45:15.102 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 14:45:15.102 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 14:45:15.224 +08:00 [DBG] Starting grant removal
2019-08-29 14:45:15.462 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 14:45:15.463 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 14:45:15.463 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 14:45:15.463 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 14:45:15.463 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 14:45:15.463 +08:00 [DBG] Error Url: /home/error
2019-08-29 14:45:15.463 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 14:45:20.892 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 14:45:20.896 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 14:45:20.897 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 14:45:20.900 +08:00 [DBG] Start discovery request
2019-08-29 14:45:21.240 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 14:45:21.321 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 14:45:21.321 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 14:45:21.321 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 14:45:21.324 +08:00 [DBG] Start key discovery request
2019-08-29 14:45:21.360 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-29 14:45:21.362 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-29 14:45:21.362 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-29 14:45:21.369 +08:00 [DBG] Processing signout request for 8e579f4d-024f-480d-a06a-f807ff73e60f
2019-08-29 14:45:21.374 +08:00 [DBG] Start end session request validation
2019-08-29 14:45:21.379 +08:00 [DBG] Start identity token validation
2019-08-29 14:45:21.601 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:21.609 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:21.609 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-29 14:45:21.645 +08:00 [WRN] No user found matching subject Id: 8e579f4d-024f-480d-a06a-f807ff73e60f
2019-08-29 14:45:21.647 +08:00 [ERR] User marked as not active: 8e579f4d-024f-480d-a06a-f807ff73e60f
2019-08-29 14:45:21.656 +08:00 [INF] End session request validation failure: Error validating id token hint
{"ClientId":null,"ClientName":null,"SubjectId":"unknown","PostLogOutUri":null,"State":null,"Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofPb_weCDEzT6JNac9MnjDUBMVqBTCa9OUxbItp6YG4Kv9AX50yMH1TAgVLjKjQNCgfSFQABhq2Dd9yE_dUTdknIr7w0tpH7D_2lnI1pXF3YTbNH7VZPd5pUyA4nBBu23FLHUUmxaydjDhYiTmha6Dis","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-29 14:45:21.661 +08:00 [ERR] Error processing end session request Invalid request
2019-08-29 14:45:22.509 +08:00 [DBG] CORS request made for path: /Account/Logout from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 14:45:22.547 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-29 14:45:22.548 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-29 14:45:22.548 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-29 14:45:22.554 +08:00 [INF] {"SubjectId":"8e579f4d-024f-480d-a06a-f807ff73e60f","DisplayName":"Alice Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLPC9HPF18NU:00000007","TimeStamp":"2019-08-29T06:45:22.0000000Z","ProcessId":16364,"LocalIpAddress":"127.0.0.1:44753","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-29 14:45:22.595 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-29 14:45:22.597 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-29 14:45:22.597 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-29 14:45:22.601 +08:00 [DBG] Processing signout callback request
2019-08-29 14:45:22.614 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 14:45:22.614 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 14:45:22.617 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:22.617 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:22.617 +08:00 [DBG] No client front-channel logout URLs
2019-08-29 14:45:22.617 +08:00 [DBG] No client back-channel logout URLs
2019-08-29 14:45:22.617 +08:00 [INF] Successful signout callback.
2019-08-29 14:45:22.617 +08:00 [DBG] No client front-channel iframe urls
2019-08-29 14:45:22.617 +08:00 [DBG] No client back-channel iframe urls
2019-08-29 14:45:27.338 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 14:45:27.341 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 14:45:27.341 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 14:45:27.344 +08:00 [DBG] Start authorize request
2019-08-29 14:45:27.348 +08:00 [DBG] No user present in authorize request
2019-08-29 14:45:27.352 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:27.357 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:27.357 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:27.368 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 14:45:27.369 +08:00 [DBG] No PKCE used.
2019-08-29 14:45:27.409 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:27.536 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:27.546 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:27.549 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:27.556 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:27.558 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOKhw1q3CN6fIi73tLUFFxd4_kvV_dCHrFmJWqzRjzZ1Zgbw-P5I_VrW9CGd4Gf453d_C4AszPUQ1_VWLhqwAw7V0OTrW1bMIerNrCmAIhMmQmu_ZaWdcSmGxfbfCIrAROJpReKp0SSft7sXLHAT35Es7Q6eOO5VDc9DdojlMNR7bdT2TU3OKhMKPXWLTHLhROPeYRpI0vvSh2QBsEgqzLxqAjWmBINGbAjRQgYJG91qrFP_xCBcWhTX-nIZQtbfpHt4mRolB4PLmfEjJu4uQkJPmgmfJZpEdN20aPZPFfQDEx4moLgn2GcDqnzA2CfyuE","UiLocales":null,"Nonce":"637026579273324336.Y2Q5ZGIwNmItZDdhOC00NzViLTlmZGYtZjM2OTM2YWE1Zjc2NzY0YTA5ODYtZGU2ZS00ZDk3LTlhNmEtNGEzYjYwYjRiNmU0","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026579273324336.Y2Q5ZGIwNmItZDdhOC00NzViLTlmZGYtZjM2OTM2YWE1Zjc2NzY0YTA5ODYtZGU2ZS00ZDk3LTlhNmEtNGEzYjYwYjRiNmU0","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofOKhw1q3CN6fIi73tLUFFxd4_kvV_dCHrFmJWqzRjzZ1Zgbw-P5I_VrW9CGd4Gf453d_C4AszPUQ1_VWLhqwAw7V0OTrW1bMIerNrCmAIhMmQmu_ZaWdcSmGxfbfCIrAROJpReKp0SSft7sXLHAT35Es7Q6eOO5VDc9DdojlMNR7bdT2TU3OKhMKPXWLTHLhROPeYRpI0vvSh2QBsEgqzLxqAjWmBINGbAjRQgYJG91qrFP_xCBcWhTX-nIZQtbfpHt4mRolB4PLmfEjJu4uQkJPmgmfJZpEdN20aPZPFfQDEx4moLgn2GcDqnzA2CfyuE","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 14:45:27.565 +08:00 [INF] Showing login: User is not authenticated
2019-08-29 14:45:27.588 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:27.593 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:27.593 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:27.593 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 14:45:27.593 +08:00 [DBG] No PKCE used.
2019-08-29 14:45:27.594 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:27.597 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:27.598 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:27.600 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:27.600 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:27.604 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:27.604 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:32.945 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 14:45:32.960 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:32.964 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:32.964 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:32.964 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 14:45:32.964 +08:00 [DBG] No PKCE used.
2019-08-29 14:45:32.966 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:32.969 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:32.970 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:32.972 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:32.972 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:33.089 +08:00 [DBG] Augmenting SignInContext
2019-08-29 14:45:33.092 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 14:45:33.092 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 14:45:33.092 +08:00 [DBG] Adding auth_time claim with value: 1567061133
2019-08-29 14:45:33.097 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 14:45:33.101 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","DisplayName":"alice","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPC9HPF18NU:0000000B","TimeStamp":"2019-08-29T06:45:33.0000000Z","ProcessId":16364,"LocalIpAddress":"127.0.0.1:44753","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 14:45:33.104 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:33.104 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:33.120 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 14:45:33.121 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 14:45:33.121 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 14:45:33.127 +08:00 [DBG] Start authorize callback request
2019-08-29 14:45:33.129 +08:00 [DBG] User in authorize request: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 14:45:33.129 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:33.132 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:33.133 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:33.133 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 14:45:33.133 +08:00 [DBG] No PKCE used.
2019-08-29 14:45:33.134 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:33.137 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:33.138 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:33.140 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:33.141 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:33.141 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOKhw1q3CN6fIi73tLUFFxd4_kvV_dCHrFmJWqzRjzZ1Zgbw-P5I_VrW9CGd4Gf453d_C4AszPUQ1_VWLhqwAw7V0OTrW1bMIerNrCmAIhMmQmu_ZaWdcSmGxfbfCIrAROJpReKp0SSft7sXLHAT35Es7Q6eOO5VDc9DdojlMNR7bdT2TU3OKhMKPXWLTHLhROPeYRpI0vvSh2QBsEgqzLxqAjWmBINGbAjRQgYJG91qrFP_xCBcWhTX-nIZQtbfpHt4mRolB4PLmfEjJu4uQkJPmgmfJZpEdN20aPZPFfQDEx4moLgn2GcDqnzA2CfyuE","UiLocales":null,"Nonce":"637026579273324336.Y2Q5ZGIwNmItZDdhOC00NzViLTlmZGYtZjM2OTM2YWE1Zjc2NzY0YTA5ODYtZGU2ZS00ZDk3LTlhNmEtNGEzYjYwYjRiNmU0","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"84d44bf45acd4818a2c5954ed386dd27","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026579273324336.Y2Q5ZGIwNmItZDdhOC00NzViLTlmZGYtZjM2OTM2YWE1Zjc2NzY0YTA5ODYtZGU2ZS00ZDk3LTlhNmEtNGEzYjYwYjRiNmU0","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofOKhw1q3CN6fIi73tLUFFxd4_kvV_dCHrFmJWqzRjzZ1Zgbw-P5I_VrW9CGd4Gf453d_C4AszPUQ1_VWLhqwAw7V0OTrW1bMIerNrCmAIhMmQmu_ZaWdcSmGxfbfCIrAROJpReKp0SSft7sXLHAT35Es7Q6eOO5VDc9DdojlMNR7bdT2TU3OKhMKPXWLTHLhROPeYRpI0vvSh2QBsEgqzLxqAjWmBINGbAjRQgYJG91qrFP_xCBcWhTX-nIZQtbfpHt4mRolB4PLmfEjJu4uQkJPmgmfJZpEdN20aPZPFfQDEx4moLgn2GcDqnzA2CfyuE","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 14:45:33.152 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 14:45:33.153 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 14:45:33.174 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:33.178 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:33.178 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:33.179 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 14:45:33.179 +08:00 [DBG] No PKCE used.
2019-08-29 14:45:33.180 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:33.182 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:33.184 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:33.186 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:33.186 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:33.189 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:33.189 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:33.195 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:33.263 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:34.928 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 14:45:34.941 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:34.944 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:34.944 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:34.944 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 14:45:34.945 +08:00 [DBG] No PKCE used.
2019-08-29 14:45:34.946 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:34.948 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:34.949 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:34.951 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:34.951 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:34.952 +08:00 [INF] {"SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPC9HPF18NU:0000000E","TimeStamp":"2019-08-29T06:45:34.0000000Z","ProcessId":16364,"LocalIpAddress":"127.0.0.1:44753","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 14:45:34.967 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:34.967 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:34.973 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 14:45:34.974 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 14:45:34.974 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 14:45:34.974 +08:00 [DBG] Start authorize callback request
2019-08-29 14:45:34.976 +08:00 [DBG] User in authorize request: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 14:45:34.976 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:34.979 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:34.980 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:34.980 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 14:45:34.980 +08:00 [DBG] No PKCE used.
2019-08-29 14:45:34.981 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:34.984 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:34.985 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:34.987 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:34.987 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:34.987 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOKhw1q3CN6fIi73tLUFFxd4_kvV_dCHrFmJWqzRjzZ1Zgbw-P5I_VrW9CGd4Gf453d_C4AszPUQ1_VWLhqwAw7V0OTrW1bMIerNrCmAIhMmQmu_ZaWdcSmGxfbfCIrAROJpReKp0SSft7sXLHAT35Es7Q6eOO5VDc9DdojlMNR7bdT2TU3OKhMKPXWLTHLhROPeYRpI0vvSh2QBsEgqzLxqAjWmBINGbAjRQgYJG91qrFP_xCBcWhTX-nIZQtbfpHt4mRolB4PLmfEjJu4uQkJPmgmfJZpEdN20aPZPFfQDEx4moLgn2GcDqnzA2CfyuE","UiLocales":null,"Nonce":"637026579273324336.Y2Q5ZGIwNmItZDdhOC00NzViLTlmZGYtZjM2OTM2YWE1Zjc2NzY0YTA5ODYtZGU2ZS00ZDk3LTlhNmEtNGEzYjYwYjRiNmU0","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"84d44bf45acd4818a2c5954ed386dd27","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026579273324336.Y2Q5ZGIwNmItZDdhOC00NzViLTlmZGYtZjM2OTM2YWE1Zjc2NzY0YTA5ODYtZGU2ZS00ZDk3LTlhNmEtNGEzYjYwYjRiNmU0","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofOKhw1q3CN6fIi73tLUFFxd4_kvV_dCHrFmJWqzRjzZ1Zgbw-P5I_VrW9CGd4Gf453d_C4AszPUQ1_VWLhqwAw7V0OTrW1bMIerNrCmAIhMmQmu_ZaWdcSmGxfbfCIrAROJpReKp0SSft7sXLHAT35Es7Q6eOO5VDc9DdojlMNR7bdT2TU3OKhMKPXWLTHLhROPeYRpI0vvSh2QBsEgqzLxqAjWmBINGbAjRQgYJG91qrFP_xCBcWhTX-nIZQtbfpHt4mRolB4PLmfEjJu4uQkJPmgmfJZpEdN20aPZPFfQDEx4moLgn2GcDqnzA2CfyuE","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 14:45:34.989 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 14:45:34.996 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 14:45:34.997 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 14:45:35.000 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 14:45:35.025 +08:00 [DBG] PgczsHSHGFQHNY4jfrVJ/CLbudg4HLiI/w2+XrO0RIs= not found in database
2019-08-29 14:45:35.047 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-29 14:45:35.058 +08:00 [DBG] CuV0RP509DqrJsNkmDtU38wI549nF4B8SoWKFIqyClo= not found in database
2019-08-29 14:45:35.062 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 14:45:35.069 +08:00 [DBG] Getting claims for identity token for subject: eeee90dc-1080-4570-aa1d-8ef93c223057 and client: mvc
2019-08-29 14:45:35.071 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 14:45:35.092 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****t2hQ","$type":"Token"},{"TokenType":"code","TokenValue":"****a035","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPC9HPF18NU:0000000F","TimeStamp":"2019-08-29T06:45:35.0000000Z","ProcessId":16364,"LocalIpAddress":"127.0.0.1:44753","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 14:45:35.094 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOKhw1q3CN6fIi73tLUFFxd4_kvV_dCHrFmJWqzRjzZ1Zgbw-P5I_VrW9CGd4Gf453d_C4AszPUQ1_VWLhqwAw7V0OTrW1bMIerNrCmAIhMmQmu_ZaWdcSmGxfbfCIrAROJpReKp0SSft7sXLHAT35Es7Q6eOO5VDc9DdojlMNR7bdT2TU3OKhMKPXWLTHLhROPeYRpI0vvSh2QBsEgqzLxqAjWmBINGbAjRQgYJG91qrFP_xCBcWhTX-nIZQtbfpHt4mRolB4PLmfEjJu4uQkJPmgmfJZpEdN20aPZPFfQDEx4moLgn2GcDqnzA2CfyuE","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 14:45:35.104 +08:00 [DBG] Augmenting SignInContext
2019-08-29 14:45:35.104 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 14:45:35.229 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 14:45:35.233 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 14:45:35.233 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 14:45:35.241 +08:00 [DBG] Start token request.
2019-08-29 14:45:35.246 +08:00 [DBG] Start client validation
2019-08-29 14:45:35.251 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 14:45:35.254 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 14:45:35.254 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 14:45:35.254 +08:00 [DBG] Secret id found: mvc
2019-08-29 14:45:35.258 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:35.258 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:35.265 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 14:45:35.265 +08:00 [DBG] Client validation success
2019-08-29 14:45:35.265 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPC9HPF18NU:00000010","TimeStamp":"2019-08-29T06:45:35.0000000Z","ProcessId":16364,"LocalIpAddress":"127.0.0.1:44753","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 14:45:35.271 +08:00 [DBG] Start token request validation
2019-08-29 14:45:35.280 +08:00 [DBG] Start validation of authorization code token request
2019-08-29 14:45:35.291 +08:00 [DBG] CuV0RP509DqrJsNkmDtU38wI549nF4B8SoWKFIqyClo= found in database: true
2019-08-29 14:45:35.303 +08:00 [DBG] removing CuV0RP509DqrJsNkmDtU38wI549nF4B8SoWKFIqyClo= persisted grant from database
2019-08-29 14:45:35.318 +08:00 [DBG] Validation of authorization code token request success
2019-08-29 14:45:35.321 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"78988e06b4abd80692e71d8a34c0cb23aa751996055120997b1c5486e7c3a035","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"78988e06b4abd80692e71d8a34c0cb23aa751996055120997b1c5486e7c3a035","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-29 14:45:35.337 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:35.337 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:35.343 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:35.411 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:35.420 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-29 14:45:35.420 +08:00 [DBG] Getting claims for access token for subject: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 14:45:35.440 +08:00 [DBG] Creating refresh token
2019-08-29 14:45:35.440 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-29 14:45:35.449 +08:00 [DBG] geOpFErdQA7PvUzFm74RoNn20dg8nb34gb1ByUqjyro= not found in database
2019-08-29 14:45:35.456 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:35.456 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:35.457 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:35.460 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 14:45:35.460 +08:00 [DBG] Getting claims for identity token for subject: eeee90dc-1080-4570-aa1d-8ef93c223057 and client: mvc
2019-08-29 14:45:35.461 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 14:45:35.467 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****Ceag","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****df90","$type":"Token"},{"TokenType":"access_token","TokenValue":"****FvBg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPC9HPF18NU:00000010","TimeStamp":"2019-08-29T06:45:35.0000000Z","ProcessId":16364,"LocalIpAddress":"127.0.0.1:44753","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 14:45:35.468 +08:00 [DBG] Token request success.
2019-08-29 14:45:35.478 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-29 14:45:35.479 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-29 14:45:35.479 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-29 14:45:35.485 +08:00 [DBG] Start userinfo request
2019-08-29 14:45:35.488 +08:00 [DBG] Bearer token found in header
2019-08-29 14:45:35.502 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:35.502 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:35.505 +08:00 [DBG] mvc found in database: true
2019-08-29 14:45:35.505 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 14:45:35.509 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 14:45:35.510 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567061135,"exp":1567064735,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"eeee90dc-1080-4570-aa1d-8ef93c223057","auth_time":1567061133,"idp":"local","role":["zero.Admin","zero.tenantRole1:67799490-86dd-4732-bee6-871dff845f30"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 14:45:35.517 +08:00 [DBG] Creating userinfo response
2019-08-29 14:45:35.520 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 14:45:35.521 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 14:45:35.525 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:35.525 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2019-08-29 14:45:35.525 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 14:45:35.527 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 14:45:35.530 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2019-08-29 14:45:35.530 +08:00 [DBG] End userinfo request
2019-08-29 14:45:44.503 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 14:45:44.504 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 14:45:44.504 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 14:45:44.504 +08:00 [DBG] Start authorize request
2019-08-29 14:45:44.504 +08:00 [DBG] User in authorize request: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 14:45:44.504 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:44.508 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 14:45:44.508 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 14:45:44.510 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 14:45:44.543 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 14:45:44.543 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 14:45:44.545 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 14:45:44.546 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:44.546 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE0OjQ1OjQ0IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"84d44bf45acd4818a2c5954ed386dd27","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE0OjQ1OjQ0IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 14:45:44.548 +08:00 [DBG] d5uooBrLuRw4pKghiSMw/c8t9f2fopUmOYLy2q+u7g8= found in database: false
2019-08-29 14:45:44.548 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|eeee90dc-1080-4570-aa1d-8ef93c223057 not found in store.
2019-08-29 14:45:44.548 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 14:45:44.548 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 14:45:44.555 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:44.558 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 14:45:44.558 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 14:45:44.559 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 14:45:44.561 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 14:45:44.561 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 14:45:44.563 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 14:45:44.563 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:44.566 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 14:45:44.566 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 14:45:44.567 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 14:45:44.569 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 14:45:47.642 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 14:45:47.645 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:47.648 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 14:45:47.648 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 14:45:47.649 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 14:45:47.652 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 14:45:47.652 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 14:45:47.655 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 14:45:47.655 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:47.655 +08:00 [INF] {"SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","ClientId":"zero_identity_api_swaggerui","RequestedScopes":["zero_identity_api"],"GrantedScopes":["zero_identity_api"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPC9HPF18NU:00000014","TimeStamp":"2019-08-29T06:45:47.0000000Z","ProcessId":16364,"LocalIpAddress":"127.0.0.1:44753","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 14:45:47.659 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 14:45:47.659 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 14:45:47.665 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 14:45:47.666 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 14:45:47.666 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 14:45:47.666 +08:00 [DBG] Start authorize callback request
2019-08-29 14:45:47.666 +08:00 [DBG] User in authorize request: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 14:45:47.666 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 14:45:47.670 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 14:45:47.671 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 14:45:47.672 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 14:45:47.674 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 14:45:47.675 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 14:45:47.677 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 14:45:47.677 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 14:45:47.677 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE0OjQ1OjQ0IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"84d44bf45acd4818a2c5954ed386dd27","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE0OjQ1OjQ0IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 14:45:47.679 +08:00 [DBG] d5uooBrLuRw4pKghiSMw/c8t9f2fopUmOYLy2q+u7g8= found in database: false
2019-08-29 14:45:47.679 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|eeee90dc-1080-4570-aa1d-8ef93c223057 not found in store.
2019-08-29 14:45:47.679 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 14:45:47.679 +08:00 [INF] User consented to scopes: ["zero_identity_api"]
2019-08-29 14:45:47.679 +08:00 [DBG] User indicated to remember consent for scopes: ["zero_identity_api"]
2019-08-29 14:45:47.679 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 14:45:47.680 +08:00 [DBG] d5uooBrLuRw4pKghiSMw/c8t9f2fopUmOYLy2q+u7g8= not found in database
2019-08-29 14:45:47.682 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 14:45:47.682 +08:00 [DBG] Getting claims for access token for client: zero_identity_api_swaggerui
2019-08-29 14:45:47.682 +08:00 [DBG] Getting claims for access token for subject: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 14:45:47.692 +08:00 [INF] {"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","Endpoint":"Authorize","SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","Scopes":"zero_identity_api","GrantType":"implicit","Tokens":[{"TokenType":"access_token","TokenValue":"****03EA","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPC9HPF18NU:00000015","TimeStamp":"2019-08-29T06:45:47.0000000Z","ProcessId":16364,"LocalIpAddress":"127.0.0.1:44753","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 14:45:47.692 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","ClientId":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","State":"VGh1IEF1ZyAyOSAyMDE5IDE0OjQ1OjQ0IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","Scope":"zero_identity_api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 14:45:47.693 +08:00 [DBG] Augmenting SignInContext
2019-08-29 14:45:47.693 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 14:45:52.589 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 14:45:52.590 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 14:45:52.590 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 14:45:52.590 +08:00 [DBG] Start discovery request
2019-08-29 14:45:52.595 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 14:45:52.634 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 14:45:52.634 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 14:45:52.634 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 14:45:52.634 +08:00 [DBG] Start key discovery request
2019-08-29 15:01:59.559 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:01:59.594 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:01:59.594 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:01:59.594 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:01:59.594 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:01:59.594 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:01:59.594 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:01:59.718 +08:00 [DBG] Starting grant removal
2019-08-29 15:01:59.983 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:01:59.985 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:01:59.985 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:01:59.985 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:01:59.985 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:01:59.985 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:01:59.985 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:02:05.938 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 15:02:05.942 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 15:02:05.942 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 15:02:05.946 +08:00 [DBG] Start authorize request
2019-08-29 15:02:05.952 +08:00 [DBG] User in authorize request: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 15:02:05.957 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:02:06.238 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:06.248 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:06.301 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:06.415 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:06.431 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:06.433 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:06.441 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:02:06.450 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"eeee90dc-1080-4570-aa1d-8ef93c223057","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjAyOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"84d44bf45acd4818a2c5954ed386dd27","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE1OjAyOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:02:06.476 +08:00 [WRN] No user found matching subject Id: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 15:02:06.477 +08:00 [INF] Showing login: User is not active
2019-08-29 15:02:06.527 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:02:06.531 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:06.532 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:06.533 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:06.535 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:06.536 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:06.538 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:06.538 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:02:06.543 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:06.543 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:08.306 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:02:08.344 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:02:08.347 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:08.347 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:08.348 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:08.351 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:08.351 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:08.353 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:08.353 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:02:08.466 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:02:08.468 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 15:02:08.468 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 15:02:08.468 +08:00 [DBG] Adding auth_time claim with value: 1567062128
2019-08-29 15:02:08.476 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:02:08.485 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","DisplayName":"alice","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPC9R4QT923:00000005","TimeStamp":"2019-08-29T07:02:08.0000000Z","ProcessId":15216,"LocalIpAddress":"127.0.0.1:28958","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 15:02:08.490 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:08.490 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:08.506 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:02:08.507 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:02:08.507 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:02:08.513 +08:00 [DBG] Start authorize callback request
2019-08-29 15:02:08.516 +08:00 [DBG] User in authorize request: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:02:08.516 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:02:08.519 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:08.520 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:08.521 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:08.523 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:08.524 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:08.526 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:08.526 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:02:08.526 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjAyOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"af2a2421441df3f2fc313bfaf674dad6","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE1OjAyOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:02:08.546 +08:00 [DBG] Z4axSJlIBjAO23gjpy7iJNQWnn48qOlmp8J/14oYPL4= found in database: false
2019-08-29 15:02:08.546 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|95af1c1c-f3ed-4192-a6ed-4d698bb57938 not found in store.
2019-08-29 15:02:08.546 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 15:02:08.546 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 15:02:08.568 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:02:08.572 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:08.572 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:08.572 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:08.575 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:08.576 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:08.578 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:08.578 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:02:08.581 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:08.581 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:08.582 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:08.584 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:09.540 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:02:09.550 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:02:09.554 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:09.554 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:09.555 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:09.558 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:09.558 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:09.560 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:09.561 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:02:09.562 +08:00 [INF] {"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","ClientId":"zero_identity_api_swaggerui","RequestedScopes":["zero_identity_api"],"GrantedScopes":["zero_identity_api"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPC9R4QT923:00000008","TimeStamp":"2019-08-29T07:02:09.0000000Z","ProcessId":15216,"LocalIpAddress":"127.0.0.1:28958","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 15:02:09.581 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:09.581 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:09.587 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:02:09.588 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:02:09.588 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:02:09.588 +08:00 [DBG] Start authorize callback request
2019-08-29 15:02:09.591 +08:00 [DBG] User in authorize request: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:02:09.591 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:02:09.594 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:02:09.594 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:02:09.595 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:09.598 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:09.599 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:02:09.601 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:02:09.601 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:02:09.601 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjAyOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"af2a2421441df3f2fc313bfaf674dad6","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE1OjAyOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:02:09.603 +08:00 [DBG] Z4axSJlIBjAO23gjpy7iJNQWnn48qOlmp8J/14oYPL4= found in database: false
2019-08-29 15:02:09.604 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|95af1c1c-f3ed-4192-a6ed-4d698bb57938 not found in store.
2019-08-29 15:02:09.604 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 15:02:09.608 +08:00 [INF] User consented to scopes: ["zero_identity_api"]
2019-08-29 15:02:09.610 +08:00 [DBG] User indicated to remember consent for scopes: ["zero_identity_api"]
2019-08-29 15:02:09.612 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:02:09.629 +08:00 [DBG] Z4axSJlIBjAO23gjpy7iJNQWnn48qOlmp8J/14oYPL4= not found in database
2019-08-29 15:02:09.649 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 15:02:09.658 +08:00 [DBG] Getting claims for access token for client: zero_identity_api_swaggerui
2019-08-29 15:02:09.658 +08:00 [DBG] Getting claims for access token for subject: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:02:09.707 +08:00 [INF] {"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","Endpoint":"Authorize","SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","Scopes":"zero_identity_api","GrantType":"implicit","Tokens":[{"TokenType":"access_token","TokenValue":"****ucEQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPC9R4QT923:00000009","TimeStamp":"2019-08-29T07:02:09.0000000Z","ProcessId":15216,"LocalIpAddress":"127.0.0.1:28958","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:02:09.708 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","ClientId":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjAyOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","Scope":"zero_identity_api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 15:02:09.723 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:02:09.724 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:02:13.555 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:02:13.557 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:02:13.557 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:02:13.561 +08:00 [DBG] Start discovery request
2019-08-29 15:02:13.643 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:02:13.688 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:02:13.688 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:02:13.688 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:02:13.692 +08:00 [DBG] Start key discovery request
2019-08-29 15:03:25.481 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:03:25.521 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:03:25.522 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:03:25.522 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:03:25.522 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:03:25.522 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:03:25.522 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:03:25.645 +08:00 [DBG] Starting grant removal
2019-08-29 15:03:25.953 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:03:25.954 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:03:25.954 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:03:25.954 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:03:25.954 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:03:25.954 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:03:25.954 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:03:25.991 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 15:03:25.999 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 15:03:25.999 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 15:03:26.002 +08:00 [DBG] Start authorize request
2019-08-29 15:03:26.009 +08:00 [DBG] User in authorize request: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:03:26.014 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:03:26.567 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:03:26.577 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:03:26.631 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:03:26.790 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:03:26.804 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:03:26.806 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:03:26.814 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:03:26.822 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjAzOjIzIEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"af2a2421441df3f2fc313bfaf674dad6","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE1OjAzOjIzIEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:03:26.880 +08:00 [DBG] Z4axSJlIBjAO23gjpy7iJNQWnn48qOlmp8J/14oYPL4= found in database: true
2019-08-29 15:03:26.884 +08:00 [DBG] Consent found in consent store is same as current request, consent is not required
2019-08-29 15:03:26.890 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 15:03:26.898 +08:00 [DBG] Getting claims for access token for client: zero_identity_api_swaggerui
2019-08-29 15:03:26.898 +08:00 [DBG] Getting claims for access token for subject: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:03:27.034 +08:00 [INF] {"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","Endpoint":"Authorize","SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","Scopes":"zero_identity_api","GrantType":"implicit","Tokens":[{"TokenType":"access_token","TokenValue":"****KhEQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPC9RUEPJAF:00000001","TimeStamp":"2019-08-29T07:03:27.0000000Z","ProcessId":10064,"LocalIpAddress":"127.0.0.1:20667","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:03:27.036 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","ClientId":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjAzOjIzIEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","Scope":"zero_identity_api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 15:03:32.628 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:03:32.630 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:03:32.630 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:03:32.635 +08:00 [DBG] Start discovery request
2019-08-29 15:03:32.760 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:03:32.806 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:03:32.807 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:03:32.807 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:03:32.810 +08:00 [DBG] Start key discovery request
2019-08-29 15:05:07.663 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:05:07.663 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:05:07.663 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:05:07.663 +08:00 [DBG] Start discovery request
2019-08-29 15:05:07.670 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:05:07.732 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:05:07.732 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:05:07.732 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:05:07.732 +08:00 [DBG] Start key discovery request
2019-08-29 15:05:07.768 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-29 15:05:07.769 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-29 15:05:07.769 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-29 15:05:07.774 +08:00 [DBG] Processing signout request for 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:05:07.779 +08:00 [DBG] Start end session request validation
2019-08-29 15:05:07.784 +08:00 [DBG] Start identity token validation
2019-08-29 15:05:07.796 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:07.796 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:07.796 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-29 15:05:07.805 +08:00 [WRN] No user found matching subject Id: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 15:05:07.807 +08:00 [ERR] User marked as not active: eeee90dc-1080-4570-aa1d-8ef93c223057
2019-08-29 15:05:07.810 +08:00 [INF] End session request validation failure: Error validating id token hint
{"ClientId":null,"ClientName":null,"SubjectId":"unknown","PostLogOutUri":null,"State":null,"Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofMijXfcKWY70GUCf22ZDPZoH4Xz3MReCYDn96crnb3PU7pmwcklRVXu1VibfJLe7MAFyLqYMwGdirYDPUT668OVQnGagStnL1WorYGS3JTSY6T0ONjW4fGu58VYzXon5JLjfSxj80ORBtNvhOXQ-fyH","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-29 15:05:07.811 +08:00 [ERR] Error processing end session request Invalid request
2019-08-29 15:05:09.463 +08:00 [DBG] CORS request made for path: /Account/Logout from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:05:09.510 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-29 15:05:09.512 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-29 15:05:09.513 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-29 15:05:09.513 +08:00 [INF] {"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","DisplayName":"Alice Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLPC9RUEPJAG:00000005","TimeStamp":"2019-08-29T07:05:09.0000000Z","ProcessId":10064,"LocalIpAddress":"127.0.0.1:20667","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-29 15:05:09.568 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-29 15:05:09.571 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-29 15:05:09.571 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-29 15:05:09.575 +08:00 [DBG] Processing signout callback request
2019-08-29 15:05:09.586 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:05:09.586 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:05:09.586 +08:00 [DBG] No client front-channel logout URLs
2019-08-29 15:05:09.586 +08:00 [DBG] No client back-channel logout URLs
2019-08-29 15:05:09.587 +08:00 [INF] Successful signout callback.
2019-08-29 15:05:09.587 +08:00 [DBG] No client front-channel iframe urls
2019-08-29 15:05:09.587 +08:00 [DBG] No client back-channel iframe urls
2019-08-29 15:05:16.152 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 15:05:16.153 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 15:05:16.154 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 15:05:16.154 +08:00 [DBG] Start authorize request
2019-08-29 15:05:16.154 +08:00 [DBG] No user present in authorize request
2019-08-29 15:05:16.154 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:16.158 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:16.158 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:16.158 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:05:16.160 +08:00 [DBG] No PKCE used.
2019-08-29 15:05:16.171 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:16.245 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:16.248 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:16.264 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:16.265 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:16.265 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofO9uLxlX_Zia5pjTnBNlPZI3km4VrNw-S-0rl41kZ7cIly-XGWVedUN3g2lqy6Y0zrNUSulSrPXZsm60QSCeDiZ2xRltCTAvv9A0ueKzwKff-JQlK7Etb9pH4tQ2-RqBdM2ylGrsYrMf7aoI2b_w3TO7OSA2T7Dz_ttkjv6xeDq6VC7tc7gnl3SI8Wb1r9mbhTln1dSFqEbBV3MOaKGj6bGGyjlCvgyHOaSlShcwRlzvfXW2xe3yswjLaSRlmOnQAOAm-2BNOetmh9bl90u7ZoROyTdDw_mtdHyaLZVJqVx3zgF3TiuBGTJbekd-i1K8h8","UiLocales":null,"Nonce":"637026591161456515.ZmFhZWVhYjgtMzk3MS00MGFiLTgzNzctYjMzODkwZWE2OTcyYTY4OTg3OWUtOTI0Ni00ZjQ4LTk5MjktMjk0MjdmOWRhZGM3","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026591161456515.ZmFhZWVhYjgtMzk3MS00MGFiLTgzNzctYjMzODkwZWE2OTcyYTY4OTg3OWUtOTI0Ni00ZjQ4LTk5MjktMjk0MjdmOWRhZGM3","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofO9uLxlX_Zia5pjTnBNlPZI3km4VrNw-S-0rl41kZ7cIly-XGWVedUN3g2lqy6Y0zrNUSulSrPXZsm60QSCeDiZ2xRltCTAvv9A0ueKzwKff-JQlK7Etb9pH4tQ2-RqBdM2ylGrsYrMf7aoI2b_w3TO7OSA2T7Dz_ttkjv6xeDq6VC7tc7gnl3SI8Wb1r9mbhTln1dSFqEbBV3MOaKGj6bGGyjlCvgyHOaSlShcwRlzvfXW2xe3yswjLaSRlmOnQAOAm-2BNOetmh9bl90u7ZoROyTdDw_mtdHyaLZVJqVx3zgF3TiuBGTJbekd-i1K8h8","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:05:16.265 +08:00 [INF] Showing login: User is not authenticated
2019-08-29 15:05:16.290 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:16.294 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:16.294 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:16.294 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:05:16.294 +08:00 [DBG] No PKCE used.
2019-08-29 15:05:16.295 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:16.297 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:16.299 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:16.300 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:16.301 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:16.305 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:16.305 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:19.860 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:05:19.876 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:19.880 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:19.880 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:19.880 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:05:19.880 +08:00 [DBG] No PKCE used.
2019-08-29 15:05:19.881 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:19.884 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:19.885 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:19.887 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:19.888 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:19.922 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:05:19.924 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 15:05:19.924 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 15:05:19.924 +08:00 [DBG] Adding auth_time claim with value: 1567062319
2019-08-29 15:05:19.929 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:05:19.932 +08:00 [INF] {"Username":"bob","Provider":null,"ProviderUserId":null,"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","DisplayName":"bob","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPC9RUEPJAG:0000000A","TimeStamp":"2019-08-29T07:05:19.0000000Z","ProcessId":10064,"LocalIpAddress":"127.0.0.1:20667","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 15:05:19.935 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:19.935 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:19.950 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:05:19.951 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:05:19.951 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:05:19.956 +08:00 [DBG] Start authorize callback request
2019-08-29 15:05:19.959 +08:00 [DBG] User in authorize request: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:05:19.959 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:19.962 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:19.962 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:19.962 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:05:19.962 +08:00 [DBG] No PKCE used.
2019-08-29 15:05:19.963 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:19.965 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:19.966 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:19.969 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:19.969 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:19.969 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofO9uLxlX_Zia5pjTnBNlPZI3km4VrNw-S-0rl41kZ7cIly-XGWVedUN3g2lqy6Y0zrNUSulSrPXZsm60QSCeDiZ2xRltCTAvv9A0ueKzwKff-JQlK7Etb9pH4tQ2-RqBdM2ylGrsYrMf7aoI2b_w3TO7OSA2T7Dz_ttkjv6xeDq6VC7tc7gnl3SI8Wb1r9mbhTln1dSFqEbBV3MOaKGj6bGGyjlCvgyHOaSlShcwRlzvfXW2xe3yswjLaSRlmOnQAOAm-2BNOetmh9bl90u7ZoROyTdDw_mtdHyaLZVJqVx3zgF3TiuBGTJbekd-i1K8h8","UiLocales":null,"Nonce":"637026591161456515.ZmFhZWVhYjgtMzk3MS00MGFiLTgzNzctYjMzODkwZWE2OTcyYTY4OTg3OWUtOTI0Ni00ZjQ4LTk5MjktMjk0MjdmOWRhZGM3","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"be523398cfc707a8c4c36707af607521","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026591161456515.ZmFhZWVhYjgtMzk3MS00MGFiLTgzNzctYjMzODkwZWE2OTcyYTY4OTg3OWUtOTI0Ni00ZjQ4LTk5MjktMjk0MjdmOWRhZGM3","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofO9uLxlX_Zia5pjTnBNlPZI3km4VrNw-S-0rl41kZ7cIly-XGWVedUN3g2lqy6Y0zrNUSulSrPXZsm60QSCeDiZ2xRltCTAvv9A0ueKzwKff-JQlK7Etb9pH4tQ2-RqBdM2ylGrsYrMf7aoI2b_w3TO7OSA2T7Dz_ttkjv6xeDq6VC7tc7gnl3SI8Wb1r9mbhTln1dSFqEbBV3MOaKGj6bGGyjlCvgyHOaSlShcwRlzvfXW2xe3yswjLaSRlmOnQAOAm-2BNOetmh9bl90u7ZoROyTdDw_mtdHyaLZVJqVx3zgF3TiuBGTJbekd-i1K8h8","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:05:19.970 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 15:05:19.970 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 15:05:19.991 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:19.995 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:19.995 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:19.995 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:05:19.995 +08:00 [DBG] No PKCE used.
2019-08-29 15:05:19.997 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:19.999 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:20.000 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:20.002 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:20.002 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:20.005 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:20.005 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:20.012 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:20.094 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:21.930 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:05:21.942 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:21.945 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:21.945 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:21.945 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:05:21.945 +08:00 [DBG] No PKCE used.
2019-08-29 15:05:21.946 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:21.949 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:21.950 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:21.952 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:21.953 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:21.954 +08:00 [INF] {"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPC9RUEPJAG:0000000D","TimeStamp":"2019-08-29T07:05:21.0000000Z","ProcessId":10064,"LocalIpAddress":"127.0.0.1:20667","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 15:05:21.965 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:21.965 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:21.972 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:05:21.973 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:05:21.973 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:05:21.973 +08:00 [DBG] Start authorize callback request
2019-08-29 15:05:21.975 +08:00 [DBG] User in authorize request: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:05:21.975 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:21.978 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:21.978 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:21.978 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:05:21.978 +08:00 [DBG] No PKCE used.
2019-08-29 15:05:21.979 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:21.982 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:21.983 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:21.985 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:21.985 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:21.985 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofO9uLxlX_Zia5pjTnBNlPZI3km4VrNw-S-0rl41kZ7cIly-XGWVedUN3g2lqy6Y0zrNUSulSrPXZsm60QSCeDiZ2xRltCTAvv9A0ueKzwKff-JQlK7Etb9pH4tQ2-RqBdM2ylGrsYrMf7aoI2b_w3TO7OSA2T7Dz_ttkjv6xeDq6VC7tc7gnl3SI8Wb1r9mbhTln1dSFqEbBV3MOaKGj6bGGyjlCvgyHOaSlShcwRlzvfXW2xe3yswjLaSRlmOnQAOAm-2BNOetmh9bl90u7ZoROyTdDw_mtdHyaLZVJqVx3zgF3TiuBGTJbekd-i1K8h8","UiLocales":null,"Nonce":"637026591161456515.ZmFhZWVhYjgtMzk3MS00MGFiLTgzNzctYjMzODkwZWE2OTcyYTY4OTg3OWUtOTI0Ni00ZjQ4LTk5MjktMjk0MjdmOWRhZGM3","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"be523398cfc707a8c4c36707af607521","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026591161456515.ZmFhZWVhYjgtMzk3MS00MGFiLTgzNzctYjMzODkwZWE2OTcyYTY4OTg3OWUtOTI0Ni00ZjQ4LTk5MjktMjk0MjdmOWRhZGM3","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofO9uLxlX_Zia5pjTnBNlPZI3km4VrNw-S-0rl41kZ7cIly-XGWVedUN3g2lqy6Y0zrNUSulSrPXZsm60QSCeDiZ2xRltCTAvv9A0ueKzwKff-JQlK7Etb9pH4tQ2-RqBdM2ylGrsYrMf7aoI2b_w3TO7OSA2T7Dz_ttkjv6xeDq6VC7tc7gnl3SI8Wb1r9mbhTln1dSFqEbBV3MOaKGj6bGGyjlCvgyHOaSlShcwRlzvfXW2xe3yswjLaSRlmOnQAOAm-2BNOetmh9bl90u7ZoROyTdDw_mtdHyaLZVJqVx3zgF3TiuBGTJbekd-i1K8h8","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:05:21.987 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 15:05:21.992 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 15:05:21.992 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 15:05:21.996 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:05:22.009 +08:00 [DBG] 6y6l2MCB0nJZ2H9fos9gsvqli/Nyao1clQeUCP4By/o= not found in database
2019-08-29 15:05:22.137 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-29 15:05:22.149 +08:00 [DBG] gqARH9upH7DzyClvtvr7nYix77flMDw7yub17Kigj2w= not found in database
2019-08-29 15:05:22.151 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 15:05:22.158 +08:00 [DBG] Getting claims for identity token for subject: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40 and client: mvc
2019-08-29 15:05:22.158 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 15:05:22.162 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****0VSg","$type":"Token"},{"TokenType":"code","TokenValue":"****c991","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPC9RUEPJAG:0000000E","TimeStamp":"2019-08-29T07:05:22.0000000Z","ProcessId":10064,"LocalIpAddress":"127.0.0.1:20667","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:05:22.162 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofO9uLxlX_Zia5pjTnBNlPZI3km4VrNw-S-0rl41kZ7cIly-XGWVedUN3g2lqy6Y0zrNUSulSrPXZsm60QSCeDiZ2xRltCTAvv9A0ueKzwKff-JQlK7Etb9pH4tQ2-RqBdM2ylGrsYrMf7aoI2b_w3TO7OSA2T7Dz_ttkjv6xeDq6VC7tc7gnl3SI8Wb1r9mbhTln1dSFqEbBV3MOaKGj6bGGyjlCvgyHOaSlShcwRlzvfXW2xe3yswjLaSRlmOnQAOAm-2BNOetmh9bl90u7ZoROyTdDw_mtdHyaLZVJqVx3zgF3TiuBGTJbekd-i1K8h8","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 15:05:22.167 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:05:22.167 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:05:22.324 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:05:22.327 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:05:22.327 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:05:22.333 +08:00 [DBG] Start token request.
2019-08-29 15:05:22.338 +08:00 [DBG] Start client validation
2019-08-29 15:05:22.343 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:05:22.346 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:05:22.346 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:05:22.346 +08:00 [DBG] Secret id found: mvc
2019-08-29 15:05:22.350 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:22.350 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:22.356 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:05:22.357 +08:00 [DBG] Client validation success
2019-08-29 15:05:22.357 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPC9RUEPJAG:0000000F","TimeStamp":"2019-08-29T07:05:22.0000000Z","ProcessId":10064,"LocalIpAddress":"127.0.0.1:20667","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:05:22.362 +08:00 [DBG] Start token request validation
2019-08-29 15:05:22.370 +08:00 [DBG] Start validation of authorization code token request
2019-08-29 15:05:22.371 +08:00 [DBG] gqARH9upH7DzyClvtvr7nYix77flMDw7yub17Kigj2w= found in database: true
2019-08-29 15:05:22.389 +08:00 [DBG] removing gqARH9upH7DzyClvtvr7nYix77flMDw7yub17Kigj2w= persisted grant from database
2019-08-29 15:05:22.402 +08:00 [DBG] Validation of authorization code token request success
2019-08-29 15:05:22.406 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"cbfbe7c989b37c9e9d63ba19f5a4eecfe4b033137d63685ae92aa4a02088c991","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"cbfbe7c989b37c9e9d63ba19f5a4eecfe4b033137d63685ae92aa4a02088c991","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:05:22.421 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:22.422 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:22.428 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:22.497 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:22.497 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-29 15:05:22.497 +08:00 [DBG] Getting claims for access token for subject: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:05:22.507 +08:00 [DBG] Creating refresh token
2019-08-29 15:05:22.507 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-29 15:05:22.518 +08:00 [DBG] VuqrQ97PdQCE4+nsuoRBsRGQxT+NJSmoGvYRDQPEX9I= not found in database
2019-08-29 15:05:22.525 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:22.525 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:22.527 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:22.529 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:05:22.530 +08:00 [DBG] Getting claims for identity token for subject: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40 and client: mvc
2019-08-29 15:05:22.530 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 15:05:22.535 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****WAEg","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****e155","$type":"Token"},{"TokenType":"access_token","TokenValue":"****uYYA","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPC9RUEPJAG:0000000F","TimeStamp":"2019-08-29T07:05:22.0000000Z","ProcessId":10064,"LocalIpAddress":"127.0.0.1:20667","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:05:22.537 +08:00 [DBG] Token request success.
2019-08-29 15:05:22.552 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-29 15:05:22.553 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-29 15:05:22.553 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-29 15:05:22.560 +08:00 [DBG] Start userinfo request
2019-08-29 15:05:22.563 +08:00 [DBG] Bearer token found in header
2019-08-29 15:05:22.579 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:22.579 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:22.582 +08:00 [DBG] mvc found in database: true
2019-08-29 15:05:22.582 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:05:22.586 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 15:05:22.588 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567062322,"exp":1567065922,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","auth_time":1567062319,"idp":"local","role":"zero.tenantRole1:2233f6ed-54c9-45af-b865-494aee505c4a","scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 15:05:22.594 +08:00 [DBG] Creating userinfo response
2019-08-29 15:05:22.597 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:05:22.599 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:05:22.601 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:22.602 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2019-08-29 15:05:22.602 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:05:22.603 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:05:22.606 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name role preferred_username
2019-08-29 15:05:22.607 +08:00 [DBG] End userinfo request
2019-08-29 15:05:29.325 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 15:05:29.327 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 15:05:29.327 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 15:05:29.327 +08:00 [DBG] Start authorize request
2019-08-29 15:05:29.327 +08:00 [DBG] User in authorize request: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:05:29.327 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:29.331 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:05:29.331 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:05:29.332 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:05:29.334 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:05:29.335 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:05:29.337 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:05:29.337 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:29.337 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjA1OjI5IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"be523398cfc707a8c4c36707af607521","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE1OjA1OjI5IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:05:29.339 +08:00 [DBG] ai+NG5Dmsky5W7wHqd7LJvAevM1ZKZ6LWDI5WZa660A= found in database: false
2019-08-29 15:05:29.339 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|3a155973-6bc6-42ad-ae42-6fc1cbee9b40 not found in store.
2019-08-29 15:05:29.339 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 15:05:29.339 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 15:05:29.346 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:29.350 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:05:29.350 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:05:29.350 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:05:29.353 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:05:29.353 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:05:29.355 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:05:29.355 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:29.358 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:05:29.358 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:05:29.359 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:05:29.361 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:05:31.518 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:05:31.519 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:31.524 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:05:31.524 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:05:31.524 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:05:31.527 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:05:31.528 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:05:31.530 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:05:31.530 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:31.530 +08:00 [INF] {"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ClientId":"zero_identity_api_swaggerui","RequestedScopes":["zero_identity_api"],"GrantedScopes":["zero_identity_api"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPC9RUEPJAG:00000013","TimeStamp":"2019-08-29T07:05:31.0000000Z","ProcessId":10064,"LocalIpAddress":"127.0.0.1:20667","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 15:05:31.533 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:05:31.533 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:05:31.540 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:05:31.540 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:05:31.540 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:05:31.540 +08:00 [DBG] Start authorize callback request
2019-08-29 15:05:31.540 +08:00 [DBG] User in authorize request: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:05:31.541 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:05:31.544 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:05:31.544 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:05:31.544 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:05:31.547 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:05:31.547 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:05:31.549 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:05:31.549 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:05:31.549 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjA1OjI5IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"be523398cfc707a8c4c36707af607521","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE1OjA1OjI5IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:05:31.551 +08:00 [DBG] ai+NG5Dmsky5W7wHqd7LJvAevM1ZKZ6LWDI5WZa660A= found in database: false
2019-08-29 15:05:31.551 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|3a155973-6bc6-42ad-ae42-6fc1cbee9b40 not found in store.
2019-08-29 15:05:31.551 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 15:05:31.551 +08:00 [INF] User consented to scopes: ["zero_identity_api"]
2019-08-29 15:05:31.551 +08:00 [DBG] User indicated to remember consent for scopes: ["zero_identity_api"]
2019-08-29 15:05:31.551 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:05:31.551 +08:00 [DBG] ai+NG5Dmsky5W7wHqd7LJvAevM1ZKZ6LWDI5WZa660A= not found in database
2019-08-29 15:05:31.552 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 15:05:31.552 +08:00 [DBG] Getting claims for access token for client: zero_identity_api_swaggerui
2019-08-29 15:05:31.553 +08:00 [DBG] Getting claims for access token for subject: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:05:31.558 +08:00 [INF] {"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","Endpoint":"Authorize","SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","Scopes":"zero_identity_api","GrantType":"implicit","Tokens":[{"TokenType":"access_token","TokenValue":"****uKEg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPC9RUEPJAG:00000014","TimeStamp":"2019-08-29T07:05:31.0000000Z","ProcessId":10064,"LocalIpAddress":"127.0.0.1:20667","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:05:31.558 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ClientId":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjA1OjI5IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","Scope":"zero_identity_api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 15:05:31.558 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:05:31.558 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:14:14.594 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:14:14.637 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:14:14.637 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:14:14.637 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:14:14.637 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:14:14.637 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:14:14.637 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:14:14.773 +08:00 [DBG] Starting grant removal
2019-08-29 15:14:14.998 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:14:14.999 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:14:14.999 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:14:14.999 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:14:14.999 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:14:14.999 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:14:14.999 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:14:15.027 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:14:15.032 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:14:15.033 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:14:15.036 +08:00 [DBG] Start discovery request
2019-08-29 15:14:15.587 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:14:15.676 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:14:15.677 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:14:15.677 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:14:15.680 +08:00 [DBG] Start key discovery request
2019-08-29 15:14:15.722 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-29 15:14:15.724 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-29 15:14:15.724 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-29 15:14:15.732 +08:00 [DBG] Processing signout request for 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:14:15.736 +08:00 [DBG] Start end session request validation
2019-08-29 15:14:15.742 +08:00 [DBG] Start identity token validation
2019-08-29 15:14:15.955 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:15.963 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:15.963 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-29 15:14:16.003 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 15:14:16.012 +08:00 [DBG] Token validation success
{"ClientId":"mvc","ClientName":"MVC Client","ValidateLifetime":false,"AccessTokenType":null,"ExpectedScope":null,"TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567062322,"exp":1567062622,"iss":"http://localhost:5000","aud":"mvc","nonce":"637026591161456515.ZmFhZWVhYjgtMzk3MS00MGFiLTgzNzctYjMzODkwZWE2OTcyYTY4OTg3OWUtOTI0Ni00ZjQ4LTk5MjktMjk0MjdmOWRhZGM3","iat":1567062322,"at_hash":"A2FDrOP8DSrgRMuTU9ocPw","sid":"be523398cfc707a8c4c36707af607521","sub":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","auth_time":1567062319,"idp":"local","amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 15:14:16.022 +08:00 [INF] End session request validation success
{"ClientId":"mvc","ClientName":"MVC Client","SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","PostLogOutUri":"http://localhost:5002/signout-callback-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofNHk3OmZyCCWOzeG7GoWeQ-jZ1rmpiHBxhMlBHtgueUJYkoc43Vf3tumf8NDJs_ukJxCo5N8PhHZ8yuxAgkjFI7v_DWgJJ8I447M2dmF2D9kqcxU8ul8QYQ7QkP2qglMavve-uRWzunDRL3AcLw0RRY","Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofNHk3OmZyCCWOzeG7GoWeQ-jZ1rmpiHBxhMlBHtgueUJYkoc43Vf3tumf8NDJs_ukJxCo5N8PhHZ8yuxAgkjFI7v_DWgJJ8I447M2dmF2D9kqcxU8ul8QYQ7QkP2qglMavve-uRWzunDRL3AcLw0RRY","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-29 15:14:16.023 +08:00 [DBG] Success validating end session request from mvc
2019-08-29 15:14:16.130 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-29 15:14:16.131 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-29 15:14:16.131 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-29 15:14:16.137 +08:00 [INF] {"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","DisplayName":"Bob Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLPCA1VSLN0S:00000004","TimeStamp":"2019-08-29T07:14:16.0000000Z","ProcessId":24888,"LocalIpAddress":"127.0.0.1:12883","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-29 15:14:16.249 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-29 15:14:16.251 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-29 15:14:16.251 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-29 15:14:16.257 +08:00 [DBG] Processing signout callback request
2019-08-29 15:14:16.272 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:16.272 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:16.275 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:14:16.275 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:14:16.275 +08:00 [DBG] No client front-channel logout URLs
2019-08-29 15:14:16.275 +08:00 [DBG] No client back-channel logout URLs
2019-08-29 15:14:16.275 +08:00 [INF] Successful signout callback.
2019-08-29 15:14:16.275 +08:00 [DBG] No client front-channel iframe urls
2019-08-29 15:14:16.275 +08:00 [DBG] No client back-channel iframe urls
2019-08-29 15:14:18.788 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 15:14:18.791 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 15:14:18.791 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 15:14:18.794 +08:00 [DBG] Start authorize request
2019-08-29 15:14:18.798 +08:00 [DBG] No user present in authorize request
2019-08-29 15:14:18.804 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:14:18.809 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:18.810 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:18.820 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:14:18.821 +08:00 [DBG] No PKCE used.
2019-08-29 15:14:18.863 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:18.966 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:18.976 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:18.979 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:18.985 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:14:18.987 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofPZ4o-99qwoAH7Ew-axNndplRi-m2QIit7pMqo-vtQoYt6OAX2ANd5eSs9VOAiHDk34_OXUZxgUX4SapbbUH1RyI-8Zv26PxZsV6vEUTga6ziZqT1GDk6d0YYZXXl8OErqZPcvUv3NK7sbedQhGs6jjjNxQjf7ZM1TDaHsVA791tVBnr1VDuoCy-icEEzL9xd2WPxQ7l7TDb8NnydGokz2UchqhFSg5JB2_WI-BQsn9FjrOby7STi1tN3vNUXidOELHAVYHdZrfRPXOgFi3ipIo5qgFZtkLJlhevFpXvpmdP1y2QgQGf95kDMRVby499wM","UiLocales":null,"Nonce":"637026596587825993.MTYzOWMwYTEtOWMxNC00MzFjLTllNzMtMDFmMTIwM2EzNTliY2NiZTBjOTEtNTAwOC00MTNiLWEyYTEtNjA4ZmY4OGJkN2Nh","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026596587825993.MTYzOWMwYTEtOWMxNC00MzFjLTllNzMtMDFmMTIwM2EzNTliY2NiZTBjOTEtNTAwOC00MTNiLWEyYTEtNjA4ZmY4OGJkN2Nh","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofPZ4o-99qwoAH7Ew-axNndplRi-m2QIit7pMqo-vtQoYt6OAX2ANd5eSs9VOAiHDk34_OXUZxgUX4SapbbUH1RyI-8Zv26PxZsV6vEUTga6ziZqT1GDk6d0YYZXXl8OErqZPcvUv3NK7sbedQhGs6jjjNxQjf7ZM1TDaHsVA791tVBnr1VDuoCy-icEEzL9xd2WPxQ7l7TDb8NnydGokz2UchqhFSg5JB2_WI-BQsn9FjrOby7STi1tN3vNUXidOELHAVYHdZrfRPXOgFi3ipIo5qgFZtkLJlhevFpXvpmdP1y2QgQGf95kDMRVby499wM","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:14:18.994 +08:00 [INF] Showing login: User is not authenticated
2019-08-29 15:14:19.022 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:14:19.026 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:19.026 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:19.026 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:14:19.026 +08:00 [DBG] No PKCE used.
2019-08-29 15:14:19.028 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:19.030 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:19.031 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:19.033 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:19.034 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:14:19.038 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:19.038 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:20.558 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:14:20.588 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:14:20.591 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:20.591 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:20.591 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:14:20.591 +08:00 [DBG] No PKCE used.
2019-08-29 15:14:20.592 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:20.595 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:20.596 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:20.599 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:20.599 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:14:20.718 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:14:20.721 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 15:14:20.721 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 15:14:20.721 +08:00 [DBG] Adding auth_time claim with value: 1567062860
2019-08-29 15:14:20.726 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:14:20.730 +08:00 [INF] {"Username":"bob","Provider":null,"ProviderUserId":null,"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","DisplayName":"bob","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPCA1VSLN0S:00000008","TimeStamp":"2019-08-29T07:14:20.0000000Z","ProcessId":24888,"LocalIpAddress":"127.0.0.1:12883","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 15:14:20.734 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:20.734 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:20.749 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:14:20.750 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:14:20.750 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:14:20.755 +08:00 [DBG] Start authorize callback request
2019-08-29 15:14:20.758 +08:00 [DBG] User in authorize request: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:14:20.758 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:14:20.761 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:20.761 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:20.761 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:14:20.761 +08:00 [DBG] No PKCE used.
2019-08-29 15:14:20.763 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:20.765 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:20.766 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:20.768 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:20.768 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:14:20.769 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofPZ4o-99qwoAH7Ew-axNndplRi-m2QIit7pMqo-vtQoYt6OAX2ANd5eSs9VOAiHDk34_OXUZxgUX4SapbbUH1RyI-8Zv26PxZsV6vEUTga6ziZqT1GDk6d0YYZXXl8OErqZPcvUv3NK7sbedQhGs6jjjNxQjf7ZM1TDaHsVA791tVBnr1VDuoCy-icEEzL9xd2WPxQ7l7TDb8NnydGokz2UchqhFSg5JB2_WI-BQsn9FjrOby7STi1tN3vNUXidOELHAVYHdZrfRPXOgFi3ipIo5qgFZtkLJlhevFpXvpmdP1y2QgQGf95kDMRVby499wM","UiLocales":null,"Nonce":"637026596587825993.MTYzOWMwYTEtOWMxNC00MzFjLTllNzMtMDFmMTIwM2EzNTliY2NiZTBjOTEtNTAwOC00MTNiLWEyYTEtNjA4ZmY4OGJkN2Nh","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"088e383daee15aa7ca86f731c4aa94f2","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026596587825993.MTYzOWMwYTEtOWMxNC00MzFjLTllNzMtMDFmMTIwM2EzNTliY2NiZTBjOTEtNTAwOC00MTNiLWEyYTEtNjA4ZmY4OGJkN2Nh","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofPZ4o-99qwoAH7Ew-axNndplRi-m2QIit7pMqo-vtQoYt6OAX2ANd5eSs9VOAiHDk34_OXUZxgUX4SapbbUH1RyI-8Zv26PxZsV6vEUTga6ziZqT1GDk6d0YYZXXl8OErqZPcvUv3NK7sbedQhGs6jjjNxQjf7ZM1TDaHsVA791tVBnr1VDuoCy-icEEzL9xd2WPxQ7l7TDb8NnydGokz2UchqhFSg5JB2_WI-BQsn9FjrOby7STi1tN3vNUXidOELHAVYHdZrfRPXOgFi3ipIo5qgFZtkLJlhevFpXvpmdP1y2QgQGf95kDMRVby499wM","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:14:20.780 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 15:14:20.780 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 15:14:20.801 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:14:20.805 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:20.805 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:20.805 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:14:20.805 +08:00 [DBG] No PKCE used.
2019-08-29 15:14:20.806 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:20.809 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:20.810 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:20.812 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:20.812 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:14:20.816 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:20.816 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:20.821 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:20.887 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:22.984 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:14:22.995 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:14:22.999 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:22.999 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:22.999 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:14:22.999 +08:00 [DBG] No PKCE used.
2019-08-29 15:14:23.000 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:23.003 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:23.004 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:23.006 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:23.007 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:14:23.008 +08:00 [INF] {"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCA1VSLN0S:0000000B","TimeStamp":"2019-08-29T07:14:23.0000000Z","ProcessId":24888,"LocalIpAddress":"127.0.0.1:12883","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 15:14:23.019 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:23.019 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:23.025 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:14:23.026 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:14:23.026 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:14:23.026 +08:00 [DBG] Start authorize callback request
2019-08-29 15:14:23.028 +08:00 [DBG] User in authorize request: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:14:23.028 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:14:23.032 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:23.032 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:23.032 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:14:23.032 +08:00 [DBG] No PKCE used.
2019-08-29 15:14:23.034 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:23.036 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:23.037 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:23.040 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:23.040 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:14:23.040 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofPZ4o-99qwoAH7Ew-axNndplRi-m2QIit7pMqo-vtQoYt6OAX2ANd5eSs9VOAiHDk34_OXUZxgUX4SapbbUH1RyI-8Zv26PxZsV6vEUTga6ziZqT1GDk6d0YYZXXl8OErqZPcvUv3NK7sbedQhGs6jjjNxQjf7ZM1TDaHsVA791tVBnr1VDuoCy-icEEzL9xd2WPxQ7l7TDb8NnydGokz2UchqhFSg5JB2_WI-BQsn9FjrOby7STi1tN3vNUXidOELHAVYHdZrfRPXOgFi3ipIo5qgFZtkLJlhevFpXvpmdP1y2QgQGf95kDMRVby499wM","UiLocales":null,"Nonce":"637026596587825993.MTYzOWMwYTEtOWMxNC00MzFjLTllNzMtMDFmMTIwM2EzNTliY2NiZTBjOTEtNTAwOC00MTNiLWEyYTEtNjA4ZmY4OGJkN2Nh","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"088e383daee15aa7ca86f731c4aa94f2","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026596587825993.MTYzOWMwYTEtOWMxNC00MzFjLTllNzMtMDFmMTIwM2EzNTliY2NiZTBjOTEtNTAwOC00MTNiLWEyYTEtNjA4ZmY4OGJkN2Nh","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofPZ4o-99qwoAH7Ew-axNndplRi-m2QIit7pMqo-vtQoYt6OAX2ANd5eSs9VOAiHDk34_OXUZxgUX4SapbbUH1RyI-8Zv26PxZsV6vEUTga6ziZqT1GDk6d0YYZXXl8OErqZPcvUv3NK7sbedQhGs6jjjNxQjf7ZM1TDaHsVA791tVBnr1VDuoCy-icEEzL9xd2WPxQ7l7TDb8NnydGokz2UchqhFSg5JB2_WI-BQsn9FjrOby7STi1tN3vNUXidOELHAVYHdZrfRPXOgFi3ipIo5qgFZtkLJlhevFpXvpmdP1y2QgQGf95kDMRVby499wM","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:14:23.042 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 15:14:23.047 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 15:14:23.048 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 15:14:23.051 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:14:23.074 +08:00 [DBG] 6y6l2MCB0nJZ2H9fos9gsvqli/Nyao1clQeUCP4By/o= found in database
2019-08-29 15:14:23.190 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-29 15:14:23.202 +08:00 [DBG] tAp1Fc9kOyhSR9Qvm29cq0Hft3DUoJS2xftopH6meL0= not found in database
2019-08-29 15:14:23.222 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 15:14:23.230 +08:00 [DBG] Getting claims for identity token for subject: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40 and client: mvc
2019-08-29 15:14:23.231 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 15:14:23.253 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****7O-w","$type":"Token"},{"TokenType":"code","TokenValue":"****038f","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCA1VSLN0S:0000000C","TimeStamp":"2019-08-29T07:14:23.0000000Z","ProcessId":24888,"LocalIpAddress":"127.0.0.1:12883","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:14:23.254 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofPZ4o-99qwoAH7Ew-axNndplRi-m2QIit7pMqo-vtQoYt6OAX2ANd5eSs9VOAiHDk34_OXUZxgUX4SapbbUH1RyI-8Zv26PxZsV6vEUTga6ziZqT1GDk6d0YYZXXl8OErqZPcvUv3NK7sbedQhGs6jjjNxQjf7ZM1TDaHsVA791tVBnr1VDuoCy-icEEzL9xd2WPxQ7l7TDb8NnydGokz2UchqhFSg5JB2_WI-BQsn9FjrOby7STi1tN3vNUXidOELHAVYHdZrfRPXOgFi3ipIo5qgFZtkLJlhevFpXvpmdP1y2QgQGf95kDMRVby499wM","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 15:14:23.264 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:14:23.265 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:14:23.413 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:14:23.417 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:14:23.417 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:14:23.423 +08:00 [DBG] Start token request.
2019-08-29 15:14:23.428 +08:00 [DBG] Start client validation
2019-08-29 15:14:23.433 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:14:23.436 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:14:23.436 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:14:23.436 +08:00 [DBG] Secret id found: mvc
2019-08-29 15:14:23.440 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:23.440 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:23.448 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:14:23.448 +08:00 [DBG] Client validation success
2019-08-29 15:14:23.448 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCA1VSLN0S:0000000D","TimeStamp":"2019-08-29T07:14:23.0000000Z","ProcessId":24888,"LocalIpAddress":"127.0.0.1:12883","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:14:23.453 +08:00 [DBG] Start token request validation
2019-08-29 15:14:23.462 +08:00 [DBG] Start validation of authorization code token request
2019-08-29 15:14:23.474 +08:00 [DBG] tAp1Fc9kOyhSR9Qvm29cq0Hft3DUoJS2xftopH6meL0= found in database: true
2019-08-29 15:14:23.487 +08:00 [DBG] removing tAp1Fc9kOyhSR9Qvm29cq0Hft3DUoJS2xftopH6meL0= persisted grant from database
2019-08-29 15:14:23.501 +08:00 [DBG] Validation of authorization code token request success
2019-08-29 15:14:23.505 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"5b67ad51f54fc0c4c463b4244fe358b894ece74185de479f92d6f649d10c038f","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"5b67ad51f54fc0c4c463b4244fe358b894ece74185de479f92d6f649d10c038f","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:14:23.523 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:23.523 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:23.530 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:23.605 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:23.615 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-29 15:14:23.616 +08:00 [DBG] Getting claims for access token for subject: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:14:23.637 +08:00 [DBG] Creating refresh token
2019-08-29 15:14:23.638 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-29 15:14:23.647 +08:00 [DBG] FZkfGp9Y7azjbcyU/xvoR0o83zp0g/Fy+nNuQvZo8mA= not found in database
2019-08-29 15:14:23.654 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:23.654 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:23.655 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:23.658 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:14:23.658 +08:00 [DBG] Getting claims for identity token for subject: 3a155973-6bc6-42ad-ae42-6fc1cbee9b40 and client: mvc
2019-08-29 15:14:23.658 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 15:14:23.663 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****_r8Q","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****61ea","$type":"Token"},{"TokenType":"access_token","TokenValue":"****hTbg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCA1VSLN0S:0000000D","TimeStamp":"2019-08-29T07:14:23.0000000Z","ProcessId":24888,"LocalIpAddress":"127.0.0.1:12883","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:14:23.664 +08:00 [DBG] Token request success.
2019-08-29 15:14:23.681 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-29 15:14:23.682 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-29 15:14:23.682 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-29 15:14:23.688 +08:00 [DBG] Start userinfo request
2019-08-29 15:14:23.691 +08:00 [DBG] Bearer token found in header
2019-08-29 15:14:23.708 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:23.708 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:23.712 +08:00 [DBG] mvc found in database: true
2019-08-29 15:14:23.712 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:14:23.716 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 15:14:23.717 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567062863,"exp":1567066463,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","auth_time":1567062860,"idp":"local","role":"zero.tenantRole1:2233f6ed-54c9-45af-b865-494aee505c4a","scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 15:14:23.724 +08:00 [DBG] Creating userinfo response
2019-08-29 15:14:23.727 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:14:23.730 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:14:23.733 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:23.734 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2019-08-29 15:14:23.734 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:14:23.735 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:14:23.738 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name role preferred_username
2019-08-29 15:14:23.739 +08:00 [DBG] End userinfo request
2019-08-29 15:16:56.807 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-29 15:16:56.807 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-29 15:16:56.807 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-29 15:16:56.807 +08:00 [DBG] Processing signout request for 3a155973-6bc6-42ad-ae42-6fc1cbee9b40
2019-08-29 15:16:56.807 +08:00 [DBG] Start end session request validation
2019-08-29 15:16:56.807 +08:00 [DBG] Start identity token validation
2019-08-29 15:16:56.811 +08:00 [DBG] mvc found in database: true
2019-08-29 15:16:56.811 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:16:56.811 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-29 15:16:56.816 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 15:16:56.816 +08:00 [DBG] Token validation success
{"ClientId":"mvc","ClientName":"MVC Client","ValidateLifetime":false,"AccessTokenType":null,"ExpectedScope":null,"TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567062863,"exp":1567063163,"iss":"http://localhost:5000","aud":"mvc","nonce":"637026596587825993.MTYzOWMwYTEtOWMxNC00MzFjLTllNzMtMDFmMTIwM2EzNTliY2NiZTBjOTEtNTAwOC00MTNiLWEyYTEtNjA4ZmY4OGJkN2Nh","iat":1567062863,"at_hash":"ti-V16WC2jXf9d2tq6ew7w","sid":"088e383daee15aa7ca86f731c4aa94f2","sub":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","auth_time":1567062860,"idp":"local","amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 15:16:56.816 +08:00 [INF] End session request validation success
{"ClientId":"mvc","ClientName":"MVC Client","SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","PostLogOutUri":"http://localhost:5002/signout-callback-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOlPz3lZ4lVQYYpBnd95iejlmFWBvOHN1DTdy8aTqOHmar6rj_Gb2Y4IvRkJkAsCOibPCzvtZneyQ8j9eT50HgAmBAPvN8JqYklbJxiPo_MBbuHBd2ZbwRrAY4WDZC3KfYw8rRbtxDiDsPkMA3Ii2g8","Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofOlPz3lZ4lVQYYpBnd95iejlmFWBvOHN1DTdy8aTqOHmar6rj_Gb2Y4IvRkJkAsCOibPCzvtZneyQ8j9eT50HgAmBAPvN8JqYklbJxiPo_MBbuHBd2ZbwRrAY4WDZC3KfYw8rRbtxDiDsPkMA3Ii2g8","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-29 15:16:56.816 +08:00 [DBG] Success validating end session request from mvc
2019-08-29 15:16:56.824 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-29 15:16:56.824 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-29 15:16:56.825 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-29 15:16:56.825 +08:00 [INF] {"SubjectId":"3a155973-6bc6-42ad-ae42-6fc1cbee9b40","DisplayName":"Bob Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLPCA1VSLN0T:00000002","TimeStamp":"2019-08-29T07:16:56.0000000Z","ProcessId":24888,"LocalIpAddress":"127.0.0.1:12883","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-29 15:16:56.868 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-29 15:16:56.870 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-29 15:16:56.870 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-29 15:16:56.870 +08:00 [DBG] Processing signout callback request
2019-08-29 15:16:56.874 +08:00 [DBG] mvc found in database: true
2019-08-29 15:16:56.874 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:16:56.874 +08:00 [DBG] No client front-channel logout URLs
2019-08-29 15:16:56.874 +08:00 [DBG] No client back-channel logout URLs
2019-08-29 15:16:56.874 +08:00 [INF] Successful signout callback.
2019-08-29 15:16:56.874 +08:00 [DBG] No client front-channel iframe urls
2019-08-29 15:16:56.874 +08:00 [DBG] No client back-channel iframe urls
2019-08-29 15:16:59.084 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 15:16:59.085 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 15:16:59.085 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 15:16:59.086 +08:00 [DBG] Start authorize request
2019-08-29 15:16:59.086 +08:00 [DBG] No user present in authorize request
2019-08-29 15:16:59.086 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:16:59.090 +08:00 [DBG] mvc found in database: true
2019-08-29 15:16:59.090 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:16:59.090 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:16:59.090 +08:00 [DBG] No PKCE used.
2019-08-29 15:16:59.091 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:16:59.094 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:16:59.095 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:16:59.098 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:16:59.098 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:16:59.098 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofMJ4NcWWNHAFBkTJvzyFOQhOy9cBzvl13Af2fJL2r0Tzx6ueVAn4yckjNvJU8oCxx3zBjQa6w4gbDA0og14rrX2rbYOLZQU8o4JoFqgM2VN_i7Ir9KJISvWfRJNoToJcs3lud4OfMGaqsUbEA5aouggaEQ9qzVN6KwLYiEfD_-EEjTbAG6kMyul0-G88xdbrhOjM7VWJwxGMvlQE1JJli9WjPAGmepngHFvK5jC5OOuPEyA-5-egiwIdcRnb2igwdOMdBvJzQ6v7BKB_Ioa8endMD5VkDgD9PSckhWlrlD-gfCzJijpp8Tb55_vXe8ERIA","UiLocales":null,"Nonce":"637026598190772527.MTQ0NWVhOGItMjIwYS00NGE4LTlmM2UtNjZiYWFlMzZlZThhYmZiY2NiMzktMTRhMi00ZGM5LTg2NjAtYmZjYThmNTYyYmVl","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026598190772527.MTQ0NWVhOGItMjIwYS00NGE4LTlmM2UtNjZiYWFlMzZlZThhYmZiY2NiMzktMTRhMi00ZGM5LTg2NjAtYmZjYThmNTYyYmVl","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofMJ4NcWWNHAFBkTJvzyFOQhOy9cBzvl13Af2fJL2r0Tzx6ueVAn4yckjNvJU8oCxx3zBjQa6w4gbDA0og14rrX2rbYOLZQU8o4JoFqgM2VN_i7Ir9KJISvWfRJNoToJcs3lud4OfMGaqsUbEA5aouggaEQ9qzVN6KwLYiEfD_-EEjTbAG6kMyul0-G88xdbrhOjM7VWJwxGMvlQE1JJli9WjPAGmepngHFvK5jC5OOuPEyA-5-egiwIdcRnb2igwdOMdBvJzQ6v7BKB_Ioa8endMD5VkDgD9PSckhWlrlD-gfCzJijpp8Tb55_vXe8ERIA","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:16:59.098 +08:00 [INF] Showing login: User is not authenticated
2019-08-29 15:16:59.105 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:16:59.109 +08:00 [DBG] mvc found in database: true
2019-08-29 15:16:59.109 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:16:59.109 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:16:59.109 +08:00 [DBG] No PKCE used.
2019-08-29 15:16:59.111 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:16:59.114 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:16:59.115 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:16:59.118 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:16:59.118 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:16:59.122 +08:00 [DBG] mvc found in database: true
2019-08-29 15:16:59.122 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:20.069 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:18:20.110 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:18:20.110 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:18:20.110 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:18:20.110 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:18:20.110 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:18:20.110 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:18:20.238 +08:00 [DBG] Starting grant removal
2019-08-29 15:18:20.477 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:18:20.478 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:18:20.478 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:18:20.478 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:18:20.478 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:18:20.478 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:18:20.478 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:18:20.497 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:18:20.620 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:18:21.180 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:21.190 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:21.199 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:18:21.201 +08:00 [DBG] No PKCE used.
2019-08-29 15:18:21.264 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:21.503 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:21.519 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:21.521 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:21.530 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:18:21.652 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:18:21.654 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 15:18:21.654 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 15:18:21.654 +08:00 [DBG] Adding auth_time claim with value: 1567063101
2019-08-29 15:18:21.663 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:18:21.675 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","DisplayName":"alice","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPCA491NJM6:00000001","TimeStamp":"2019-08-29T07:18:21.0000000Z","ProcessId":14200,"LocalIpAddress":"127.0.0.1:47409","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 15:18:21.682 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:21.682 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:21.720 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:18:21.725 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:18:21.725 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:18:21.730 +08:00 [DBG] Start authorize callback request
2019-08-29 15:18:21.737 +08:00 [DBG] User in authorize request: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:18:21.737 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:18:21.740 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:21.740 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:21.740 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:18:21.740 +08:00 [DBG] No PKCE used.
2019-08-29 15:18:21.741 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:21.744 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:21.745 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:21.747 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:21.747 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:18:21.753 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofMJ4NcWWNHAFBkTJvzyFOQhOy9cBzvl13Af2fJL2r0Tzx6ueVAn4yckjNvJU8oCxx3zBjQa6w4gbDA0og14rrX2rbYOLZQU8o4JoFqgM2VN_i7Ir9KJISvWfRJNoToJcs3lud4OfMGaqsUbEA5aouggaEQ9qzVN6KwLYiEfD_-EEjTbAG6kMyul0-G88xdbrhOjM7VWJwxGMvlQE1JJli9WjPAGmepngHFvK5jC5OOuPEyA-5-egiwIdcRnb2igwdOMdBvJzQ6v7BKB_Ioa8endMD5VkDgD9PSckhWlrlD-gfCzJijpp8Tb55_vXe8ERIA","UiLocales":null,"Nonce":"637026598190772527.MTQ0NWVhOGItMjIwYS00NGE4LTlmM2UtNjZiYWFlMzZlZThhYmZiY2NiMzktMTRhMi00ZGM5LTg2NjAtYmZjYThmNTYyYmVl","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"b799422c39f9d5b6c69245ae39468877","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026598190772527.MTQ0NWVhOGItMjIwYS00NGE4LTlmM2UtNjZiYWFlMzZlZThhYmZiY2NiMzktMTRhMi00ZGM5LTg2NjAtYmZjYThmNTYyYmVl","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofMJ4NcWWNHAFBkTJvzyFOQhOy9cBzvl13Af2fJL2r0Tzx6ueVAn4yckjNvJU8oCxx3zBjQa6w4gbDA0og14rrX2rbYOLZQU8o4JoFqgM2VN_i7Ir9KJISvWfRJNoToJcs3lud4OfMGaqsUbEA5aouggaEQ9qzVN6KwLYiEfD_-EEjTbAG6kMyul0-G88xdbrhOjM7VWJwxGMvlQE1JJli9WjPAGmepngHFvK5jC5OOuPEyA-5-egiwIdcRnb2igwdOMdBvJzQ6v7BKB_Ioa8endMD5VkDgD9PSckhWlrlD-gfCzJijpp8Tb55_vXe8ERIA","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:18:21.787 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 15:18:21.787 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 15:18:21.812 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:18:21.816 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:21.816 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:21.816 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:18:21.816 +08:00 [DBG] No PKCE used.
2019-08-29 15:18:21.818 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:21.821 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:21.822 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:21.824 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:21.824 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:18:21.827 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:21.827 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:21.833 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:21.898 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:24.022 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:18:24.032 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:18:24.036 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:24.036 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:24.036 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:18:24.036 +08:00 [DBG] No PKCE used.
2019-08-29 15:18:24.038 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:24.040 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:24.041 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:24.044 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:24.044 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:18:24.045 +08:00 [INF] {"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCA491NJM6:00000004","TimeStamp":"2019-08-29T07:18:24.0000000Z","ProcessId":14200,"LocalIpAddress":"127.0.0.1:47409","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 15:18:24.062 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:24.062 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:24.069 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:18:24.069 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:18:24.070 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:18:24.070 +08:00 [DBG] Start authorize callback request
2019-08-29 15:18:24.072 +08:00 [DBG] User in authorize request: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:18:24.072 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:18:24.076 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:24.076 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:24.076 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:18:24.076 +08:00 [DBG] No PKCE used.
2019-08-29 15:18:24.077 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:24.080 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:24.081 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:24.084 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:24.084 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:18:24.084 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofMJ4NcWWNHAFBkTJvzyFOQhOy9cBzvl13Af2fJL2r0Tzx6ueVAn4yckjNvJU8oCxx3zBjQa6w4gbDA0og14rrX2rbYOLZQU8o4JoFqgM2VN_i7Ir9KJISvWfRJNoToJcs3lud4OfMGaqsUbEA5aouggaEQ9qzVN6KwLYiEfD_-EEjTbAG6kMyul0-G88xdbrhOjM7VWJwxGMvlQE1JJli9WjPAGmepngHFvK5jC5OOuPEyA-5-egiwIdcRnb2igwdOMdBvJzQ6v7BKB_Ioa8endMD5VkDgD9PSckhWlrlD-gfCzJijpp8Tb55_vXe8ERIA","UiLocales":null,"Nonce":"637026598190772527.MTQ0NWVhOGItMjIwYS00NGE4LTlmM2UtNjZiYWFlMzZlZThhYmZiY2NiMzktMTRhMi00ZGM5LTg2NjAtYmZjYThmNTYyYmVl","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"b799422c39f9d5b6c69245ae39468877","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026598190772527.MTQ0NWVhOGItMjIwYS00NGE4LTlmM2UtNjZiYWFlMzZlZThhYmZiY2NiMzktMTRhMi00ZGM5LTg2NjAtYmZjYThmNTYyYmVl","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofMJ4NcWWNHAFBkTJvzyFOQhOy9cBzvl13Af2fJL2r0Tzx6ueVAn4yckjNvJU8oCxx3zBjQa6w4gbDA0og14rrX2rbYOLZQU8o4JoFqgM2VN_i7Ir9KJISvWfRJNoToJcs3lud4OfMGaqsUbEA5aouggaEQ9qzVN6KwLYiEfD_-EEjTbAG6kMyul0-G88xdbrhOjM7VWJwxGMvlQE1JJli9WjPAGmepngHFvK5jC5OOuPEyA-5-egiwIdcRnb2igwdOMdBvJzQ6v7BKB_Ioa8endMD5VkDgD9PSckhWlrlD-gfCzJijpp8Tb55_vXe8ERIA","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:18:24.086 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 15:18:24.090 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 15:18:24.092 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 15:18:24.094 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:18:24.115 +08:00 [DBG] kiuoYhRJLbXX3dts2A2tm9jEsMqMMU7OplqbiiZXOVY= not found in database
2019-08-29 15:18:24.250 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-29 15:18:24.262 +08:00 [DBG] 4xzIw42f/sa0nG7p2kTYapCxtJ6Y54vH4whpZ7fLAMg= not found in database
2019-08-29 15:18:24.267 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 15:18:24.275 +08:00 [DBG] Getting claims for identity token for subject: 95af1c1c-f3ed-4192-a6ed-4d698bb57938 and client: mvc
2019-08-29 15:18:24.276 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 15:18:24.312 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****3YtA","$type":"Token"},{"TokenType":"code","TokenValue":"****47c3","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCA491NJM6:00000005","TimeStamp":"2019-08-29T07:18:24.0000000Z","ProcessId":14200,"LocalIpAddress":"127.0.0.1:47409","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:18:24.313 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofMJ4NcWWNHAFBkTJvzyFOQhOy9cBzvl13Af2fJL2r0Tzx6ueVAn4yckjNvJU8oCxx3zBjQa6w4gbDA0og14rrX2rbYOLZQU8o4JoFqgM2VN_i7Ir9KJISvWfRJNoToJcs3lud4OfMGaqsUbEA5aouggaEQ9qzVN6KwLYiEfD_-EEjTbAG6kMyul0-G88xdbrhOjM7VWJwxGMvlQE1JJli9WjPAGmepngHFvK5jC5OOuPEyA-5-egiwIdcRnb2igwdOMdBvJzQ6v7BKB_Ioa8endMD5VkDgD9PSckhWlrlD-gfCzJijpp8Tb55_vXe8ERIA","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 15:18:24.327 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:18:24.327 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:18:25.328 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:18:25.330 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:18:25.330 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:18:25.334 +08:00 [DBG] Start discovery request
2019-08-29 15:18:25.414 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:18:25.481 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:18:25.481 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:18:25.482 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:18:25.485 +08:00 [DBG] Start key discovery request
2019-08-29 15:18:25.530 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:18:25.533 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:18:25.533 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:18:25.539 +08:00 [DBG] Start token request.
2019-08-29 15:18:25.544 +08:00 [DBG] Start client validation
2019-08-29 15:18:25.548 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:18:25.551 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:18:25.552 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:18:25.552 +08:00 [DBG] Secret id found: mvc
2019-08-29 15:18:25.555 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:25.555 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:25.562 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:18:25.562 +08:00 [DBG] Client validation success
2019-08-29 15:18:25.562 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCA491NJM6:00000008","TimeStamp":"2019-08-29T07:18:25.0000000Z","ProcessId":14200,"LocalIpAddress":"127.0.0.1:47409","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:18:25.567 +08:00 [DBG] Start token request validation
2019-08-29 15:18:25.575 +08:00 [DBG] Start validation of authorization code token request
2019-08-29 15:18:25.587 +08:00 [DBG] 4xzIw42f/sa0nG7p2kTYapCxtJ6Y54vH4whpZ7fLAMg= found in database: true
2019-08-29 15:18:25.598 +08:00 [DBG] removing 4xzIw42f/sa0nG7p2kTYapCxtJ6Y54vH4whpZ7fLAMg= persisted grant from database
2019-08-29 15:18:25.612 +08:00 [DBG] Validation of authorization code token request success
2019-08-29 15:18:25.615 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"c60aae1c532b91d80c27d7c2fcb00a1cedca8ddeca508d6db4ce19050d4347c3","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"c60aae1c532b91d80c27d7c2fcb00a1cedca8ddeca508d6db4ce19050d4347c3","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:18:25.630 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:25.630 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:25.636 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:25.702 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:25.711 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-29 15:18:25.711 +08:00 [DBG] Getting claims for access token for subject: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:18:25.729 +08:00 [DBG] Creating refresh token
2019-08-29 15:18:25.729 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-29 15:18:25.738 +08:00 [DBG] wttZaiPVAQKEtTA13PvftzpnbZ53CmHBlKXJFSLALUY= not found in database
2019-08-29 15:18:25.744 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:25.744 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:25.745 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:25.747 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:18:25.748 +08:00 [DBG] Getting claims for identity token for subject: 95af1c1c-f3ed-4192-a6ed-4d698bb57938 and client: mvc
2019-08-29 15:18:25.748 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 15:18:25.754 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****PrlA","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****8eef","$type":"Token"},{"TokenType":"access_token","TokenValue":"****VlvQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCA491NJM6:00000008","TimeStamp":"2019-08-29T07:18:25.0000000Z","ProcessId":14200,"LocalIpAddress":"127.0.0.1:47409","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:18:25.755 +08:00 [DBG] Token request success.
2019-08-29 15:18:25.769 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-29 15:18:25.770 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-29 15:18:25.770 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-29 15:18:25.778 +08:00 [DBG] Start userinfo request
2019-08-29 15:18:25.781 +08:00 [DBG] Bearer token found in header
2019-08-29 15:18:25.802 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:25.802 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:25.808 +08:00 [DBG] mvc found in database: true
2019-08-29 15:18:25.808 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:18:25.812 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 15:18:25.813 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567063105,"exp":1567066705,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","auth_time":1567063101,"idp":"local","role":["zero.tenantRole1:45424f5c-6551-4cae-81d0-48b481a1c0d0","zero.Admin"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 15:18:25.820 +08:00 [DBG] Creating userinfo response
2019-08-29 15:18:25.823 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:18:25.825 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:18:25.828 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:25.829 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2019-08-29 15:18:25.829 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:18:25.830 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:18:25.833 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2019-08-29 15:18:25.833 +08:00 [DBG] End userinfo request
2019-08-29 15:18:32.018 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:18:32.018 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:18:32.018 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:18:32.018 +08:00 [DBG] Start discovery request
2019-08-29 15:18:32.022 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:18:32.181 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:18:32.181 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:18:32.181 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:18:32.181 +08:00 [DBG] Start key discovery request
2019-08-29 15:18:32.494 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:18:32.494 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:18:32.494 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:18:32.494 +08:00 [DBG] Start discovery request
2019-08-29 15:18:32.497 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:18:32.507 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:18:32.507 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:18:32.508 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:18:32.508 +08:00 [DBG] Start key discovery request
2019-08-29 15:18:32.530 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:18:32.531 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:18:32.531 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:18:32.531 +08:00 [DBG] Start token request.
2019-08-29 15:18:32.531 +08:00 [DBG] Start client validation
2019-08-29 15:18:32.531 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:18:32.531 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:18:32.531 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:18:32.531 +08:00 [DBG] Secret id found: client
2019-08-29 15:18:32.535 +08:00 [DBG] client found in database: true
2019-08-29 15:18:32.535 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 15:18:32.535 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:18:32.535 +08:00 [DBG] Client validation success
2019-08-29 15:18:32.535 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCA491NJM6:0000000E","TimeStamp":"2019-08-29T07:18:32.0000000Z","ProcessId":14200,"LocalIpAddress":"127.0.0.1:47409","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:18:32.535 +08:00 [DBG] Start token request validation
2019-08-29 15:18:32.539 +08:00 [DBG] Start client credentials token request validation
2019-08-29 15:18:32.544 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:18:32.573 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:18:32.574 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:18:32.576 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:18:32.577 +08:00 [DBG] client credentials token request validation success
2019-08-29 15:18:32.577 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:18:32.580 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 15:18:32.583 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****IsIw","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCA491NJM6:0000000E","TimeStamp":"2019-08-29T07:18:32.0000000Z","ProcessId":14200,"LocalIpAddress":"127.0.0.1:47409","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:18:32.583 +08:00 [DBG] Token request success.
2019-08-29 15:18:32.660 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:18:32.660 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:18:32.660 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:18:32.660 +08:00 [DBG] Start discovery request
2019-08-29 15:18:32.664 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:18:32.701 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:18:32.701 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:18:32.701 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:18:32.701 +08:00 [DBG] Start key discovery request
2019-08-29 15:18:56.236 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:18:56.278 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:18:56.278 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:18:56.278 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:18:56.278 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:18:56.278 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:18:56.278 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:18:56.409 +08:00 [DBG] Starting grant removal
2019-08-29 15:18:56.679 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:18:56.681 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:18:56.681 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:18:56.681 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:18:56.681 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:18:56.681 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:18:56.681 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:18:56.711 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:18:56.716 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:18:56.716 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:18:56.721 +08:00 [DBG] Start discovery request
2019-08-29 15:18:57.274 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:18:57.449 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:18:57.450 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:18:57.450 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:18:57.453 +08:00 [DBG] Start key discovery request
2019-08-29 15:18:57.787 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:18:57.787 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:18:57.787 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:18:57.788 +08:00 [DBG] Start discovery request
2019-08-29 15:18:57.791 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:18:57.801 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:18:57.801 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:18:57.801 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:18:57.802 +08:00 [DBG] Start key discovery request
2019-08-29 15:18:57.826 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:18:57.831 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:18:57.831 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:18:57.836 +08:00 [DBG] Start token request.
2019-08-29 15:18:57.841 +08:00 [DBG] Start client validation
2019-08-29 15:18:57.846 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:18:57.849 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:18:57.860 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:18:57.860 +08:00 [DBG] Secret id found: client
2019-08-29 15:18:58.062 +08:00 [DBG] client found in database: true
2019-08-29 15:18:58.070 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 15:18:58.076 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:18:58.077 +08:00 [DBG] Client validation success
2019-08-29 15:18:58.086 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCA4JQTV4B:00000005","TimeStamp":"2019-08-29T07:18:58.0000000Z","ProcessId":2600,"LocalIpAddress":"127.0.0.1:43848","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:18:58.094 +08:00 [DBG] Start token request validation
2019-08-29 15:18:58.100 +08:00 [DBG] Start client credentials token request validation
2019-08-29 15:18:58.130 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:18:58.191 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:18:58.198 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:18:58.200 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:18:58.202 +08:00 [DBG] client credentials token request validation success
2019-08-29 15:18:58.207 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:18:58.226 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 15:18:58.259 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****JiCA","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCA4JQTV4B:00000005","TimeStamp":"2019-08-29T07:18:58.0000000Z","ProcessId":2600,"LocalIpAddress":"127.0.0.1:43848","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:18:58.260 +08:00 [DBG] Token request success.
2019-08-29 15:18:58.923 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:18:58.923 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:18:58.923 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:18:58.923 +08:00 [DBG] Start discovery request
2019-08-29 15:18:58.927 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:18:58.988 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:18:58.989 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:18:58.989 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:18:58.989 +08:00 [DBG] Start key discovery request
2019-08-29 15:29:12.901 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:29:12.942 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:29:12.942 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:29:12.942 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:29:12.942 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:29:12.942 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:29:12.942 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:29:13.066 +08:00 [DBG] Starting grant removal
2019-08-29 15:29:13.302 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:29:13.303 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:29:13.303 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:29:13.303 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:29:13.303 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:29:13.303 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:29:13.303 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:29:13.332 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:29:13.337 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:29:13.337 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:29:13.340 +08:00 [DBG] Start discovery request
2019-08-29 15:29:13.960 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:29:14.139 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:29:14.140 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:29:14.140 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:29:14.143 +08:00 [DBG] Start key discovery request
2019-08-29 15:29:14.472 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:29:14.472 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:29:14.473 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:29:14.473 +08:00 [DBG] Start discovery request
2019-08-29 15:29:14.476 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:29:14.491 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:29:14.491 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:29:14.491 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:29:14.491 +08:00 [DBG] Start key discovery request
2019-08-29 15:29:14.513 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:29:14.518 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:29:14.518 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:29:14.524 +08:00 [DBG] Start token request.
2019-08-29 15:29:14.529 +08:00 [DBG] Start client validation
2019-08-29 15:29:14.534 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:29:14.536 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:29:14.548 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:29:14.548 +08:00 [DBG] Secret id found: client
2019-08-29 15:29:14.765 +08:00 [DBG] client found in database: true
2019-08-29 15:29:14.772 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 15:29:14.779 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:29:14.779 +08:00 [DBG] Client validation success
2019-08-29 15:29:14.790 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCAABJH8IC:00000005","TimeStamp":"2019-08-29T07:29:14.0000000Z","ProcessId":28040,"LocalIpAddress":"127.0.0.1:16138","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:29:14.798 +08:00 [DBG] Start token request validation
2019-08-29 15:29:14.804 +08:00 [DBG] Start client credentials token request validation
2019-08-29 15:29:14.834 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:29:14.897 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:29:14.904 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:29:14.906 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:29:14.909 +08:00 [DBG] client credentials token request validation success
2019-08-29 15:29:14.914 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:29:14.935 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 15:29:14.968 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****8bwQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCAABJH8IC:00000005","TimeStamp":"2019-08-29T07:29:14.0000000Z","ProcessId":28040,"LocalIpAddress":"127.0.0.1:16138","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:29:14.969 +08:00 [DBG] Token request success.
2019-08-29 15:29:15.617 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:29:15.617 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:29:15.617 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:29:15.617 +08:00 [DBG] Start discovery request
2019-08-29 15:29:15.620 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:29:15.683 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:29:15.684 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:29:15.684 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:29:15.684 +08:00 [DBG] Start key discovery request
2019-08-29 15:31:50.642 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:31:50.682 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:31:50.682 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:31:50.682 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:31:50.683 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:31:50.683 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:31:50.683 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:31:50.818 +08:00 [DBG] Starting grant removal
2019-08-29 15:31:51.009 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:31:51.010 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:31:51.010 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:31:51.010 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:31:51.010 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:31:51.011 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:31:51.011 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:31:55.281 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:31:55.285 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:31:55.285 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:31:55.288 +08:00 [DBG] Start discovery request
2019-08-29 15:31:55.573 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:31:55.750 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:31:55.750 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:31:55.750 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:31:55.754 +08:00 [DBG] Start key discovery request
2019-08-29 15:31:56.111 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:31:56.111 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:31:56.111 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:31:56.111 +08:00 [DBG] Start discovery request
2019-08-29 15:31:56.115 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:31:56.129 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:31:56.130 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:31:56.130 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:31:56.130 +08:00 [DBG] Start key discovery request
2019-08-29 15:31:56.160 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:31:56.164 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:31:56.164 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:31:56.170 +08:00 [DBG] Start token request.
2019-08-29 15:31:56.176 +08:00 [DBG] Start client validation
2019-08-29 15:31:56.180 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:31:56.183 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:31:56.195 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:31:56.195 +08:00 [DBG] Secret id found: client
2019-08-29 15:31:56.346 +08:00 [DBG] client found in database: true
2019-08-29 15:31:56.354 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 15:31:56.362 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:31:56.362 +08:00 [DBG] Client validation success
2019-08-29 15:31:56.372 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCABQJERD2:00000007","TimeStamp":"2019-08-29T07:31:56.0000000Z","ProcessId":28544,"LocalIpAddress":"127.0.0.1:2307","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:31:56.379 +08:00 [DBG] Start token request validation
2019-08-29 15:31:56.385 +08:00 [DBG] Start client credentials token request validation
2019-08-29 15:31:56.415 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:31:56.481 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:31:56.491 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:31:56.494 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:31:56.496 +08:00 [DBG] client credentials token request validation success
2019-08-29 15:31:56.501 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:31:56.521 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 15:31:56.554 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****iTOQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCABQJERD2:00000007","TimeStamp":"2019-08-29T07:31:56.0000000Z","ProcessId":28544,"LocalIpAddress":"127.0.0.1:2307","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:31:56.556 +08:00 [DBG] Token request success.
2019-08-29 15:31:57.240 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:31:57.240 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:31:57.240 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:31:57.240 +08:00 [DBG] Start discovery request
2019-08-29 15:31:57.244 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:31:57.308 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:31:57.308 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:31:57.308 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:31:57.308 +08:00 [DBG] Start key discovery request
2019-08-29 15:31:58.938 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:31:58.938 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:31:58.938 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:31:58.938 +08:00 [DBG] Start discovery request
2019-08-29 15:31:58.942 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:31:58.970 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:31:58.970 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:31:58.970 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:31:58.970 +08:00 [DBG] Start key discovery request
2019-08-29 15:31:58.999 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-29 15:31:59.000 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-29 15:31:59.000 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-29 15:31:59.006 +08:00 [DBG] Processing signout request for 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:31:59.013 +08:00 [DBG] Start end session request validation
2019-08-29 15:31:59.020 +08:00 [DBG] Start identity token validation
2019-08-29 15:31:59.032 +08:00 [DBG] mvc found in database: true
2019-08-29 15:31:59.032 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:31:59.032 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-29 15:31:59.061 +08:00 [WRN] No user found matching subject Id: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:31:59.062 +08:00 [ERR] User marked as not active: 95af1c1c-f3ed-4192-a6ed-4d698bb57938
2019-08-29 15:31:59.065 +08:00 [INF] End session request validation failure: Error validating id token hint
{"ClientId":null,"ClientName":null,"SubjectId":"unknown","PostLogOutUri":null,"State":null,"Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofNW_19xGor2L05tq7gYzFAcSdE7rh52b3J83nICyLV42La4U8y7mwZwZxyW_V_w7ta7JXXB0euP4rFgG6I6a8QFg7c3Xku9YKdjwUA9DDDmDBnZzaH3Vb2wVS-lFWcNNlndItFMtgfp3aa5g_11TyOf","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-29 15:31:59.066 +08:00 [ERR] Error processing end session request Invalid request
2019-08-29 15:32:00.132 +08:00 [DBG] CORS request made for path: /Account/Logout from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:32:00.164 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-29 15:32:00.164 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-29 15:32:00.165 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-29 15:32:00.165 +08:00 [INF] {"SubjectId":"95af1c1c-f3ed-4192-a6ed-4d698bb57938","DisplayName":"Alice Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLPCABQJERD2:0000000E","TimeStamp":"2019-08-29T07:32:00.0000000Z","ProcessId":28544,"LocalIpAddress":"127.0.0.1:2307","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-29 15:32:00.210 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-29 15:32:00.212 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-29 15:32:00.212 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-29 15:32:00.216 +08:00 [DBG] Processing signout callback request
2019-08-29 15:32:00.230 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:00.230 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:00.230 +08:00 [DBG] No client front-channel logout URLs
2019-08-29 15:32:00.230 +08:00 [DBG] No client back-channel logout URLs
2019-08-29 15:32:00.230 +08:00 [INF] Successful signout callback.
2019-08-29 15:32:00.230 +08:00 [DBG] No client front-channel iframe urls
2019-08-29 15:32:00.230 +08:00 [DBG] No client back-channel iframe urls
2019-08-29 15:32:04.472 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 15:32:04.474 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 15:32:04.474 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 15:32:04.477 +08:00 [DBG] Start authorize request
2019-08-29 15:32:04.481 +08:00 [DBG] No user present in authorize request
2019-08-29 15:32:04.487 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:04.492 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:04.492 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:04.503 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:32:04.504 +08:00 [DBG] No PKCE used.
2019-08-29 15:32:04.518 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:04.585 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:04.587 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:04.590 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:04.595 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:04.597 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOIzcVmVPhFdL_lFEhS1ql_qDwSdb21ta3j8S2fM_ssgaDm2uqT6zx7Xxev54zf1Ue6sUeoSwMxqTFuM8jjvSqNru03N9SVhm3PYBnfEmatMLNscJ5YiZpg1n8SPXaE_hyIThpj_HuHEIQaNBZZh6q1pFmW4mnt98_RClpbgMDgrrsHphclMbe62qB_pfdeqeqfAMjdZfleNfuRZSZ-GMD8VAMzT5wCKmOjZisEJtg0S4ROeIsvsyVUqrJxfyPmFYEDogZp-yrU2KPQtEWdLiHjr2xhabpC4VNsAdUQpc-yhNOXeHOUZrxnh41IZTj6zto","UiLocales":null,"Nonce":"637026607244615714.ODI0N2JjNjUtMGY2ZS00NDRkLWFjYjMtZDg5ZjZmMzM2MWVlMmQ5OGVlMDktZWE1NS00YzViLTgyMzktZWM0ZTA5MmJkODM5","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026607244615714.ODI0N2JjNjUtMGY2ZS00NDRkLWFjYjMtZDg5ZjZmMzM2MWVlMmQ5OGVlMDktZWE1NS00YzViLTgyMzktZWM0ZTA5MmJkODM5","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofOIzcVmVPhFdL_lFEhS1ql_qDwSdb21ta3j8S2fM_ssgaDm2uqT6zx7Xxev54zf1Ue6sUeoSwMxqTFuM8jjvSqNru03N9SVhm3PYBnfEmatMLNscJ5YiZpg1n8SPXaE_hyIThpj_HuHEIQaNBZZh6q1pFmW4mnt98_RClpbgMDgrrsHphclMbe62qB_pfdeqeqfAMjdZfleNfuRZSZ-GMD8VAMzT5wCKmOjZisEJtg0S4ROeIsvsyVUqrJxfyPmFYEDogZp-yrU2KPQtEWdLiHjr2xhabpC4VNsAdUQpc-yhNOXeHOUZrxnh41IZTj6zto","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:32:04.604 +08:00 [INF] Showing login: User is not authenticated
2019-08-29 15:32:04.633 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:04.636 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:04.636 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:04.637 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:32:04.637 +08:00 [DBG] No PKCE used.
2019-08-29 15:32:04.638 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:04.641 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:04.642 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:04.644 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:04.644 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:04.649 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:04.649 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:06.925 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:32:06.941 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:06.945 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:06.945 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:06.945 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:32:06.945 +08:00 [DBG] No PKCE used.
2019-08-29 15:32:06.947 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:06.949 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:06.950 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:06.953 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:06.953 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:07.072 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:32:07.074 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 15:32:07.075 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 15:32:07.075 +08:00 [DBG] Adding auth_time claim with value: 1567063927
2019-08-29 15:32:07.081 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:32:07.084 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","DisplayName":"alice","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPCABQJERD2:00000012","TimeStamp":"2019-08-29T07:32:07.0000000Z","ProcessId":28544,"LocalIpAddress":"127.0.0.1:2307","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 15:32:07.089 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:07.089 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:07.104 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:32:07.105 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:32:07.105 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:32:07.111 +08:00 [DBG] Start authorize callback request
2019-08-29 15:32:07.113 +08:00 [DBG] User in authorize request: e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:32:07.113 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:07.117 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:07.117 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:07.117 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:32:07.117 +08:00 [DBG] No PKCE used.
2019-08-29 15:32:07.118 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:07.121 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:07.122 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:07.124 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:07.124 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:07.124 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOIzcVmVPhFdL_lFEhS1ql_qDwSdb21ta3j8S2fM_ssgaDm2uqT6zx7Xxev54zf1Ue6sUeoSwMxqTFuM8jjvSqNru03N9SVhm3PYBnfEmatMLNscJ5YiZpg1n8SPXaE_hyIThpj_HuHEIQaNBZZh6q1pFmW4mnt98_RClpbgMDgrrsHphclMbe62qB_pfdeqeqfAMjdZfleNfuRZSZ-GMD8VAMzT5wCKmOjZisEJtg0S4ROeIsvsyVUqrJxfyPmFYEDogZp-yrU2KPQtEWdLiHjr2xhabpC4VNsAdUQpc-yhNOXeHOUZrxnh41IZTj6zto","UiLocales":null,"Nonce":"637026607244615714.ODI0N2JjNjUtMGY2ZS00NDRkLWFjYjMtZDg5ZjZmMzM2MWVlMmQ5OGVlMDktZWE1NS00YzViLTgyMzktZWM0ZTA5MmJkODM5","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"feaee4961a9d2a5863e491b0cb1b66d3","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026607244615714.ODI0N2JjNjUtMGY2ZS00NDRkLWFjYjMtZDg5ZjZmMzM2MWVlMmQ5OGVlMDktZWE1NS00YzViLTgyMzktZWM0ZTA5MmJkODM5","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofOIzcVmVPhFdL_lFEhS1ql_qDwSdb21ta3j8S2fM_ssgaDm2uqT6zx7Xxev54zf1Ue6sUeoSwMxqTFuM8jjvSqNru03N9SVhm3PYBnfEmatMLNscJ5YiZpg1n8SPXaE_hyIThpj_HuHEIQaNBZZh6q1pFmW4mnt98_RClpbgMDgrrsHphclMbe62qB_pfdeqeqfAMjdZfleNfuRZSZ-GMD8VAMzT5wCKmOjZisEJtg0S4ROeIsvsyVUqrJxfyPmFYEDogZp-yrU2KPQtEWdLiHjr2xhabpC4VNsAdUQpc-yhNOXeHOUZrxnh41IZTj6zto","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:32:07.136 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 15:32:07.136 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 15:32:07.158 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:07.161 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:07.162 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:07.162 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:32:07.162 +08:00 [DBG] No PKCE used.
2019-08-29 15:32:07.163 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:07.166 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:07.167 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:07.169 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:07.169 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:07.173 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:07.173 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:07.179 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:07.250 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:08.599 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:32:08.615 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:08.620 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:08.620 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:08.620 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:32:08.620 +08:00 [DBG] No PKCE used.
2019-08-29 15:32:08.622 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:08.625 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:08.626 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:08.629 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:08.629 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:08.630 +08:00 [INF] {"SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCABQJERD2:00000015","TimeStamp":"2019-08-29T07:32:08.0000000Z","ProcessId":28544,"LocalIpAddress":"127.0.0.1:2307","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 15:32:08.643 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:08.643 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:08.651 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:32:08.652 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:32:08.653 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:32:08.653 +08:00 [DBG] Start authorize callback request
2019-08-29 15:32:08.655 +08:00 [DBG] User in authorize request: e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:32:08.655 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:08.658 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:08.658 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:08.658 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:32:08.658 +08:00 [DBG] No PKCE used.
2019-08-29 15:32:08.660 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:08.663 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:08.665 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:08.667 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:08.667 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:08.667 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOIzcVmVPhFdL_lFEhS1ql_qDwSdb21ta3j8S2fM_ssgaDm2uqT6zx7Xxev54zf1Ue6sUeoSwMxqTFuM8jjvSqNru03N9SVhm3PYBnfEmatMLNscJ5YiZpg1n8SPXaE_hyIThpj_HuHEIQaNBZZh6q1pFmW4mnt98_RClpbgMDgrrsHphclMbe62qB_pfdeqeqfAMjdZfleNfuRZSZ-GMD8VAMzT5wCKmOjZisEJtg0S4ROeIsvsyVUqrJxfyPmFYEDogZp-yrU2KPQtEWdLiHjr2xhabpC4VNsAdUQpc-yhNOXeHOUZrxnh41IZTj6zto","UiLocales":null,"Nonce":"637026607244615714.ODI0N2JjNjUtMGY2ZS00NDRkLWFjYjMtZDg5ZjZmMzM2MWVlMmQ5OGVlMDktZWE1NS00YzViLTgyMzktZWM0ZTA5MmJkODM5","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"feaee4961a9d2a5863e491b0cb1b66d3","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026607244615714.ODI0N2JjNjUtMGY2ZS00NDRkLWFjYjMtZDg5ZjZmMzM2MWVlMmQ5OGVlMDktZWE1NS00YzViLTgyMzktZWM0ZTA5MmJkODM5","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofOIzcVmVPhFdL_lFEhS1ql_qDwSdb21ta3j8S2fM_ssgaDm2uqT6zx7Xxev54zf1Ue6sUeoSwMxqTFuM8jjvSqNru03N9SVhm3PYBnfEmatMLNscJ5YiZpg1n8SPXaE_hyIThpj_HuHEIQaNBZZh6q1pFmW4mnt98_RClpbgMDgrrsHphclMbe62qB_pfdeqeqfAMjdZfleNfuRZSZ-GMD8VAMzT5wCKmOjZisEJtg0S4ROeIsvsyVUqrJxfyPmFYEDogZp-yrU2KPQtEWdLiHjr2xhabpC4VNsAdUQpc-yhNOXeHOUZrxnh41IZTj6zto","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:32:08.669 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 15:32:08.676 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 15:32:08.676 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 15:32:08.680 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:32:08.701 +08:00 [DBG] /KaZjp6HxT9WJMcflLti3h1mNUVl3QRPyvAd8tORG8o= not found in database
2019-08-29 15:32:08.730 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-29 15:32:08.742 +08:00 [DBG] 7m4urGaR84NLhYIRQIcURB7PSqyLlP07EhD9x1MNqq4= not found in database
2019-08-29 15:32:08.746 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 15:32:08.753 +08:00 [DBG] Getting claims for identity token for subject: e45309cc-a319-4868-b9b6-03da359ce143 and client: mvc
2019-08-29 15:32:08.755 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 15:32:08.761 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****WhIg","$type":"Token"},{"TokenType":"code","TokenValue":"****6071","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCABQJERD2:00000016","TimeStamp":"2019-08-29T07:32:08.0000000Z","ProcessId":28544,"LocalIpAddress":"127.0.0.1:2307","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:32:08.763 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOIzcVmVPhFdL_lFEhS1ql_qDwSdb21ta3j8S2fM_ssgaDm2uqT6zx7Xxev54zf1Ue6sUeoSwMxqTFuM8jjvSqNru03N9SVhm3PYBnfEmatMLNscJ5YiZpg1n8SPXaE_hyIThpj_HuHEIQaNBZZh6q1pFmW4mnt98_RClpbgMDgrrsHphclMbe62qB_pfdeqeqfAMjdZfleNfuRZSZ-GMD8VAMzT5wCKmOjZisEJtg0S4ROeIsvsyVUqrJxfyPmFYEDogZp-yrU2KPQtEWdLiHjr2xhabpC4VNsAdUQpc-yhNOXeHOUZrxnh41IZTj6zto","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 15:32:08.772 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:32:08.773 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:32:08.906 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:32:08.907 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:32:08.907 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:32:08.907 +08:00 [DBG] Start token request.
2019-08-29 15:32:08.907 +08:00 [DBG] Start client validation
2019-08-29 15:32:08.907 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:32:08.908 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:32:08.908 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:32:08.908 +08:00 [DBG] Secret id found: mvc
2019-08-29 15:32:08.912 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:08.912 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:08.913 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:32:08.913 +08:00 [DBG] Client validation success
2019-08-29 15:32:08.913 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCABQJERD2:00000017","TimeStamp":"2019-08-29T07:32:08.0000000Z","ProcessId":28544,"LocalIpAddress":"127.0.0.1:2307","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:32:08.913 +08:00 [DBG] Start token request validation
2019-08-29 15:32:08.921 +08:00 [DBG] Start validation of authorization code token request
2019-08-29 15:32:08.934 +08:00 [DBG] 7m4urGaR84NLhYIRQIcURB7PSqyLlP07EhD9x1MNqq4= found in database: true
2019-08-29 15:32:08.948 +08:00 [DBG] removing 7m4urGaR84NLhYIRQIcURB7PSqyLlP07EhD9x1MNqq4= persisted grant from database
2019-08-29 15:32:08.962 +08:00 [DBG] Validation of authorization code token request success
2019-08-29 15:32:08.964 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"07ced6bda92a4efa445f8122d23ef32b1d9651e3860efcd98a64a3ee48566071","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"07ced6bda92a4efa445f8122d23ef32b1d9651e3860efcd98a64a3ee48566071","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:32:08.975 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:08.975 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:08.981 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:09.051 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:09.051 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-29 15:32:09.051 +08:00 [DBG] Getting claims for access token for subject: e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:32:09.069 +08:00 [DBG] Creating refresh token
2019-08-29 15:32:09.069 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-29 15:32:09.078 +08:00 [DBG] 8HAlVRvZf67jb65tomlZMM3BQbGp0yjVNbNW5X7qJCs= not found in database
2019-08-29 15:32:09.084 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:09.085 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:09.086 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:09.089 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:32:09.089 +08:00 [DBG] Getting claims for identity token for subject: e45309cc-a319-4868-b9b6-03da359ce143 and client: mvc
2019-08-29 15:32:09.089 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 15:32:09.094 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****Ao1Q","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****9071","$type":"Token"},{"TokenType":"access_token","TokenValue":"****iZ0Q","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCABQJERD2:00000017","TimeStamp":"2019-08-29T07:32:09.0000000Z","ProcessId":28544,"LocalIpAddress":"127.0.0.1:2307","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:32:09.094 +08:00 [DBG] Token request success.
2019-08-29 15:32:09.107 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-29 15:32:09.108 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-29 15:32:09.108 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-29 15:32:09.114 +08:00 [DBG] Start userinfo request
2019-08-29 15:32:09.118 +08:00 [DBG] Bearer token found in header
2019-08-29 15:32:09.136 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:09.136 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:09.140 +08:00 [DBG] mvc found in database: true
2019-08-29 15:32:09.140 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:32:09.144 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 15:32:09.145 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567063929,"exp":1567067529,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"e45309cc-a319-4868-b9b6-03da359ce143","auth_time":1567063927,"idp":"local","role":["zero.tenantRole1:94594013-3023-4349-806e-c2e93a044dcc","zero.Admin"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 15:32:09.154 +08:00 [DBG] Creating userinfo response
2019-08-29 15:32:09.158 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:32:09.160 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:32:09.164 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:09.164 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2019-08-29 15:32:09.164 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:32:09.165 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:32:09.169 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2019-08-29 15:32:09.169 +08:00 [DBG] End userinfo request
2019-08-29 15:32:24.792 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 15:32:24.795 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 15:32:24.795 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 15:32:24.796 +08:00 [DBG] Start authorize request
2019-08-29 15:32:24.796 +08:00 [DBG] User in authorize request: e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:32:24.796 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:24.804 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:32:24.804 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:32:24.805 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:32:24.808 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:32:24.809 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:32:24.811 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:32:24.811 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:24.812 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjMyOjI0IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"feaee4961a9d2a5863e491b0cb1b66d3","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE1OjMyOjI0IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:32:24.814 +08:00 [DBG] qobG3q2jwqoNKGV9915cuhhGQ7dFEUXtlCycC38LOPs= found in database: false
2019-08-29 15:32:24.814 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|e45309cc-a319-4868-b9b6-03da359ce143 not found in store.
2019-08-29 15:32:24.814 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 15:32:24.814 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 15:32:24.823 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:24.826 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:32:24.826 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:32:24.827 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:32:24.829 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:32:24.830 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:32:24.832 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:32:24.832 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:24.836 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:32:24.836 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:32:24.836 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:32:24.839 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:32:26.447 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:32:26.449 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:26.453 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:32:26.453 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:32:26.454 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:32:26.456 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:32:26.457 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:32:26.459 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:32:26.459 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:26.459 +08:00 [INF] {"SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","ClientId":"zero_identity_api_swaggerui","RequestedScopes":["zero_identity_api"],"GrantedScopes":["zero_identity_api"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCABQJERD2:0000001B","TimeStamp":"2019-08-29T07:32:26.0000000Z","ProcessId":28544,"LocalIpAddress":"127.0.0.1:2307","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 15:32:26.462 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:32:26.462 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:32:26.469 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:32:26.470 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:32:26.470 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:32:26.470 +08:00 [DBG] Start authorize callback request
2019-08-29 15:32:26.470 +08:00 [DBG] User in authorize request: e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:32:26.470 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:32:26.474 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:32:26.474 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:32:26.474 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:32:26.477 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:32:26.478 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:32:26.480 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:32:26.480 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:32:26.480 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjMyOjI0IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"feaee4961a9d2a5863e491b0cb1b66d3","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE1OjMyOjI0IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:32:26.482 +08:00 [DBG] qobG3q2jwqoNKGV9915cuhhGQ7dFEUXtlCycC38LOPs= found in database: false
2019-08-29 15:32:26.482 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|e45309cc-a319-4868-b9b6-03da359ce143 not found in store.
2019-08-29 15:32:26.482 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 15:32:26.482 +08:00 [INF] User consented to scopes: ["zero_identity_api"]
2019-08-29 15:32:26.482 +08:00 [DBG] User indicated to remember consent for scopes: ["zero_identity_api"]
2019-08-29 15:32:26.482 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:32:26.482 +08:00 [DBG] qobG3q2jwqoNKGV9915cuhhGQ7dFEUXtlCycC38LOPs= not found in database
2019-08-29 15:32:26.484 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 15:32:26.484 +08:00 [DBG] Getting claims for access token for client: zero_identity_api_swaggerui
2019-08-29 15:32:26.485 +08:00 [DBG] Getting claims for access token for subject: e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:32:26.493 +08:00 [INF] {"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","Endpoint":"Authorize","SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","Scopes":"zero_identity_api","GrantType":"implicit","Tokens":[{"TokenType":"access_token","TokenValue":"****kH0w","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCABQJERD2:0000001C","TimeStamp":"2019-08-29T07:32:26.0000000Z","ProcessId":28544,"LocalIpAddress":"127.0.0.1:2307","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:32:26.493 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","ClientId":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","State":"VGh1IEF1ZyAyOSAyMDE5IDE1OjMyOjI0IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","Scope":"zero_identity_api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 15:32:26.493 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:32:26.494 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:34:17.607 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:34:17.648 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:34:17.648 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:34:17.648 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:34:17.648 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:34:17.648 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:34:17.648 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:34:17.772 +08:00 [DBG] Starting grant removal
2019-08-29 15:34:17.981 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:34:17.983 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:34:17.983 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:34:17.983 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:34:17.983 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:34:17.983 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:34:17.983 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:34:18.011 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:34:18.016 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:34:18.016 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:34:18.019 +08:00 [DBG] Start discovery request
2019-08-29 15:34:18.565 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:34:18.754 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:34:18.754 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:34:18.754 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:34:18.758 +08:00 [DBG] Start key discovery request
2019-08-29 15:34:19.091 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:34:19.091 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:34:19.091 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:34:19.091 +08:00 [DBG] Start discovery request
2019-08-29 15:34:19.095 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:34:19.109 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:34:19.110 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:34:19.110 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:34:19.110 +08:00 [DBG] Start key discovery request
2019-08-29 15:34:19.130 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:34:19.134 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:34:19.134 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:34:19.141 +08:00 [DBG] Start token request.
2019-08-29 15:34:19.146 +08:00 [DBG] Start client validation
2019-08-29 15:34:19.150 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:34:19.153 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:34:19.166 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:34:19.166 +08:00 [DBG] Secret id found: client
2019-08-29 15:34:19.351 +08:00 [DBG] client found in database: true
2019-08-29 15:34:19.359 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 15:34:19.365 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:34:19.365 +08:00 [DBG] Client validation success
2019-08-29 15:34:19.376 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCAD6D6UVT:00000005","TimeStamp":"2019-08-29T07:34:19.0000000Z","ProcessId":26016,"LocalIpAddress":"127.0.0.1:29848","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:34:19.384 +08:00 [DBG] Start token request validation
2019-08-29 15:34:19.390 +08:00 [DBG] Start client credentials token request validation
2019-08-29 15:34:19.419 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:34:19.453 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:34:19.460 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:34:19.463 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:34:19.465 +08:00 [DBG] client credentials token request validation success
2019-08-29 15:34:19.470 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:34:19.489 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 15:34:19.523 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****XmtQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCAD6D6UVT:00000005","TimeStamp":"2019-08-29T07:34:19.0000000Z","ProcessId":26016,"LocalIpAddress":"127.0.0.1:29848","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:34:19.524 +08:00 [DBG] Token request success.
2019-08-29 15:34:20.223 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:34:20.223 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:34:20.223 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:34:20.223 +08:00 [DBG] Start discovery request
2019-08-29 15:34:20.227 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:34:20.289 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:34:20.289 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:34:20.289 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:34:20.289 +08:00 [DBG] Start key discovery request
2019-08-29 15:35:35.370 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:35:35.413 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:35:35.414 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:35:35.414 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:35:35.414 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:35:35.414 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:35:35.414 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:35:35.542 +08:00 [DBG] Starting grant removal
2019-08-29 15:35:35.817 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:35:35.819 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:35:35.819 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:35:35.819 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:35:35.819 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:35:35.819 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:35:35.819 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:35:35.849 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:35:35.853 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:35:35.853 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:35:35.856 +08:00 [DBG] Start discovery request
2019-08-29 15:35:36.428 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:35:36.608 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:35:36.609 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:35:36.609 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:35:36.613 +08:00 [DBG] Start key discovery request
2019-08-29 15:35:36.960 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:35:36.960 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:35:36.960 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:35:36.961 +08:00 [DBG] Start discovery request
2019-08-29 15:35:36.965 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:35:36.977 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:35:36.978 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:35:36.978 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:35:36.978 +08:00 [DBG] Start key discovery request
2019-08-29 15:35:37.004 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:35:37.008 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:35:37.008 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:35:37.015 +08:00 [DBG] Start token request.
2019-08-29 15:35:37.019 +08:00 [DBG] Start client validation
2019-08-29 15:35:37.024 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:35:37.027 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:35:37.041 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:35:37.041 +08:00 [DBG] Secret id found: client
2019-08-29 15:35:37.262 +08:00 [DBG] client found in database: true
2019-08-29 15:35:37.270 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 15:35:37.277 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:35:37.277 +08:00 [DBG] Client validation success
2019-08-29 15:35:37.288 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCADTJELC2:00000005","TimeStamp":"2019-08-29T07:35:37.0000000Z","ProcessId":29428,"LocalIpAddress":"127.0.0.1:14718","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:35:37.298 +08:00 [DBG] Start token request validation
2019-08-29 15:35:37.304 +08:00 [DBG] Start client credentials token request validation
2019-08-29 15:35:37.338 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:35:37.375 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:35:37.381 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:35:37.383 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:35:37.385 +08:00 [DBG] client credentials token request validation success
2019-08-29 15:35:37.390 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:35:37.410 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 15:35:37.441 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****Jj4Q","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCADTJELC2:00000005","TimeStamp":"2019-08-29T07:35:37.0000000Z","ProcessId":29428,"LocalIpAddress":"127.0.0.1:14718","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:35:37.443 +08:00 [DBG] Token request success.
2019-08-29 15:35:38.102 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:35:38.102 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:35:38.102 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:35:38.102 +08:00 [DBG] Start discovery request
2019-08-29 15:35:38.106 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:35:38.169 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:35:38.170 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:35:38.170 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:35:38.170 +08:00 [DBG] Start key discovery request
2019-08-29 15:38:52.872 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:38:52.873 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:38:52.873 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:38:52.873 +08:00 [DBG] Start discovery request
2019-08-29 15:38:52.876 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:38:53.110 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:38:53.110 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:38:53.110 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:38:53.110 +08:00 [DBG] Start key discovery request
2019-08-29 15:39:09.838 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:39:09.839 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:39:09.839 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:39:09.839 +08:00 [DBG] Start discovery request
2019-08-29 15:39:09.842 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:39:09.897 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:39:09.897 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:39:09.897 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:39:09.897 +08:00 [DBG] Start key discovery request
2019-08-29 15:39:17.457 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:39:17.458 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:39:17.458 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:39:17.458 +08:00 [DBG] Start token request.
2019-08-29 15:39:17.458 +08:00 [DBG] Start client validation
2019-08-29 15:39:17.458 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:39:17.458 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:39:17.459 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:39:17.459 +08:00 [DBG] Secret id found: client
2019-08-29 15:39:17.479 +08:00 [DBG] client found in database: true
2019-08-29 15:39:17.479 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 15:39:17.479 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:39:17.479 +08:00 [DBG] Client validation success
2019-08-29 15:39:17.479 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCADTJELC3:00000005","TimeStamp":"2019-08-29T07:39:17.0000000Z","ProcessId":29428,"LocalIpAddress":"127.0.0.1:14718","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:39:17.479 +08:00 [DBG] Start token request validation
2019-08-29 15:39:17.479 +08:00 [DBG] Start client credentials token request validation
2019-08-29 15:39:17.482 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:39:17.514 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:39:17.515 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:39:17.517 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:39:17.517 +08:00 [DBG] client credentials token request validation success
2019-08-29 15:39:17.517 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:39:17.517 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 15:39:17.521 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****njOg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCADTJELC3:00000005","TimeStamp":"2019-08-29T07:39:17.0000000Z","ProcessId":29428,"LocalIpAddress":"127.0.0.1:14718","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:39:17.522 +08:00 [DBG] Token request success.
2019-08-29 15:55:31.765 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:55:31.800 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:55:31.800 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:55:31.800 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:55:31.800 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:55:31.800 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:55:31.800 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:55:31.924 +08:00 [DBG] Starting grant removal
2019-08-29 15:55:32.082 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:55:32.083 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:55:32.083 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:55:32.083 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:55:32.083 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:55:32.083 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:55:32.083 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:55:49.967 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:55:49.970 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:55:49.970 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:55:49.973 +08:00 [DBG] Start discovery request
2019-08-29 15:55:50.241 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:55:50.410 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:55:50.411 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:55:50.411 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:55:50.414 +08:00 [DBG] Start key discovery request
2019-08-29 15:55:50.751 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:55:50.751 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:55:50.751 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:55:50.751 +08:00 [DBG] Start discovery request
2019-08-29 15:55:50.755 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:55:50.768 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:55:50.769 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:55:50.769 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:55:50.769 +08:00 [DBG] Start key discovery request
2019-08-29 15:55:50.793 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:55:50.797 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:55:50.797 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:55:50.803 +08:00 [DBG] Start token request.
2019-08-29 15:55:50.809 +08:00 [DBG] Start client validation
2019-08-29 15:55:50.817 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:55:50.821 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:55:50.835 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:55:50.836 +08:00 [DBG] Secret id found: client
2019-08-29 15:55:50.971 +08:00 [DBG] client found in database: true
2019-08-29 15:55:50.979 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 15:55:50.985 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:55:50.985 +08:00 [DBG] Client validation success
2019-08-29 15:55:50.995 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCAP23SOAR:00000007","TimeStamp":"2019-08-29T07:55:50.0000000Z","ProcessId":18964,"LocalIpAddress":"127.0.0.1:22161","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:55:51.002 +08:00 [DBG] Start token request validation
2019-08-29 15:55:51.007 +08:00 [DBG] Start client credentials token request validation
2019-08-29 15:55:51.037 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:55:51.101 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:55:51.108 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:55:51.110 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:55:51.113 +08:00 [DBG] client credentials token request validation success
2019-08-29 15:55:51.118 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:55:51.136 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 15:55:51.168 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****NPqg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCAP23SOAR:00000007","TimeStamp":"2019-08-29T07:55:51.0000000Z","ProcessId":18964,"LocalIpAddress":"127.0.0.1:22161","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:55:51.170 +08:00 [DBG] Token request success.
2019-08-29 15:55:51.838 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:55:51.839 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:55:51.839 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:55:51.839 +08:00 [DBG] Start discovery request
2019-08-29 15:55:51.842 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:55:51.904 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:55:51.905 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:55:51.905 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:55:51.905 +08:00 [DBG] Start key discovery request
2019-08-29 15:56:13.754 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:56:13.754 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:56:13.754 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:56:13.754 +08:00 [DBG] Start discovery request
2019-08-29 15:56:13.758 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:56:13.986 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:56:13.987 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:56:13.987 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:56:13.987 +08:00 [DBG] Start key discovery request
2019-08-29 15:56:14.641 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:56:14.641 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:56:14.641 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:56:14.641 +08:00 [DBG] Start discovery request
2019-08-29 15:56:14.644 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:56:14.705 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:56:14.705 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:56:14.705 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:56:14.705 +08:00 [DBG] Start key discovery request
2019-08-29 15:56:14.766 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:56:14.767 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:56:14.767 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:56:14.767 +08:00 [DBG] Start token request.
2019-08-29 15:56:14.767 +08:00 [DBG] Start client validation
2019-08-29 15:56:14.767 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:56:14.767 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:56:14.768 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:56:14.768 +08:00 [DBG] Secret id found: client
2019-08-29 15:56:14.772 +08:00 [DBG] client found in database: true
2019-08-29 15:56:14.773 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 15:56:14.773 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:56:14.773 +08:00 [DBG] Client validation success
2019-08-29 15:56:14.773 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCAP23SOAR:0000000E","TimeStamp":"2019-08-29T07:56:14.0000000Z","ProcessId":18964,"LocalIpAddress":"127.0.0.1:22161","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:56:14.773 +08:00 [DBG] Start token request validation
2019-08-29 15:56:14.773 +08:00 [DBG] Start client credentials token request validation
2019-08-29 15:56:14.774 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:56:14.777 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:56:14.778 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:56:14.780 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:56:14.780 +08:00 [DBG] client credentials token request validation success
2019-08-29 15:56:14.780 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:56:14.780 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 15:56:14.785 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****lDwQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCAP23SOAR:0000000E","TimeStamp":"2019-08-29T07:56:14.0000000Z","ProcessId":18964,"LocalIpAddress":"127.0.0.1:22161","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:56:14.785 +08:00 [DBG] Token request success.
2019-08-29 15:57:24.399 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 15:57:24.445 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 15:57:24.445 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 15:57:24.445 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 15:57:24.445 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 15:57:24.445 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 15:57:24.445 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 15:57:24.573 +08:00 [DBG] Starting grant removal
2019-08-29 15:57:24.806 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 15:57:24.807 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 15:57:24.807 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 15:57:24.807 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 15:57:24.807 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 15:57:24.807 +08:00 [DBG] Error Url: /home/error
2019-08-29 15:57:24.807 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 15:57:24.836 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:57:24.840 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:57:24.840 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:57:24.843 +08:00 [DBG] Start discovery request
2019-08-29 15:57:25.420 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:57:25.598 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:57:25.599 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:57:25.599 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:57:25.602 +08:00 [DBG] Start key discovery request
2019-08-29 15:57:25.928 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:57:25.928 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:57:25.928 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:57:25.928 +08:00 [DBG] Start discovery request
2019-08-29 15:57:25.931 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:57:25.941 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:57:25.942 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:57:25.942 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:57:25.942 +08:00 [DBG] Start key discovery request
2019-08-29 15:57:25.967 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:57:25.972 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:57:25.972 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:57:25.978 +08:00 [DBG] Start token request.
2019-08-29 15:57:25.982 +08:00 [DBG] Start client validation
2019-08-29 15:57:25.987 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:57:25.991 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:57:26.002 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:57:26.002 +08:00 [DBG] Secret id found: client
2019-08-29 15:57:26.203 +08:00 [DBG] client found in database: true
2019-08-29 15:57:26.211 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 15:57:26.218 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:57:26.218 +08:00 [DBG] Client validation success
2019-08-29 15:57:26.228 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCAQ3MVG7D:00000005","TimeStamp":"2019-08-29T07:57:26.0000000Z","ProcessId":7028,"LocalIpAddress":"127.0.0.1:20132","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:57:26.236 +08:00 [DBG] Start token request validation
2019-08-29 15:57:26.242 +08:00 [DBG] Start client credentials token request validation
2019-08-29 15:57:26.273 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:57:26.342 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:57:26.349 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 15:57:26.351 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 15:57:26.354 +08:00 [DBG] client credentials token request validation success
2019-08-29 15:57:26.359 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:57:26.380 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 15:57:26.415 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****37uw","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCAQ3MVG7D:00000005","TimeStamp":"2019-08-29T07:57:26.0000000Z","ProcessId":7028,"LocalIpAddress":"127.0.0.1:20132","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:57:26.416 +08:00 [DBG] Token request success.
2019-08-29 15:57:27.220 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:57:27.220 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:57:27.220 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:57:27.220 +08:00 [DBG] Start discovery request
2019-08-29 15:57:27.223 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:57:27.286 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:57:27.286 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:57:27.287 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:57:27.287 +08:00 [DBG] Start key discovery request
2019-08-29 15:57:38.452 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 15:57:38.452 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 15:57:38.452 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 15:57:38.452 +08:00 [DBG] Start discovery request
2019-08-29 15:57:38.456 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 15:57:38.481 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 15:57:38.481 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 15:57:38.481 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 15:57:38.481 +08:00 [DBG] Start key discovery request
2019-08-29 15:57:38.513 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-29 15:57:38.514 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-29 15:57:38.514 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-29 15:57:38.520 +08:00 [DBG] Processing signout request for e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:57:38.524 +08:00 [DBG] Start end session request validation
2019-08-29 15:57:38.529 +08:00 [DBG] Start identity token validation
2019-08-29 15:57:38.540 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:38.540 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:38.540 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-29 15:57:38.565 +08:00 [WRN] No user found matching subject Id: e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:57:38.566 +08:00 [ERR] User marked as not active: e45309cc-a319-4868-b9b6-03da359ce143
2019-08-29 15:57:38.569 +08:00 [INF] End session request validation failure: Error validating id token hint
{"ClientId":null,"ClientName":null,"SubjectId":"unknown","PostLogOutUri":null,"State":null,"Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofNys83pyhdd9ggXRnUvO9oznQ9QCAlAE7zFModmDyJq-0SPvt8_4QM2dYOTc5d66rkdnmYKg7vDjHkQQDmannWgRCuwtxG_7nPGeIIPwLlMFvkKBxFMKRuQoaJQZnhR0IHXqXEKJoMn--TI3IsMrD-m","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-29 15:57:38.570 +08:00 [ERR] Error processing end session request Invalid request
2019-08-29 15:57:39.984 +08:00 [DBG] CORS request made for path: /Account/Logout from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:57:40.015 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-29 15:57:40.015 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-29 15:57:40.015 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-29 15:57:40.016 +08:00 [INF] {"SubjectId":"e45309cc-a319-4868-b9b6-03da359ce143","DisplayName":"Alice Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLPCAQ3MVG7D:0000000C","TimeStamp":"2019-08-29T07:57:40.0000000Z","ProcessId":7028,"LocalIpAddress":"127.0.0.1:20132","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-29 15:57:40.071 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-29 15:57:40.073 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-29 15:57:40.073 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-29 15:57:40.078 +08:00 [DBG] Processing signout callback request
2019-08-29 15:57:40.091 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:40.091 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:40.094 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 15:57:40.094 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 15:57:40.094 +08:00 [DBG] No client front-channel logout URLs
2019-08-29 15:57:40.094 +08:00 [DBG] No client back-channel logout URLs
2019-08-29 15:57:40.094 +08:00 [INF] Successful signout callback.
2019-08-29 15:57:40.094 +08:00 [DBG] No client front-channel iframe urls
2019-08-29 15:57:40.094 +08:00 [DBG] No client back-channel iframe urls
2019-08-29 15:57:44.338 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 15:57:44.339 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 15:57:44.339 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 15:57:44.343 +08:00 [DBG] Start authorize request
2019-08-29 15:57:44.347 +08:00 [DBG] No user present in authorize request
2019-08-29 15:57:44.351 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:57:44.357 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:44.357 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:44.367 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:57:44.368 +08:00 [DBG] No PKCE used.
2019-08-29 15:57:44.383 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:44.454 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:44.456 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:44.459 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:44.465 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:57:44.467 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOFh0wNg5JRQsbQXufAlXpml8HBYySNgvgzvvgFq2yeS5Ur0hpMiiSNtQ1Xgx7xojEkaAn75t3X0AoPiCbyp_6r9rE_A2Z4FQAoEhDMJN1hClY6ElhnXqS-uHiQKrDO_-Morcg16NbjdzuPPdo5R4hF9xofNp1SwKWvi38YrAZtl5XwtX0z2rMnW2g2mp4NCuc0HhOD2foOjd4tUHz8FTGFRfL7WyZKyqwAiPSJzi0d7RR4PeUCBvtr0_iFman4eo0MeS806Tbco8RngSDjIAopQjYuFRdfNzAiOidWZx_X5nMU0qaVz0DlAin8IyYZxlI","UiLocales":null,"Nonce":"637026622643323594.MDY2N2M4ZjYtMGIwNS00MGM3LTkyMzMtYTM3ZTcwMDI0YzNhM2IzOGY1OGMtZTc3MS00ZmJiLWFiNzktMDE4NzY0NzRkNWU3","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026622643323594.MDY2N2M4ZjYtMGIwNS00MGM3LTkyMzMtYTM3ZTcwMDI0YzNhM2IzOGY1OGMtZTc3MS00ZmJiLWFiNzktMDE4NzY0NzRkNWU3","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofOFh0wNg5JRQsbQXufAlXpml8HBYySNgvgzvvgFq2yeS5Ur0hpMiiSNtQ1Xgx7xojEkaAn75t3X0AoPiCbyp_6r9rE_A2Z4FQAoEhDMJN1hClY6ElhnXqS-uHiQKrDO_-Morcg16NbjdzuPPdo5R4hF9xofNp1SwKWvi38YrAZtl5XwtX0z2rMnW2g2mp4NCuc0HhOD2foOjd4tUHz8FTGFRfL7WyZKyqwAiPSJzi0d7RR4PeUCBvtr0_iFman4eo0MeS806Tbco8RngSDjIAopQjYuFRdfNzAiOidWZx_X5nMU0qaVz0DlAin8IyYZxlI","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:57:44.474 +08:00 [INF] Showing login: User is not authenticated
2019-08-29 15:57:44.496 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:57:44.500 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:44.500 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:44.500 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:57:44.500 +08:00 [DBG] No PKCE used.
2019-08-29 15:57:44.501 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:44.504 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:44.505 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:44.507 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:44.507 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:57:44.512 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:44.512 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:46.117 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:57:46.137 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:57:46.145 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:46.145 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:46.145 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:57:46.145 +08:00 [DBG] No PKCE used.
2019-08-29 15:57:46.149 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:46.155 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:46.158 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:46.161 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:46.162 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:57:46.274 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:57:46.276 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 15:57:46.276 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 15:57:46.276 +08:00 [DBG] Adding auth_time claim with value: 1567065466
2019-08-29 15:57:46.281 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:57:46.285 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"65a57cea-6c9b-4239-9f04-8ead5cda20fb","DisplayName":"alice","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPCAQ3MVG7D:00000010","TimeStamp":"2019-08-29T07:57:46.0000000Z","ProcessId":7028,"LocalIpAddress":"127.0.0.1:20132","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 15:57:46.288 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:46.288 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:46.304 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:57:46.305 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:57:46.305 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:57:46.313 +08:00 [DBG] Start authorize callback request
2019-08-29 15:57:46.317 +08:00 [DBG] User in authorize request: 65a57cea-6c9b-4239-9f04-8ead5cda20fb
2019-08-29 15:57:46.317 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:57:46.321 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:46.321 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:46.322 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:57:46.322 +08:00 [DBG] No PKCE used.
2019-08-29 15:57:46.323 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:46.329 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:46.330 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:46.333 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:46.333 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:57:46.333 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"65a57cea-6c9b-4239-9f04-8ead5cda20fb","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOFh0wNg5JRQsbQXufAlXpml8HBYySNgvgzvvgFq2yeS5Ur0hpMiiSNtQ1Xgx7xojEkaAn75t3X0AoPiCbyp_6r9rE_A2Z4FQAoEhDMJN1hClY6ElhnXqS-uHiQKrDO_-Morcg16NbjdzuPPdo5R4hF9xofNp1SwKWvi38YrAZtl5XwtX0z2rMnW2g2mp4NCuc0HhOD2foOjd4tUHz8FTGFRfL7WyZKyqwAiPSJzi0d7RR4PeUCBvtr0_iFman4eo0MeS806Tbco8RngSDjIAopQjYuFRdfNzAiOidWZx_X5nMU0qaVz0DlAin8IyYZxlI","UiLocales":null,"Nonce":"637026622643323594.MDY2N2M4ZjYtMGIwNS00MGM3LTkyMzMtYTM3ZTcwMDI0YzNhM2IzOGY1OGMtZTc3MS00ZmJiLWFiNzktMDE4NzY0NzRkNWU3","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"e4ceeef50b453fd13279f2f609cb2b53","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026622643323594.MDY2N2M4ZjYtMGIwNS00MGM3LTkyMzMtYTM3ZTcwMDI0YzNhM2IzOGY1OGMtZTc3MS00ZmJiLWFiNzktMDE4NzY0NzRkNWU3","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofOFh0wNg5JRQsbQXufAlXpml8HBYySNgvgzvvgFq2yeS5Ur0hpMiiSNtQ1Xgx7xojEkaAn75t3X0AoPiCbyp_6r9rE_A2Z4FQAoEhDMJN1hClY6ElhnXqS-uHiQKrDO_-Morcg16NbjdzuPPdo5R4hF9xofNp1SwKWvi38YrAZtl5XwtX0z2rMnW2g2mp4NCuc0HhOD2foOjd4tUHz8FTGFRfL7WyZKyqwAiPSJzi0d7RR4PeUCBvtr0_iFman4eo0MeS806Tbco8RngSDjIAopQjYuFRdfNzAiOidWZx_X5nMU0qaVz0DlAin8IyYZxlI","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:57:46.347 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 15:57:46.347 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 15:57:46.376 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:57:46.380 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:46.380 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:46.380 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:57:46.380 +08:00 [DBG] No PKCE used.
2019-08-29 15:57:46.381 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:46.384 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:46.385 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:46.387 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:46.387 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:57:46.390 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:46.390 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:46.397 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:46.465 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:47.665 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 15:57:47.679 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:57:47.683 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:47.683 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:47.683 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:57:47.683 +08:00 [DBG] No PKCE used.
2019-08-29 15:57:47.684 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:47.687 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:47.688 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:47.690 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:47.691 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:57:47.691 +08:00 [INF] {"SubjectId":"65a57cea-6c9b-4239-9f04-8ead5cda20fb","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCAQ3MVG7D:00000013","TimeStamp":"2019-08-29T07:57:47.0000000Z","ProcessId":7028,"LocalIpAddress":"127.0.0.1:20132","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 15:57:47.703 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:47.703 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:47.711 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 15:57:47.712 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 15:57:47.712 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 15:57:47.712 +08:00 [DBG] Start authorize callback request
2019-08-29 15:57:47.714 +08:00 [DBG] User in authorize request: 65a57cea-6c9b-4239-9f04-8ead5cda20fb
2019-08-29 15:57:47.714 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 15:57:47.717 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:47.717 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:47.717 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 15:57:47.717 +08:00 [DBG] No PKCE used.
2019-08-29 15:57:47.719 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:47.722 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:47.723 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:47.726 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:47.726 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 15:57:47.726 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"65a57cea-6c9b-4239-9f04-8ead5cda20fb","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOFh0wNg5JRQsbQXufAlXpml8HBYySNgvgzvvgFq2yeS5Ur0hpMiiSNtQ1Xgx7xojEkaAn75t3X0AoPiCbyp_6r9rE_A2Z4FQAoEhDMJN1hClY6ElhnXqS-uHiQKrDO_-Morcg16NbjdzuPPdo5R4hF9xofNp1SwKWvi38YrAZtl5XwtX0z2rMnW2g2mp4NCuc0HhOD2foOjd4tUHz8FTGFRfL7WyZKyqwAiPSJzi0d7RR4PeUCBvtr0_iFman4eo0MeS806Tbco8RngSDjIAopQjYuFRdfNzAiOidWZx_X5nMU0qaVz0DlAin8IyYZxlI","UiLocales":null,"Nonce":"637026622643323594.MDY2N2M4ZjYtMGIwNS00MGM3LTkyMzMtYTM3ZTcwMDI0YzNhM2IzOGY1OGMtZTc3MS00ZmJiLWFiNzktMDE4NzY0NzRkNWU3","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"e4ceeef50b453fd13279f2f609cb2b53","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026622643323594.MDY2N2M4ZjYtMGIwNS00MGM3LTkyMzMtYTM3ZTcwMDI0YzNhM2IzOGY1OGMtZTc3MS00ZmJiLWFiNzktMDE4NzY0NzRkNWU3","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofOFh0wNg5JRQsbQXufAlXpml8HBYySNgvgzvvgFq2yeS5Ur0hpMiiSNtQ1Xgx7xojEkaAn75t3X0AoPiCbyp_6r9rE_A2Z4FQAoEhDMJN1hClY6ElhnXqS-uHiQKrDO_-Morcg16NbjdzuPPdo5R4hF9xofNp1SwKWvi38YrAZtl5XwtX0z2rMnW2g2mp4NCuc0HhOD2foOjd4tUHz8FTGFRfL7WyZKyqwAiPSJzi0d7RR4PeUCBvtr0_iFman4eo0MeS806Tbco8RngSDjIAopQjYuFRdfNzAiOidWZx_X5nMU0qaVz0DlAin8IyYZxlI","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 15:57:47.727 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 15:57:47.732 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 15:57:47.732 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 15:57:47.736 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 65a57cea-6c9b-4239-9f04-8ead5cda20fb
2019-08-29 15:57:47.753 +08:00 [DBG] MIAec4jDpn6V3XtpQ/WVR9Y2NeCmx65wfOxR4IDjMFI= not found in database
2019-08-29 15:57:47.879 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-29 15:57:47.890 +08:00 [DBG] +bzVioxEdYG33PVaTV3Q1E5cl9BGa7oLjf7O837xhRk= not found in database
2019-08-29 15:57:47.895 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 15:57:47.904 +08:00 [DBG] Getting claims for identity token for subject: 65a57cea-6c9b-4239-9f04-8ead5cda20fb and client: mvc
2019-08-29 15:57:47.905 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 15:57:47.913 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"65a57cea-6c9b-4239-9f04-8ead5cda20fb","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****hOiw","$type":"Token"},{"TokenType":"code","TokenValue":"****d81c","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCAQ3MVG7D:00000014","TimeStamp":"2019-08-29T07:57:47.0000000Z","ProcessId":7028,"LocalIpAddress":"127.0.0.1:20132","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:57:47.914 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"65a57cea-6c9b-4239-9f04-8ead5cda20fb","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofOFh0wNg5JRQsbQXufAlXpml8HBYySNgvgzvvgFq2yeS5Ur0hpMiiSNtQ1Xgx7xojEkaAn75t3X0AoPiCbyp_6r9rE_A2Z4FQAoEhDMJN1hClY6ElhnXqS-uHiQKrDO_-Morcg16NbjdzuPPdo5R4hF9xofNp1SwKWvi38YrAZtl5XwtX0z2rMnW2g2mp4NCuc0HhOD2foOjd4tUHz8FTGFRfL7WyZKyqwAiPSJzi0d7RR4PeUCBvtr0_iFman4eo0MeS806Tbco8RngSDjIAopQjYuFRdfNzAiOidWZx_X5nMU0qaVz0DlAin8IyYZxlI","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 15:57:47.924 +08:00 [DBG] Augmenting SignInContext
2019-08-29 15:57:47.925 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 15:57:48.057 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 15:57:48.057 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 15:57:48.058 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 15:57:48.058 +08:00 [DBG] Start token request.
2019-08-29 15:57:48.058 +08:00 [DBG] Start client validation
2019-08-29 15:57:48.058 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 15:57:48.058 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 15:57:48.058 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 15:57:48.058 +08:00 [DBG] Secret id found: mvc
2019-08-29 15:57:48.063 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:48.063 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:48.063 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 15:57:48.063 +08:00 [DBG] Client validation success
2019-08-29 15:57:48.063 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCAQ3MVG7D:00000015","TimeStamp":"2019-08-29T07:57:48.0000000Z","ProcessId":7028,"LocalIpAddress":"127.0.0.1:20132","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 15:57:48.064 +08:00 [DBG] Start token request validation
2019-08-29 15:57:48.072 +08:00 [DBG] Start validation of authorization code token request
2019-08-29 15:57:48.087 +08:00 [DBG] +bzVioxEdYG33PVaTV3Q1E5cl9BGa7oLjf7O837xhRk= found in database: true
2019-08-29 15:57:48.101 +08:00 [DBG] removing +bzVioxEdYG33PVaTV3Q1E5cl9BGa7oLjf7O837xhRk= persisted grant from database
2019-08-29 15:57:48.120 +08:00 [DBG] Validation of authorization code token request success
2019-08-29 15:57:48.122 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"b49e69440951cfaa5184e625506ed8202bb018a606af08de045598ec9a2fd81c","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"b49e69440951cfaa5184e625506ed8202bb018a606af08de045598ec9a2fd81c","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-29 15:57:48.133 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:48.133 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:48.138 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:48.205 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:48.205 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-29 15:57:48.205 +08:00 [DBG] Getting claims for access token for subject: 65a57cea-6c9b-4239-9f04-8ead5cda20fb
2019-08-29 15:57:48.224 +08:00 [DBG] Creating refresh token
2019-08-29 15:57:48.224 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-29 15:57:48.233 +08:00 [DBG] et9hX/7igrMV6FPOJM3ZJJMO2nn5TTsswuUZWJzzwnA= not found in database
2019-08-29 15:57:48.240 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:48.240 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:48.241 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:48.244 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 15:57:48.244 +08:00 [DBG] Getting claims for identity token for subject: 65a57cea-6c9b-4239-9f04-8ead5cda20fb and client: mvc
2019-08-29 15:57:48.244 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 15:57:48.249 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"65a57cea-6c9b-4239-9f04-8ead5cda20fb","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****qVxA","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****38ec","$type":"Token"},{"TokenType":"access_token","TokenValue":"****uuXw","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCAQ3MVG7D:00000015","TimeStamp":"2019-08-29T07:57:48.0000000Z","ProcessId":7028,"LocalIpAddress":"127.0.0.1:20132","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 15:57:48.249 +08:00 [DBG] Token request success.
2019-08-29 15:57:48.256 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-29 15:57:48.257 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-29 15:57:48.257 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-29 15:57:48.263 +08:00 [DBG] Start userinfo request
2019-08-29 15:57:48.266 +08:00 [DBG] Bearer token found in header
2019-08-29 15:57:48.280 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:48.281 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:48.284 +08:00 [DBG] mvc found in database: true
2019-08-29 15:57:48.284 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 15:57:48.288 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 15:57:48.289 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567065468,"exp":1567069068,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"65a57cea-6c9b-4239-9f04-8ead5cda20fb","auth_time":1567065466,"idp":"local","role":["zero.Admin","zero.tenantRole1:3d0a1642-c2e1-4031-96a9-4fc651c245c1"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 15:57:48.296 +08:00 [DBG] Creating userinfo response
2019-08-29 15:57:48.299 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:57:48.301 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:57:48.304 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:48.304 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2019-08-29 15:57:48.304 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 15:57:48.305 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 15:57:48.308 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2019-08-29 15:57:48.308 +08:00 [DBG] End userinfo request
2019-08-29 16:04:44.781 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 16:04:44.816 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 16:04:44.816 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 16:04:44.816 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 16:04:44.816 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 16:04:44.816 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 16:04:44.816 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 16:04:44.941 +08:00 [DBG] Starting grant removal
2019-08-29 16:04:45.220 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 16:04:45.221 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 16:04:45.221 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 16:04:45.221 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 16:04:45.221 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 16:04:45.222 +08:00 [DBG] Error Url: /home/error
2019-08-29 16:04:45.222 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 16:06:35.706 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 16:06:35.709 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 16:06:35.709 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 16:06:35.712 +08:00 [DBG] Start discovery request
2019-08-29 16:06:35.982 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 16:06:36.150 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 16:06:36.150 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 16:06:36.150 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 16:06:36.153 +08:00 [DBG] Start key discovery request
2019-08-29 16:06:36.495 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 16:06:36.495 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 16:06:36.495 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 16:06:36.495 +08:00 [DBG] Start discovery request
2019-08-29 16:06:36.499 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 16:06:36.514 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 16:06:36.515 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 16:06:36.515 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 16:06:36.515 +08:00 [DBG] Start key discovery request
2019-08-29 16:06:36.539 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 16:06:36.543 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 16:06:36.543 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 16:06:36.549 +08:00 [DBG] Start token request.
2019-08-29 16:06:36.554 +08:00 [DBG] Start client validation
2019-08-29 16:06:36.559 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 16:06:36.562 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 16:06:36.576 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 16:06:36.576 +08:00 [DBG] Secret id found: client
2019-08-29 16:06:36.719 +08:00 [DBG] client found in database: true
2019-08-29 16:06:36.727 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 16:06:36.734 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 16:06:36.734 +08:00 [DBG] Client validation success
2019-08-29 16:06:36.743 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCAU6V09SJ:00000005","TimeStamp":"2019-08-29T08:06:36.0000000Z","ProcessId":24172,"LocalIpAddress":"127.0.0.1:29262","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 16:06:36.750 +08:00 [DBG] Start token request validation
2019-08-29 16:06:36.756 +08:00 [DBG] Start client credentials token request validation
2019-08-29 16:06:36.786 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:06:36.849 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:06:36.856 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:06:36.858 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:06:36.860 +08:00 [DBG] client credentials token request validation success
2019-08-29 16:06:36.866 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 16:06:36.885 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 16:06:36.925 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****0LqQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCAU6V09SJ:00000005","TimeStamp":"2019-08-29T08:06:36.0000000Z","ProcessId":24172,"LocalIpAddress":"127.0.0.1:29262","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:06:36.926 +08:00 [DBG] Token request success.
2019-08-29 16:06:37.596 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 16:06:37.597 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 16:06:37.597 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 16:06:37.597 +08:00 [DBG] Start discovery request
2019-08-29 16:06:37.600 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 16:06:37.664 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 16:06:37.664 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 16:06:37.664 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 16:06:37.664 +08:00 [DBG] Start key discovery request
2019-08-29 16:06:41.447 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 16:06:41.447 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 16:06:41.447 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 16:06:41.447 +08:00 [DBG] Start discovery request
2019-08-29 16:06:41.460 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 16:06:41.484 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 16:06:41.484 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 16:06:41.485 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 16:06:41.485 +08:00 [DBG] Start key discovery request
2019-08-29 16:06:41.511 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-29 16:06:41.512 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-29 16:06:41.512 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-29 16:06:41.518 +08:00 [DBG] Processing signout request for 65a57cea-6c9b-4239-9f04-8ead5cda20fb
2019-08-29 16:06:41.522 +08:00 [DBG] Start end session request validation
2019-08-29 16:06:41.527 +08:00 [DBG] Start identity token validation
2019-08-29 16:06:41.548 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:41.548 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:41.548 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-29 16:06:41.574 +08:00 [WRN] No user found matching subject Id: 65a57cea-6c9b-4239-9f04-8ead5cda20fb
2019-08-29 16:06:41.575 +08:00 [ERR] User marked as not active: 65a57cea-6c9b-4239-9f04-8ead5cda20fb
2019-08-29 16:06:41.578 +08:00 [INF] End session request validation failure: Error validating id token hint
{"ClientId":null,"ClientName":null,"SubjectId":"unknown","PostLogOutUri":null,"State":null,"Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofMmWboo_dHMGihjn3j8DzE4whHRpp5H4oSko-21W8kn4l9Suus5bmzqI1xWMKPtIbabT5p4zHxsR3-MRiq9nwFnST4AlPR9GooPLvwN3Q5eQUZT9sF3HNlmg_DS4ceOLBCZ4PAjVCv0mBw3eMfB7QPa","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-29 16:06:41.579 +08:00 [ERR] Error processing end session request Invalid request
2019-08-29 16:06:42.782 +08:00 [DBG] CORS request made for path: /Account/Logout from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:06:42.809 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-29 16:06:42.810 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-29 16:06:42.811 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-29 16:06:42.811 +08:00 [INF] {"SubjectId":"65a57cea-6c9b-4239-9f04-8ead5cda20fb","DisplayName":"Alice Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLPCAU6V09SJ:0000000C","TimeStamp":"2019-08-29T08:06:42.0000000Z","ProcessId":24172,"LocalIpAddress":"127.0.0.1:29262","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-29 16:06:42.851 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-29 16:06:42.854 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-29 16:06:42.854 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-29 16:06:42.859 +08:00 [DBG] Processing signout callback request
2019-08-29 16:06:42.884 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:42.884 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:42.884 +08:00 [DBG] No client front-channel logout URLs
2019-08-29 16:06:42.884 +08:00 [DBG] No client back-channel logout URLs
2019-08-29 16:06:42.884 +08:00 [INF] Successful signout callback.
2019-08-29 16:06:42.884 +08:00 [DBG] No client front-channel iframe urls
2019-08-29 16:06:42.884 +08:00 [DBG] No client back-channel iframe urls
2019-08-29 16:06:49.814 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 16:06:49.816 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 16:06:49.816 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 16:06:49.819 +08:00 [DBG] Start authorize request
2019-08-29 16:06:49.823 +08:00 [DBG] No user present in authorize request
2019-08-29 16:06:49.827 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:06:49.843 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:49.843 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:49.853 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:06:49.855 +08:00 [DBG] No PKCE used.
2019-08-29 16:06:49.870 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:49.937 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:49.939 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:49.942 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:49.947 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:06:49.949 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofPpgOOP6I3HFo4fAZkSUhi9xgq_ijUuOQvtf_ZmYQo-6rpy_jLYtxu3SfBcx_mIot9YinuuJl19O_rl8jCLSPHN_1fPm4_379vbopvmQxfW-G3Uj7jGHP_tJX0vGQSOWPrboaU3RCpj-YmVLVlSYs26z02oveE9pfhJMoebflWqWgZmVk81YxqIArj6QpAIT7t6vL2AD3fFcWJIbIy0DHZY6wQ2-pX_az-BaelKqUYOBqPBbwjJZ6GI48jbns7UTN4LZT7ixpil80Nu1ww2kxtCi62PosJpMkHwGjvviczMvYvUxIbKse96fNQ4EhVgec8","UiLocales":null,"Nonce":"637026628098084823.MTdhZDk5MDAtMTNmMS00Njc4LWE1ZWQtMmQ1ZjY0N2VhZWEyYTE0OWVjYTgtNjI0NS00ZjllLWEwNDgtZGY4NTQ3MmY2YjJj","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026628098084823.MTdhZDk5MDAtMTNmMS00Njc4LWE1ZWQtMmQ1ZjY0N2VhZWEyYTE0OWVjYTgtNjI0NS00ZjllLWEwNDgtZGY4NTQ3MmY2YjJj","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofPpgOOP6I3HFo4fAZkSUhi9xgq_ijUuOQvtf_ZmYQo-6rpy_jLYtxu3SfBcx_mIot9YinuuJl19O_rl8jCLSPHN_1fPm4_379vbopvmQxfW-G3Uj7jGHP_tJX0vGQSOWPrboaU3RCpj-YmVLVlSYs26z02oveE9pfhJMoebflWqWgZmVk81YxqIArj6QpAIT7t6vL2AD3fFcWJIbIy0DHZY6wQ2-pX_az-BaelKqUYOBqPBbwjJZ6GI48jbns7UTN4LZT7ixpil80Nu1ww2kxtCi62PosJpMkHwGjvviczMvYvUxIbKse96fNQ4EhVgec8","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:06:49.956 +08:00 [INF] Showing login: User is not authenticated
2019-08-29 16:06:49.980 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:06:49.984 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:49.984 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:49.984 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:06:49.984 +08:00 [DBG] No PKCE used.
2019-08-29 16:06:49.985 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:49.988 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:49.989 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:49.992 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:49.992 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:06:49.997 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:49.997 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:53.150 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:06:53.165 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:06:53.168 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:53.169 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:53.169 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:06:53.169 +08:00 [DBG] No PKCE used.
2019-08-29 16:06:53.170 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:53.173 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:53.174 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:53.176 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:53.176 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:06:53.286 +08:00 [DBG] Augmenting SignInContext
2019-08-29 16:06:53.288 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 16:06:53.288 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 16:06:53.288 +08:00 [DBG] Adding auth_time claim with value: 1567066013
2019-08-29 16:06:53.294 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 16:06:53.297 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"7b47a056-15a1-462e-bbc5-030ee66059a3","DisplayName":"alice","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPCAU6V09SJ:00000010","TimeStamp":"2019-08-29T08:06:53.0000000Z","ProcessId":24172,"LocalIpAddress":"127.0.0.1:29262","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 16:06:53.301 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:53.301 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:53.318 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 16:06:53.319 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 16:06:53.319 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 16:06:53.326 +08:00 [DBG] Start authorize callback request
2019-08-29 16:06:53.328 +08:00 [DBG] User in authorize request: 7b47a056-15a1-462e-bbc5-030ee66059a3
2019-08-29 16:06:53.328 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:06:53.332 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:53.332 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:53.332 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:06:53.332 +08:00 [DBG] No PKCE used.
2019-08-29 16:06:53.333 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:53.336 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:53.337 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:53.340 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:53.340 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:06:53.340 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"7b47a056-15a1-462e-bbc5-030ee66059a3","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofPpgOOP6I3HFo4fAZkSUhi9xgq_ijUuOQvtf_ZmYQo-6rpy_jLYtxu3SfBcx_mIot9YinuuJl19O_rl8jCLSPHN_1fPm4_379vbopvmQxfW-G3Uj7jGHP_tJX0vGQSOWPrboaU3RCpj-YmVLVlSYs26z02oveE9pfhJMoebflWqWgZmVk81YxqIArj6QpAIT7t6vL2AD3fFcWJIbIy0DHZY6wQ2-pX_az-BaelKqUYOBqPBbwjJZ6GI48jbns7UTN4LZT7ixpil80Nu1ww2kxtCi62PosJpMkHwGjvviczMvYvUxIbKse96fNQ4EhVgec8","UiLocales":null,"Nonce":"637026628098084823.MTdhZDk5MDAtMTNmMS00Njc4LWE1ZWQtMmQ1ZjY0N2VhZWEyYTE0OWVjYTgtNjI0NS00ZjllLWEwNDgtZGY4NTQ3MmY2YjJj","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"ffcdaea590524f035bda52a1f95218b6","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026628098084823.MTdhZDk5MDAtMTNmMS00Njc4LWE1ZWQtMmQ1ZjY0N2VhZWEyYTE0OWVjYTgtNjI0NS00ZjllLWEwNDgtZGY4NTQ3MmY2YjJj","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofPpgOOP6I3HFo4fAZkSUhi9xgq_ijUuOQvtf_ZmYQo-6rpy_jLYtxu3SfBcx_mIot9YinuuJl19O_rl8jCLSPHN_1fPm4_379vbopvmQxfW-G3Uj7jGHP_tJX0vGQSOWPrboaU3RCpj-YmVLVlSYs26z02oveE9pfhJMoebflWqWgZmVk81YxqIArj6QpAIT7t6vL2AD3fFcWJIbIy0DHZY6wQ2-pX_az-BaelKqUYOBqPBbwjJZ6GI48jbns7UTN4LZT7ixpil80Nu1ww2kxtCi62PosJpMkHwGjvviczMvYvUxIbKse96fNQ4EhVgec8","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:06:53.352 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 16:06:53.352 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 16:06:53.375 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:06:53.378 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:53.378 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:53.379 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:06:53.379 +08:00 [DBG] No PKCE used.
2019-08-29 16:06:53.380 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:53.383 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:53.384 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:53.386 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:53.386 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:06:53.390 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:53.390 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:53.396 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:53.465 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:55.172 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:06:55.185 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:06:55.188 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:55.188 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:55.189 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:06:55.189 +08:00 [DBG] No PKCE used.
2019-08-29 16:06:55.190 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:55.192 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:55.193 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:55.195 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:55.196 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:06:55.197 +08:00 [INF] {"SubjectId":"7b47a056-15a1-462e-bbc5-030ee66059a3","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCAU6V09SJ:00000013","TimeStamp":"2019-08-29T08:06:55.0000000Z","ProcessId":24172,"LocalIpAddress":"127.0.0.1:29262","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 16:06:55.209 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:55.209 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:55.215 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 16:06:55.216 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 16:06:55.216 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 16:06:55.216 +08:00 [DBG] Start authorize callback request
2019-08-29 16:06:55.217 +08:00 [DBG] User in authorize request: 7b47a056-15a1-462e-bbc5-030ee66059a3
2019-08-29 16:06:55.217 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:06:55.221 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:55.221 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:55.221 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:06:55.221 +08:00 [DBG] No PKCE used.
2019-08-29 16:06:55.222 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:55.225 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:55.227 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:55.229 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:55.229 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:06:55.229 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"7b47a056-15a1-462e-bbc5-030ee66059a3","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofPpgOOP6I3HFo4fAZkSUhi9xgq_ijUuOQvtf_ZmYQo-6rpy_jLYtxu3SfBcx_mIot9YinuuJl19O_rl8jCLSPHN_1fPm4_379vbopvmQxfW-G3Uj7jGHP_tJX0vGQSOWPrboaU3RCpj-YmVLVlSYs26z02oveE9pfhJMoebflWqWgZmVk81YxqIArj6QpAIT7t6vL2AD3fFcWJIbIy0DHZY6wQ2-pX_az-BaelKqUYOBqPBbwjJZ6GI48jbns7UTN4LZT7ixpil80Nu1ww2kxtCi62PosJpMkHwGjvviczMvYvUxIbKse96fNQ4EhVgec8","UiLocales":null,"Nonce":"637026628098084823.MTdhZDk5MDAtMTNmMS00Njc4LWE1ZWQtMmQ1ZjY0N2VhZWEyYTE0OWVjYTgtNjI0NS00ZjllLWEwNDgtZGY4NTQ3MmY2YjJj","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"ffcdaea590524f035bda52a1f95218b6","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026628098084823.MTdhZDk5MDAtMTNmMS00Njc4LWE1ZWQtMmQ1ZjY0N2VhZWEyYTE0OWVjYTgtNjI0NS00ZjllLWEwNDgtZGY4NTQ3MmY2YjJj","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofPpgOOP6I3HFo4fAZkSUhi9xgq_ijUuOQvtf_ZmYQo-6rpy_jLYtxu3SfBcx_mIot9YinuuJl19O_rl8jCLSPHN_1fPm4_379vbopvmQxfW-G3Uj7jGHP_tJX0vGQSOWPrboaU3RCpj-YmVLVlSYs26z02oveE9pfhJMoebflWqWgZmVk81YxqIArj6QpAIT7t6vL2AD3fFcWJIbIy0DHZY6wQ2-pX_az-BaelKqUYOBqPBbwjJZ6GI48jbns7UTN4LZT7ixpil80Nu1ww2kxtCi62PosJpMkHwGjvviczMvYvUxIbKse96fNQ4EhVgec8","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:06:55.231 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 16:06:55.236 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 16:06:55.236 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 16:06:55.240 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: 7b47a056-15a1-462e-bbc5-030ee66059a3
2019-08-29 16:06:55.264 +08:00 [DBG] 1woXF79GnJ7f7OWeupaWxS+n1dN48uyU8UAyrHQ0MG8= not found in database
2019-08-29 16:06:55.285 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-29 16:06:55.296 +08:00 [DBG] B8HNJWjf1c90ul4V6gIecgxN0xXb4oGCUCWzxHbMt98= not found in database
2019-08-29 16:06:55.301 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 16:06:55.308 +08:00 [DBG] Getting claims for identity token for subject: 7b47a056-15a1-462e-bbc5-030ee66059a3 and client: mvc
2019-08-29 16:06:55.309 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 16:06:55.315 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"7b47a056-15a1-462e-bbc5-030ee66059a3","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****tw1A","$type":"Token"},{"TokenType":"code","TokenValue":"****f096","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCAU6V09SJ:00000014","TimeStamp":"2019-08-29T08:06:55.0000000Z","ProcessId":24172,"LocalIpAddress":"127.0.0.1:29262","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:06:55.317 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"7b47a056-15a1-462e-bbc5-030ee66059a3","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofPpgOOP6I3HFo4fAZkSUhi9xgq_ijUuOQvtf_ZmYQo-6rpy_jLYtxu3SfBcx_mIot9YinuuJl19O_rl8jCLSPHN_1fPm4_379vbopvmQxfW-G3Uj7jGHP_tJX0vGQSOWPrboaU3RCpj-YmVLVlSYs26z02oveE9pfhJMoebflWqWgZmVk81YxqIArj6QpAIT7t6vL2AD3fFcWJIbIy0DHZY6wQ2-pX_az-BaelKqUYOBqPBbwjJZ6GI48jbns7UTN4LZT7ixpil80Nu1ww2kxtCi62PosJpMkHwGjvviczMvYvUxIbKse96fNQ4EhVgec8","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 16:06:55.327 +08:00 [DBG] Augmenting SignInContext
2019-08-29 16:06:55.327 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 16:06:55.470 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 16:06:55.471 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 16:06:55.471 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 16:06:55.471 +08:00 [DBG] Start token request.
2019-08-29 16:06:55.471 +08:00 [DBG] Start client validation
2019-08-29 16:06:55.471 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 16:06:55.471 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 16:06:55.471 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 16:06:55.471 +08:00 [DBG] Secret id found: mvc
2019-08-29 16:06:55.475 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:55.476 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:55.476 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 16:06:55.476 +08:00 [DBG] Client validation success
2019-08-29 16:06:55.476 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCAU6V09SJ:00000015","TimeStamp":"2019-08-29T08:06:55.0000000Z","ProcessId":24172,"LocalIpAddress":"127.0.0.1:29262","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 16:06:55.476 +08:00 [DBG] Start token request validation
2019-08-29 16:06:55.485 +08:00 [DBG] Start validation of authorization code token request
2019-08-29 16:06:55.498 +08:00 [DBG] B8HNJWjf1c90ul4V6gIecgxN0xXb4oGCUCWzxHbMt98= found in database: true
2019-08-29 16:06:55.511 +08:00 [DBG] removing B8HNJWjf1c90ul4V6gIecgxN0xXb4oGCUCWzxHbMt98= persisted grant from database
2019-08-29 16:06:55.523 +08:00 [DBG] Validation of authorization code token request success
2019-08-29 16:06:55.524 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"3603137dbd8327be4e29312be61a7b400e4442a21599d28823504ec8d802f096","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"3603137dbd8327be4e29312be61a7b400e4442a21599d28823504ec8d802f096","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-29 16:06:55.533 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:55.533 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:55.540 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:55.605 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:55.606 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-29 16:06:55.606 +08:00 [DBG] Getting claims for access token for subject: 7b47a056-15a1-462e-bbc5-030ee66059a3
2019-08-29 16:06:55.623 +08:00 [DBG] Creating refresh token
2019-08-29 16:06:55.623 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-29 16:06:55.632 +08:00 [DBG] /U+GSz438Zh/icNwmiUG7jvLGmSKSmzFuyQwH5ybtxc= not found in database
2019-08-29 16:06:55.638 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:55.638 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:55.640 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:55.642 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:06:55.642 +08:00 [DBG] Getting claims for identity token for subject: 7b47a056-15a1-462e-bbc5-030ee66059a3 and client: mvc
2019-08-29 16:06:55.643 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 16:06:55.647 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"7b47a056-15a1-462e-bbc5-030ee66059a3","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****T10g","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****8229","$type":"Token"},{"TokenType":"access_token","TokenValue":"****FiJQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCAU6V09SJ:00000015","TimeStamp":"2019-08-29T08:06:55.0000000Z","ProcessId":24172,"LocalIpAddress":"127.0.0.1:29262","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:06:55.647 +08:00 [DBG] Token request success.
2019-08-29 16:06:55.655 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-29 16:06:55.656 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-29 16:06:55.656 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-29 16:06:55.661 +08:00 [DBG] Start userinfo request
2019-08-29 16:06:55.664 +08:00 [DBG] Bearer token found in header
2019-08-29 16:06:55.679 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:55.679 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:55.682 +08:00 [DBG] mvc found in database: true
2019-08-29 16:06:55.682 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:06:55.685 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 16:06:55.687 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567066015,"exp":1567069615,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"7b47a056-15a1-462e-bbc5-030ee66059a3","auth_time":1567066013,"idp":"local","role":["zero.tenantRole1:5925a37c-6452-4474-8bb7-9f7678aacb75","zero.Admin"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 16:06:55.693 +08:00 [DBG] Creating userinfo response
2019-08-29 16:06:55.696 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:06:55.699 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:06:55.702 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:55.702 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2019-08-29 16:06:55.702 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:06:55.703 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:06:55.707 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2019-08-29 16:06:55.707 +08:00 [DBG] End userinfo request
2019-08-29 16:08:42.946 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2019-08-29 16:08:42.980 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2019-08-29 16:08:42.980 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2019-08-29 16:08:42.980 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2019-08-29 16:08:42.980 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2019-08-29 16:08:42.980 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2019-08-29 16:08:42.980 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2019-08-29 16:08:43.100 +08:00 [DBG] Starting grant removal
2019-08-29 16:08:43.313 +08:00 [DBG] Login Url: /Account/Login
2019-08-29 16:08:43.315 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2019-08-29 16:08:43.315 +08:00 [DBG] Logout Url: /Account/Logout
2019-08-29 16:08:43.315 +08:00 [DBG] ConsentUrl Url: /consent
2019-08-29 16:08:43.315 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2019-08-29 16:08:43.315 +08:00 [DBG] Error Url: /home/error
2019-08-29 16:08:43.315 +08:00 [DBG] Error Id Parameter: errorId
2019-08-29 16:08:46.970 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 16:08:46.973 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 16:08:46.973 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 16:08:46.976 +08:00 [DBG] Start discovery request
2019-08-29 16:08:47.243 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 16:08:47.411 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 16:08:47.412 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 16:08:47.412 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 16:08:47.415 +08:00 [DBG] Start key discovery request
2019-08-29 16:08:47.742 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 16:08:47.742 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 16:08:47.742 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 16:08:47.742 +08:00 [DBG] Start discovery request
2019-08-29 16:08:47.746 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 16:08:47.761 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 16:08:47.762 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 16:08:47.762 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 16:08:47.762 +08:00 [DBG] Start key discovery request
2019-08-29 16:08:47.781 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 16:08:47.785 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 16:08:47.785 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 16:08:47.791 +08:00 [DBG] Start token request.
2019-08-29 16:08:47.798 +08:00 [DBG] Start client validation
2019-08-29 16:08:47.803 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 16:08:47.806 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 16:08:47.817 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 16:08:47.817 +08:00 [DBG] Secret id found: client
2019-08-29 16:08:47.947 +08:00 [DBG] client found in database: true
2019-08-29 16:08:47.954 +08:00 [DBG] client configuration validation for client client succeeded.
2019-08-29 16:08:47.962 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 16:08:47.962 +08:00 [DBG] Client validation success
2019-08-29 16:08:47.971 +08:00 [INF] {"ClientId":"client","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000007","TimeStamp":"2019-08-29T08:08:47.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 16:08:47.978 +08:00 [DBG] Start token request validation
2019-08-29 16:08:47.984 +08:00 [DBG] Start client credentials token request validation
2019-08-29 16:08:48.013 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:08:48.076 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:08:48.083 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:08:48.085 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:08:48.087 +08:00 [DBG] client credentials token request validation success
2019-08-29 16:08:48.093 +08:00 [INF] Token request validation success, {"ClientId":"client","ClientName":null,"GrantType":"client_credentials","Scopes":"zero_identity_api","AuthorizationCode":null,"RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"grant_type":"client_credentials","scope":"zero_identity_api","client_id":"client","client_secret":"***REDACTED***"},"$type":"TokenRequestValidationLog"}
2019-08-29 16:08:48.111 +08:00 [DBG] Getting claims for access token for client: client
2019-08-29 16:08:48.144 +08:00 [INF] {"ClientId":"client","ClientName":null,"RedirectUri":null,"Endpoint":"Token","SubjectId":null,"Scopes":"zero_identity_api","GrantType":"client_credentials","Tokens":[{"TokenType":"access_token","TokenValue":"****nPsQ","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000007","TimeStamp":"2019-08-29T08:08:48.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:08:48.145 +08:00 [DBG] Token request success.
2019-08-29 16:08:48.839 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 16:08:48.839 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 16:08:48.839 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 16:08:48.839 +08:00 [DBG] Start discovery request
2019-08-29 16:08:48.842 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 16:08:48.908 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 16:08:48.909 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 16:08:48.909 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 16:08:48.909 +08:00 [DBG] Start key discovery request
2019-08-29 16:08:52.551 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2019-08-29 16:08:52.551 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2019-08-29 16:08:52.551 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2019-08-29 16:08:52.551 +08:00 [DBG] Start discovery request
2019-08-29 16:08:52.564 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2019-08-29 16:08:52.592 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2019-08-29 16:08:52.592 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2019-08-29 16:08:52.592 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2019-08-29 16:08:52.592 +08:00 [DBG] Start key discovery request
2019-08-29 16:08:52.623 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-29 16:08:52.624 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-29 16:08:52.624 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-29 16:08:52.630 +08:00 [DBG] Processing signout request for 7b47a056-15a1-462e-bbc5-030ee66059a3
2019-08-29 16:08:52.638 +08:00 [DBG] Start end session request validation
2019-08-29 16:08:52.644 +08:00 [DBG] Start identity token validation
2019-08-29 16:08:52.664 +08:00 [DBG] mvc found in database: true
2019-08-29 16:08:52.664 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:08:52.664 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-29 16:08:52.692 +08:00 [WRN] No user found matching subject Id: 7b47a056-15a1-462e-bbc5-030ee66059a3
2019-08-29 16:08:52.693 +08:00 [ERR] User marked as not active: 7b47a056-15a1-462e-bbc5-030ee66059a3
2019-08-29 16:08:52.696 +08:00 [INF] End session request validation failure: Error validating id token hint
{"ClientId":null,"ClientName":null,"SubjectId":"unknown","PostLogOutUri":null,"State":null,"Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofNLqazflNbvAgSc7XxuMC2sfwpRZp466taHBRzOlTlcif0q_J6n-g5PKI-Sk3IjkPe-zP2JShuQXyP_00VSJQxbw9l4G2fNEBLXf0RJIia8N_m5SDXMrS2DM_bXh1ry7VIVIk6plsobg6EvzGg6bCgu","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-29 16:08:52.697 +08:00 [ERR] Error processing end session request Invalid request
2019-08-29 16:08:53.689 +08:00 [DBG] CORS request made for path: /Account/Logout from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:08:53.716 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-29 16:08:53.717 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-29 16:08:53.717 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-29 16:08:53.718 +08:00 [INF] {"SubjectId":"7b47a056-15a1-462e-bbc5-030ee66059a3","DisplayName":"Alice Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLPCB0DTLHE6:0000000E","TimeStamp":"2019-08-29T08:08:53.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-29 16:08:53.762 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-29 16:08:53.765 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-29 16:08:53.765 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-29 16:08:53.770 +08:00 [DBG] Processing signout callback request
2019-08-29 16:08:53.795 +08:00 [DBG] mvc found in database: true
2019-08-29 16:08:53.795 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:08:53.795 +08:00 [DBG] No client front-channel logout URLs
2019-08-29 16:08:53.795 +08:00 [DBG] No client back-channel logout URLs
2019-08-29 16:08:53.795 +08:00 [INF] Successful signout callback.
2019-08-29 16:08:53.795 +08:00 [DBG] No client front-channel iframe urls
2019-08-29 16:08:53.796 +08:00 [DBG] No client back-channel iframe urls
2019-08-29 16:08:57.891 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 16:08:57.893 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 16:08:57.893 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 16:08:57.896 +08:00 [DBG] Start authorize request
2019-08-29 16:08:57.899 +08:00 [DBG] No user present in authorize request
2019-08-29 16:08:57.903 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:08:57.920 +08:00 [DBG] mvc found in database: true
2019-08-29 16:08:57.920 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:08:57.930 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:08:57.931 +08:00 [DBG] No PKCE used.
2019-08-29 16:08:57.947 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:58.017 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:08:58.020 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:58.022 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:08:58.027 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:08:58.029 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofO5Q4kqUPGvogzyR1T0UVQo8YOCpBGwlwctzbOgGf0LYHMIliAQxy5hjoq4hTrWIfHuuDph8tVHY5yemvYIUUCll6OZejEOZpYS1R5T7MBl9FNNMp3VuoVO5meFt3_ugXWcNtXUI7srgnOwZSvswEtMfG5GwEZJrx1qDNZ7Du8e1LvI1nqeUVBzrL_IKdY3FJdlBk1lFb-H-hiTpUesAtrr0C07Kn2-_fkHBBRLCvJ56JyKQvxB-ts1q-bxXfrJgXQNz_0KVZqrMUQmlKVaqGPzSDZVMLtoFLC8PoWfLi8BZYUoLngFIlOAAagRXR9_xdY","UiLocales":null,"Nonce":"637026629378854256.Mzc2ZGQ4MDctZTIzYS00ZWU1LTlkNGMtMmIyMmI0ZWM1NDUzZDIwZWVhYzItZDk0Ny00ZWY2LWI3ZGYtY2UzZGZiYjkzZDRh","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026629378854256.Mzc2ZGQ4MDctZTIzYS00ZWU1LTlkNGMtMmIyMmI0ZWM1NDUzZDIwZWVhYzItZDk0Ny00ZWY2LWI3ZGYtY2UzZGZiYjkzZDRh","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofO5Q4kqUPGvogzyR1T0UVQo8YOCpBGwlwctzbOgGf0LYHMIliAQxy5hjoq4hTrWIfHuuDph8tVHY5yemvYIUUCll6OZejEOZpYS1R5T7MBl9FNNMp3VuoVO5meFt3_ugXWcNtXUI7srgnOwZSvswEtMfG5GwEZJrx1qDNZ7Du8e1LvI1nqeUVBzrL_IKdY3FJdlBk1lFb-H-hiTpUesAtrr0C07Kn2-_fkHBBRLCvJ56JyKQvxB-ts1q-bxXfrJgXQNz_0KVZqrMUQmlKVaqGPzSDZVMLtoFLC8PoWfLi8BZYUoLngFIlOAAagRXR9_xdY","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:08:58.035 +08:00 [INF] Showing login: User is not authenticated
2019-08-29 16:08:58.062 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:08:58.066 +08:00 [DBG] mvc found in database: true
2019-08-29 16:08:58.066 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:08:58.066 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:08:58.067 +08:00 [DBG] No PKCE used.
2019-08-29 16:08:58.068 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:58.071 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:08:58.072 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:58.075 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:08:58.075 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:08:58.080 +08:00 [DBG] mvc found in database: true
2019-08-29 16:08:58.080 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:08:59.213 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:08:59.226 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:08:59.229 +08:00 [DBG] mvc found in database: true
2019-08-29 16:08:59.229 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:08:59.229 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:08:59.229 +08:00 [DBG] No PKCE used.
2019-08-29 16:08:59.230 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:59.233 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:08:59.234 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:59.237 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:08:59.237 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:08:59.348 +08:00 [DBG] Augmenting SignInContext
2019-08-29 16:08:59.350 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 16:08:59.350 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 16:08:59.350 +08:00 [DBG] Adding auth_time claim with value: 1567066139
2019-08-29 16:08:59.355 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 16:08:59.359 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","DisplayName":"alice","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000012","TimeStamp":"2019-08-29T08:08:59.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 16:08:59.362 +08:00 [DBG] mvc found in database: true
2019-08-29 16:08:59.362 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:08:59.377 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 16:08:59.378 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 16:08:59.379 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 16:08:59.384 +08:00 [DBG] Start authorize callback request
2019-08-29 16:08:59.386 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:08:59.386 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:08:59.389 +08:00 [DBG] mvc found in database: true
2019-08-29 16:08:59.389 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:08:59.389 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:08:59.389 +08:00 [DBG] No PKCE used.
2019-08-29 16:08:59.391 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:59.394 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:08:59.395 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:59.397 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:08:59.397 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:08:59.398 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofO5Q4kqUPGvogzyR1T0UVQo8YOCpBGwlwctzbOgGf0LYHMIliAQxy5hjoq4hTrWIfHuuDph8tVHY5yemvYIUUCll6OZejEOZpYS1R5T7MBl9FNNMp3VuoVO5meFt3_ugXWcNtXUI7srgnOwZSvswEtMfG5GwEZJrx1qDNZ7Du8e1LvI1nqeUVBzrL_IKdY3FJdlBk1lFb-H-hiTpUesAtrr0C07Kn2-_fkHBBRLCvJ56JyKQvxB-ts1q-bxXfrJgXQNz_0KVZqrMUQmlKVaqGPzSDZVMLtoFLC8PoWfLi8BZYUoLngFIlOAAagRXR9_xdY","UiLocales":null,"Nonce":"637026629378854256.Mzc2ZGQ4MDctZTIzYS00ZWU1LTlkNGMtMmIyMmI0ZWM1NDUzZDIwZWVhYzItZDk0Ny00ZWY2LWI3ZGYtY2UzZGZiYjkzZDRh","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"4ce8e380beb712de0f69e416f11ac823","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026629378854256.Mzc2ZGQ4MDctZTIzYS00ZWU1LTlkNGMtMmIyMmI0ZWM1NDUzZDIwZWVhYzItZDk0Ny00ZWY2LWI3ZGYtY2UzZGZiYjkzZDRh","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofO5Q4kqUPGvogzyR1T0UVQo8YOCpBGwlwctzbOgGf0LYHMIliAQxy5hjoq4hTrWIfHuuDph8tVHY5yemvYIUUCll6OZejEOZpYS1R5T7MBl9FNNMp3VuoVO5meFt3_ugXWcNtXUI7srgnOwZSvswEtMfG5GwEZJrx1qDNZ7Du8e1LvI1nqeUVBzrL_IKdY3FJdlBk1lFb-H-hiTpUesAtrr0C07Kn2-_fkHBBRLCvJ56JyKQvxB-ts1q-bxXfrJgXQNz_0KVZqrMUQmlKVaqGPzSDZVMLtoFLC8PoWfLi8BZYUoLngFIlOAAagRXR9_xdY","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:08:59.410 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 16:08:59.410 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 16:08:59.431 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:08:59.435 +08:00 [DBG] mvc found in database: true
2019-08-29 16:08:59.435 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:08:59.435 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:08:59.435 +08:00 [DBG] No PKCE used.
2019-08-29 16:08:59.436 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:59.439 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:08:59.440 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:59.443 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:08:59.443 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:08:59.446 +08:00 [DBG] mvc found in database: true
2019-08-29 16:08:59.446 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:08:59.452 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:08:59.523 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:00.900 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:09:00.914 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:09:00.918 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:00.918 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:00.918 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:09:00.918 +08:00 [DBG] No PKCE used.
2019-08-29 16:09:00.919 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:00.922 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:00.923 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:00.926 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:00.926 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:09:00.927 +08:00 [INF] {"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000015","TimeStamp":"2019-08-29T08:09:00.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 16:09:00.940 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:00.940 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:00.946 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 16:09:00.947 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 16:09:00.947 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 16:09:00.947 +08:00 [DBG] Start authorize callback request
2019-08-29 16:09:00.949 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:09:00.949 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:09:00.952 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:00.953 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:00.953 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:09:00.953 +08:00 [DBG] No PKCE used.
2019-08-29 16:09:00.954 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:00.957 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:00.959 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:00.962 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:00.962 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:09:00.962 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofO5Q4kqUPGvogzyR1T0UVQo8YOCpBGwlwctzbOgGf0LYHMIliAQxy5hjoq4hTrWIfHuuDph8tVHY5yemvYIUUCll6OZejEOZpYS1R5T7MBl9FNNMp3VuoVO5meFt3_ugXWcNtXUI7srgnOwZSvswEtMfG5GwEZJrx1qDNZ7Du8e1LvI1nqeUVBzrL_IKdY3FJdlBk1lFb-H-hiTpUesAtrr0C07Kn2-_fkHBBRLCvJ56JyKQvxB-ts1q-bxXfrJgXQNz_0KVZqrMUQmlKVaqGPzSDZVMLtoFLC8PoWfLi8BZYUoLngFIlOAAagRXR9_xdY","UiLocales":null,"Nonce":"637026629378854256.Mzc2ZGQ4MDctZTIzYS00ZWU1LTlkNGMtMmIyMmI0ZWM1NDUzZDIwZWVhYzItZDk0Ny00ZWY2LWI3ZGYtY2UzZGZiYjkzZDRh","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"4ce8e380beb712de0f69e416f11ac823","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026629378854256.Mzc2ZGQ4MDctZTIzYS00ZWU1LTlkNGMtMmIyMmI0ZWM1NDUzZDIwZWVhYzItZDk0Ny00ZWY2LWI3ZGYtY2UzZGZiYjkzZDRh","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofO5Q4kqUPGvogzyR1T0UVQo8YOCpBGwlwctzbOgGf0LYHMIliAQxy5hjoq4hTrWIfHuuDph8tVHY5yemvYIUUCll6OZejEOZpYS1R5T7MBl9FNNMp3VuoVO5meFt3_ugXWcNtXUI7srgnOwZSvswEtMfG5GwEZJrx1qDNZ7Du8e1LvI1nqeUVBzrL_IKdY3FJdlBk1lFb-H-hiTpUesAtrr0C07Kn2-_fkHBBRLCvJ56JyKQvxB-ts1q-bxXfrJgXQNz_0KVZqrMUQmlKVaqGPzSDZVMLtoFLC8PoWfLi8BZYUoLngFIlOAAagRXR9_xdY","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:09:00.963 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 16:09:00.969 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 16:09:00.969 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 16:09:00.973 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:09:00.993 +08:00 [DBG] /8kaAjT/h9Y79NVOTTGYA5yPjxRltlmhK7ZhfQVAVf4= not found in database
2019-08-29 16:09:01.014 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-29 16:09:01.027 +08:00 [DBG] Umjr0llOGKy/DVbc2D2IRQ58BE5ambPynAKqJPQWjj4= not found in database
2019-08-29 16:09:01.031 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 16:09:01.038 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc
2019-08-29 16:09:01.040 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 16:09:01.048 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****59cg","$type":"Token"},{"TokenType":"code","TokenValue":"****bae1","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000016","TimeStamp":"2019-08-29T08:09:01.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:09:01.049 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofO5Q4kqUPGvogzyR1T0UVQo8YOCpBGwlwctzbOgGf0LYHMIliAQxy5hjoq4hTrWIfHuuDph8tVHY5yemvYIUUCll6OZejEOZpYS1R5T7MBl9FNNMp3VuoVO5meFt3_ugXWcNtXUI7srgnOwZSvswEtMfG5GwEZJrx1qDNZ7Du8e1LvI1nqeUVBzrL_IKdY3FJdlBk1lFb-H-hiTpUesAtrr0C07Kn2-_fkHBBRLCvJ56JyKQvxB-ts1q-bxXfrJgXQNz_0KVZqrMUQmlKVaqGPzSDZVMLtoFLC8PoWfLi8BZYUoLngFIlOAAagRXR9_xdY","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 16:09:01.061 +08:00 [DBG] Augmenting SignInContext
2019-08-29 16:09:01.061 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 16:09:01.211 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 16:09:01.212 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 16:09:01.212 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 16:09:01.212 +08:00 [DBG] Start token request.
2019-08-29 16:09:01.212 +08:00 [DBG] Start client validation
2019-08-29 16:09:01.212 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 16:09:01.212 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 16:09:01.212 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 16:09:01.212 +08:00 [DBG] Secret id found: mvc
2019-08-29 16:09:01.216 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:01.216 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:01.216 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 16:09:01.216 +08:00 [DBG] Client validation success
2019-08-29 16:09:01.217 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000017","TimeStamp":"2019-08-29T08:09:01.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 16:09:01.217 +08:00 [DBG] Start token request validation
2019-08-29 16:09:01.224 +08:00 [DBG] Start validation of authorization code token request
2019-08-29 16:09:01.236 +08:00 [DBG] Umjr0llOGKy/DVbc2D2IRQ58BE5ambPynAKqJPQWjj4= found in database: true
2019-08-29 16:09:01.249 +08:00 [DBG] removing Umjr0llOGKy/DVbc2D2IRQ58BE5ambPynAKqJPQWjj4= persisted grant from database
2019-08-29 16:09:01.263 +08:00 [DBG] Validation of authorization code token request success
2019-08-29 16:09:01.265 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"ad5f194ea47262e6453020c2e4947498c487dfdc5abb6dca413e10600e25bae1","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"ad5f194ea47262e6453020c2e4947498c487dfdc5abb6dca413e10600e25bae1","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-29 16:09:01.275 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:01.276 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:01.281 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:01.355 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:01.356 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-29 16:09:01.356 +08:00 [DBG] Getting claims for access token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:09:01.379 +08:00 [DBG] Creating refresh token
2019-08-29 16:09:01.379 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-29 16:09:01.393 +08:00 [DBG] 7XbLT9QX8SmeycbNyqQtwH0FcwK1iwDTOorW5DhHXa8= not found in database
2019-08-29 16:09:01.400 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:01.400 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:01.402 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:01.404 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:01.404 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc
2019-08-29 16:09:01.404 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 16:09:01.409 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****ISMQ","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****446f","$type":"Token"},{"TokenType":"access_token","TokenValue":"****9sVg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000017","TimeStamp":"2019-08-29T08:09:01.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:09:01.409 +08:00 [DBG] Token request success.
2019-08-29 16:09:01.417 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-29 16:09:01.418 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-29 16:09:01.418 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-29 16:09:01.423 +08:00 [DBG] Start userinfo request
2019-08-29 16:09:01.428 +08:00 [DBG] Bearer token found in header
2019-08-29 16:09:01.442 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:01.443 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:01.445 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:01.445 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:01.449 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 16:09:01.450 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567066141,"exp":1567069741,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"c8661ec6-8a4f-44e3-bf1d-031a19934320","auth_time":1567066139,"idp":"local","role":["zero.tenantRole1:3d0a1642-c2e1-4031-96a9-4fc651c245c1","zero.Admin"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 16:09:01.456 +08:00 [DBG] Creating userinfo response
2019-08-29 16:09:01.459 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:09:01.461 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:09:01.464 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:01.465 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2019-08-29 16:09:01.465 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:09:01.466 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:01.469 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2019-08-29 16:09:01.469 +08:00 [DBG] End userinfo request
2019-08-29 16:09:48.169 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-29 16:09:48.170 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-29 16:09:48.170 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-29 16:09:48.170 +08:00 [DBG] Processing signout request for c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:09:48.170 +08:00 [DBG] Start end session request validation
2019-08-29 16:09:48.170 +08:00 [DBG] Start identity token validation
2019-08-29 16:09:48.174 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:48.174 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:48.174 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-29 16:09:48.178 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 16:09:48.179 +08:00 [DBG] Token validation success
{"ClientId":"mvc","ClientName":"MVC Client","ValidateLifetime":false,"AccessTokenType":null,"ExpectedScope":null,"TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567066141,"exp":1567066441,"iss":"http://localhost:5000","aud":"mvc","nonce":"637026629378854256.Mzc2ZGQ4MDctZTIzYS00ZWU1LTlkNGMtMmIyMmI0ZWM1NDUzZDIwZWVhYzItZDk0Ny00ZWY2LWI3ZGYtY2UzZGZiYjkzZDRh","iat":1567066141,"at_hash":"sBaGA9x5yo_j9WkaHEeTsQ","sid":"4ce8e380beb712de0f69e416f11ac823","sub":"c8661ec6-8a4f-44e3-bf1d-031a19934320","auth_time":1567066139,"idp":"local","amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 16:09:48.180 +08:00 [INF] End session request validation success
{"ClientId":"mvc","ClientName":"MVC Client","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","PostLogOutUri":"http://localhost:5002/signout-callback-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofO6cAwvGnztTJ3jMa2sdrFZRSzu8C-E5Gm3kKg1zuigh6iZ6z7uv6mzbX6VOPSUfqMqDU2tI2RZmejjaEdWGuZ0pSLX_YvcHhBrByll1k03tVCoosxFACWCPSL7ww6V5J4evp4TwMVvr7SVPUW4EpSq","Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofO6cAwvGnztTJ3jMa2sdrFZRSzu8C-E5Gm3kKg1zuigh6iZ6z7uv6mzbX6VOPSUfqMqDU2tI2RZmejjaEdWGuZ0pSLX_YvcHhBrByll1k03tVCoosxFACWCPSL7ww6V5J4evp4TwMVvr7SVPUW4EpSq","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-29 16:09:48.180 +08:00 [DBG] Success validating end session request from mvc
2019-08-29 16:09:48.196 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-29 16:09:48.197 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-29 16:09:48.197 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-29 16:09:48.197 +08:00 [INF] {"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","DisplayName":"Alice Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLPCB0DTLHE6:0000001A","TimeStamp":"2019-08-29T08:09:48.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-29 16:09:48.240 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-29 16:09:48.241 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-29 16:09:48.241 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-29 16:09:48.241 +08:00 [DBG] Processing signout callback request
2019-08-29 16:09:48.246 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:48.246 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:48.246 +08:00 [DBG] No client front-channel logout URLs
2019-08-29 16:09:48.246 +08:00 [DBG] No client back-channel logout URLs
2019-08-29 16:09:48.246 +08:00 [INF] Successful signout callback.
2019-08-29 16:09:48.246 +08:00 [DBG] No client front-channel iframe urls
2019-08-29 16:09:48.246 +08:00 [DBG] No client back-channel iframe urls
2019-08-29 16:09:50.720 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 16:09:50.721 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 16:09:50.721 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 16:09:50.721 +08:00 [DBG] Start authorize request
2019-08-29 16:09:50.721 +08:00 [DBG] No user present in authorize request
2019-08-29 16:09:50.721 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:09:50.724 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:50.725 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:50.725 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:09:50.725 +08:00 [DBG] No PKCE used.
2019-08-29 16:09:50.727 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:50.729 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:50.731 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:50.733 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:50.734 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:09:50.734 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofNsxuZ3lJStumJSnAShSWWEaEQZbSCywS-sypP8MC1dxF5bETeN5zIO9VopsoH5Bvg6XGf-1L1PWf1DI_wAzTUWWAAoOqTwTjOFdwmUUvKTneMBi8MLDkV-PMcnjgm3LLUWQh0K-63j2DdHuLV--OfpDxDEJKRl92XOmPBL1e70teFFkaYJSjyEnSoN3e69fhFes9oxaDFBjbng20cGy9H_KzjGyLYaBbzL9CJQSosA2nC0affNUHttWNjqRReERgvIeDMfxEh-pHT6notjPB7Jx_bsf27mEeTU7NPYIEO4LqDAFq08m_1_tbWT7eFXsjU","UiLocales":null,"Nonce":"637026629907131938.ZWExNTU2YzctMjI1Yi00OGJkLWI0NWMtMjliNmEyYTNiOGFlZWI0NGZlMWQtYThiYS00MTQwLWIyMjItNTFiNDk2MjY4ZTQz","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026629907131938.ZWExNTU2YzctMjI1Yi00OGJkLWI0NWMtMjliNmEyYTNiOGFlZWI0NGZlMWQtYThiYS00MTQwLWIyMjItNTFiNDk2MjY4ZTQz","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofNsxuZ3lJStumJSnAShSWWEaEQZbSCywS-sypP8MC1dxF5bETeN5zIO9VopsoH5Bvg6XGf-1L1PWf1DI_wAzTUWWAAoOqTwTjOFdwmUUvKTneMBi8MLDkV-PMcnjgm3LLUWQh0K-63j2DdHuLV--OfpDxDEJKRl92XOmPBL1e70teFFkaYJSjyEnSoN3e69fhFes9oxaDFBjbng20cGy9H_KzjGyLYaBbzL9CJQSosA2nC0affNUHttWNjqRReERgvIeDMfxEh-pHT6notjPB7Jx_bsf27mEeTU7NPYIEO4LqDAFq08m_1_tbWT7eFXsjU","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:09:50.734 +08:00 [INF] Showing login: User is not authenticated
2019-08-29 16:09:50.741 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:09:50.744 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:50.744 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:50.745 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:09:50.745 +08:00 [DBG] No PKCE used.
2019-08-29 16:09:50.746 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:50.749 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:50.750 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:50.753 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:50.753 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:09:50.756 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:50.756 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:53.811 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:09:53.813 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:09:53.817 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:53.817 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:53.817 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:09:53.817 +08:00 [DBG] No PKCE used.
2019-08-29 16:09:53.819 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:53.822 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:53.823 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:53.826 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:53.826 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:09:53.835 +08:00 [DBG] Augmenting SignInContext
2019-08-29 16:09:53.835 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 16:09:53.835 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 16:09:53.835 +08:00 [DBG] Adding auth_time claim with value: 1567066193
2019-08-29 16:09:53.836 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 16:09:53.836 +08:00 [INF] {"Username":"bob","Provider":null,"ProviderUserId":null,"SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","DisplayName":"bob","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:0000001E","TimeStamp":"2019-08-29T08:09:53.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 16:09:53.840 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:53.840 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:53.848 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 16:09:53.849 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 16:09:53.849 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 16:09:53.849 +08:00 [DBG] Start authorize callback request
2019-08-29 16:09:53.849 +08:00 [DBG] User in authorize request: e1804e85-12e8-40d4-a372-d3fdc276c3d1
2019-08-29 16:09:53.849 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:09:53.853 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:53.853 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:53.853 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:09:53.853 +08:00 [DBG] No PKCE used.
2019-08-29 16:09:53.854 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:53.857 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:53.858 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:53.861 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:53.862 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:09:53.862 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofNsxuZ3lJStumJSnAShSWWEaEQZbSCywS-sypP8MC1dxF5bETeN5zIO9VopsoH5Bvg6XGf-1L1PWf1DI_wAzTUWWAAoOqTwTjOFdwmUUvKTneMBi8MLDkV-PMcnjgm3LLUWQh0K-63j2DdHuLV--OfpDxDEJKRl92XOmPBL1e70teFFkaYJSjyEnSoN3e69fhFes9oxaDFBjbng20cGy9H_KzjGyLYaBbzL9CJQSosA2nC0affNUHttWNjqRReERgvIeDMfxEh-pHT6notjPB7Jx_bsf27mEeTU7NPYIEO4LqDAFq08m_1_tbWT7eFXsjU","UiLocales":null,"Nonce":"637026629907131938.ZWExNTU2YzctMjI1Yi00OGJkLWI0NWMtMjliNmEyYTNiOGFlZWI0NGZlMWQtYThiYS00MTQwLWIyMjItNTFiNDk2MjY4ZTQz","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"08a72dac6184a6eaeaf4aeb8851c1294","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026629907131938.ZWExNTU2YzctMjI1Yi00OGJkLWI0NWMtMjliNmEyYTNiOGFlZWI0NGZlMWQtYThiYS00MTQwLWIyMjItNTFiNDk2MjY4ZTQz","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofNsxuZ3lJStumJSnAShSWWEaEQZbSCywS-sypP8MC1dxF5bETeN5zIO9VopsoH5Bvg6XGf-1L1PWf1DI_wAzTUWWAAoOqTwTjOFdwmUUvKTneMBi8MLDkV-PMcnjgm3LLUWQh0K-63j2DdHuLV--OfpDxDEJKRl92XOmPBL1e70teFFkaYJSjyEnSoN3e69fhFes9oxaDFBjbng20cGy9H_KzjGyLYaBbzL9CJQSosA2nC0affNUHttWNjqRReERgvIeDMfxEh-pHT6notjPB7Jx_bsf27mEeTU7NPYIEO4LqDAFq08m_1_tbWT7eFXsjU","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:09:53.863 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 16:09:53.863 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 16:09:53.870 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:09:53.874 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:53.874 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:53.874 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:09:53.874 +08:00 [DBG] No PKCE used.
2019-08-29 16:09:53.875 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:53.879 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:53.881 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:53.883 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:53.883 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:09:53.886 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:53.886 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:53.887 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:53.889 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:55.286 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:09:55.288 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:09:55.292 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:55.292 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:55.293 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:09:55.293 +08:00 [DBG] No PKCE used.
2019-08-29 16:09:55.294 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:55.297 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:55.298 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:55.301 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:55.301 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:09:55.301 +08:00 [INF] {"SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000021","TimeStamp":"2019-08-29T08:09:55.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 16:09:55.305 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:55.305 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:55.311 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 16:09:55.312 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 16:09:55.312 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 16:09:55.312 +08:00 [DBG] Start authorize callback request
2019-08-29 16:09:55.312 +08:00 [DBG] User in authorize request: e1804e85-12e8-40d4-a372-d3fdc276c3d1
2019-08-29 16:09:55.313 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:09:55.316 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:55.316 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:55.317 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:09:55.317 +08:00 [DBG] No PKCE used.
2019-08-29 16:09:55.318 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:55.321 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:55.322 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:55.324 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:55.324 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:09:55.324 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofNsxuZ3lJStumJSnAShSWWEaEQZbSCywS-sypP8MC1dxF5bETeN5zIO9VopsoH5Bvg6XGf-1L1PWf1DI_wAzTUWWAAoOqTwTjOFdwmUUvKTneMBi8MLDkV-PMcnjgm3LLUWQh0K-63j2DdHuLV--OfpDxDEJKRl92XOmPBL1e70teFFkaYJSjyEnSoN3e69fhFes9oxaDFBjbng20cGy9H_KzjGyLYaBbzL9CJQSosA2nC0affNUHttWNjqRReERgvIeDMfxEh-pHT6notjPB7Jx_bsf27mEeTU7NPYIEO4LqDAFq08m_1_tbWT7eFXsjU","UiLocales":null,"Nonce":"637026629907131938.ZWExNTU2YzctMjI1Yi00OGJkLWI0NWMtMjliNmEyYTNiOGFlZWI0NGZlMWQtYThiYS00MTQwLWIyMjItNTFiNDk2MjY4ZTQz","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"08a72dac6184a6eaeaf4aeb8851c1294","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026629907131938.ZWExNTU2YzctMjI1Yi00OGJkLWI0NWMtMjliNmEyYTNiOGFlZWI0NGZlMWQtYThiYS00MTQwLWIyMjItNTFiNDk2MjY4ZTQz","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofNsxuZ3lJStumJSnAShSWWEaEQZbSCywS-sypP8MC1dxF5bETeN5zIO9VopsoH5Bvg6XGf-1L1PWf1DI_wAzTUWWAAoOqTwTjOFdwmUUvKTneMBi8MLDkV-PMcnjgm3LLUWQh0K-63j2DdHuLV--OfpDxDEJKRl92XOmPBL1e70teFFkaYJSjyEnSoN3e69fhFes9oxaDFBjbng20cGy9H_KzjGyLYaBbzL9CJQSosA2nC0affNUHttWNjqRReERgvIeDMfxEh-pHT6notjPB7Jx_bsf27mEeTU7NPYIEO4LqDAFq08m_1_tbWT7eFXsjU","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:09:55.325 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 16:09:55.326 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 16:09:55.326 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 16:09:55.326 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: e1804e85-12e8-40d4-a372-d3fdc276c3d1
2019-08-29 16:09:55.327 +08:00 [DBG] 5tASJZ4hy9nlZGXdxfYjyTOcbDwg0WAPSbCNKttDLhw= not found in database
2019-08-29 16:09:55.329 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-29 16:09:55.329 +08:00 [DBG] Obi3FcK+2+n8Dsue2wfpbtRS14ScEiDCgvNuBB6saOs= not found in database
2019-08-29 16:09:55.330 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 16:09:55.330 +08:00 [DBG] Getting claims for identity token for subject: e1804e85-12e8-40d4-a372-d3fdc276c3d1 and client: mvc
2019-08-29 16:09:55.330 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 16:09:55.335 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****sK7g","$type":"Token"},{"TokenType":"code","TokenValue":"****c11d","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000022","TimeStamp":"2019-08-29T08:09:55.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:09:55.336 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofNsxuZ3lJStumJSnAShSWWEaEQZbSCywS-sypP8MC1dxF5bETeN5zIO9VopsoH5Bvg6XGf-1L1PWf1DI_wAzTUWWAAoOqTwTjOFdwmUUvKTneMBi8MLDkV-PMcnjgm3LLUWQh0K-63j2DdHuLV--OfpDxDEJKRl92XOmPBL1e70teFFkaYJSjyEnSoN3e69fhFes9oxaDFBjbng20cGy9H_KzjGyLYaBbzL9CJQSosA2nC0affNUHttWNjqRReERgvIeDMfxEh-pHT6notjPB7Jx_bsf27mEeTU7NPYIEO4LqDAFq08m_1_tbWT7eFXsjU","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 16:09:55.336 +08:00 [DBG] Augmenting SignInContext
2019-08-29 16:09:55.336 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 16:09:55.431 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 16:09:55.431 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 16:09:55.431 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 16:09:55.431 +08:00 [DBG] Start token request.
2019-08-29 16:09:55.431 +08:00 [DBG] Start client validation
2019-08-29 16:09:55.431 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 16:09:55.431 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 16:09:55.431 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 16:09:55.432 +08:00 [DBG] Secret id found: mvc
2019-08-29 16:09:55.436 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:55.436 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:55.436 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 16:09:55.436 +08:00 [DBG] Client validation success
2019-08-29 16:09:55.436 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000023","TimeStamp":"2019-08-29T08:09:55.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 16:09:55.436 +08:00 [DBG] Start token request validation
2019-08-29 16:09:55.436 +08:00 [DBG] Start validation of authorization code token request
2019-08-29 16:09:55.437 +08:00 [DBG] Obi3FcK+2+n8Dsue2wfpbtRS14ScEiDCgvNuBB6saOs= found in database: true
2019-08-29 16:09:55.438 +08:00 [DBG] removing Obi3FcK+2+n8Dsue2wfpbtRS14ScEiDCgvNuBB6saOs= persisted grant from database
2019-08-29 16:09:55.440 +08:00 [DBG] Validation of authorization code token request success
2019-08-29 16:09:55.440 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"dda84ceb2e81f4ebf37c7327084bf5d00e892a6d830e8ba4b92e13a0f5b7c11d","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"dda84ceb2e81f4ebf37c7327084bf5d00e892a6d830e8ba4b92e13a0f5b7c11d","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-29 16:09:55.445 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:55.445 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:55.447 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:55.450 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:55.450 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-29 16:09:55.450 +08:00 [DBG] Getting claims for access token for subject: e1804e85-12e8-40d4-a372-d3fdc276c3d1
2019-08-29 16:09:55.455 +08:00 [DBG] Creating refresh token
2019-08-29 16:09:55.455 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-29 16:09:55.457 +08:00 [DBG] YYVrx891pFQnCfHaxshpxfTFWXDuxlPwvXNe9dLvWgg= not found in database
2019-08-29 16:09:55.463 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:55.463 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:55.465 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:55.468 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:09:55.468 +08:00 [DBG] Getting claims for identity token for subject: e1804e85-12e8-40d4-a372-d3fdc276c3d1 and client: mvc
2019-08-29 16:09:55.468 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 16:09:55.474 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****Z0KQ","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****4682","$type":"Token"},{"TokenType":"access_token","TokenValue":"****KRqg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000023","TimeStamp":"2019-08-29T08:09:55.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:09:55.474 +08:00 [DBG] Token request success.
2019-08-29 16:09:55.477 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-29 16:09:55.477 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-29 16:09:55.477 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-29 16:09:55.477 +08:00 [DBG] Start userinfo request
2019-08-29 16:09:55.477 +08:00 [DBG] Bearer token found in header
2019-08-29 16:09:55.485 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:55.485 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:55.489 +08:00 [DBG] mvc found in database: true
2019-08-29 16:09:55.489 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:09:55.491 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 16:09:55.491 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567066195,"exp":1567069795,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","auth_time":1567066193,"idp":"local","role":"zero.tenantRole1:88626ea1-09b9-4fd5-93e1-7da6c4af9f61","scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 16:09:55.492 +08:00 [DBG] Creating userinfo response
2019-08-29 16:09:55.492 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:09:55.492 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:09:55.494 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:55.495 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2019-08-29 16:09:55.495 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:09:55.497 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:09:55.499 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name role preferred_username
2019-08-29 16:09:55.499 +08:00 [DBG] End userinfo request
2019-08-29 16:10:05.373 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 16:10:05.374 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 16:10:05.374 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 16:10:05.374 +08:00 [DBG] Start authorize request
2019-08-29 16:10:05.375 +08:00 [DBG] User in authorize request: e1804e85-12e8-40d4-a372-d3fdc276c3d1
2019-08-29 16:10:05.375 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:05.395 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:05.395 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:05.397 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:05.423 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:05.424 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:05.427 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:05.427 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:05.427 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE2OjEwOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"08a72dac6184a6eaeaf4aeb8851c1294","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE2OjEwOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:10:05.431 +08:00 [DBG] 5YPLRWGc8BA6z2tJEndyz4pp33RP7DHf2iAeLe/hQqY= found in database: false
2019-08-29 16:10:05.431 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|e1804e85-12e8-40d4-a372-d3fdc276c3d1 not found in store.
2019-08-29 16:10:05.431 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 16:10:05.431 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 16:10:05.438 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:05.442 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:05.442 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:05.443 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:05.445 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:05.446 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:05.448 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:05.448 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:05.451 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:05.451 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:05.452 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:05.454 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:06.812 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:10:06.814 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:06.818 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:06.818 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:06.819 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:06.821 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:06.822 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:06.824 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:06.824 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:06.824 +08:00 [INF] {"SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","ClientId":"zero_identity_api_swaggerui","RequestedScopes":["zero_identity_api"],"GrantedScopes":["zero_identity_api"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000027","TimeStamp":"2019-08-29T08:10:06.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 16:10:06.827 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:06.827 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:06.833 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 16:10:06.834 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 16:10:06.834 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 16:10:06.834 +08:00 [DBG] Start authorize callback request
2019-08-29 16:10:06.834 +08:00 [DBG] User in authorize request: e1804e85-12e8-40d4-a372-d3fdc276c3d1
2019-08-29 16:10:06.834 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:06.837 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:06.837 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:06.838 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:06.841 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:06.841 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:06.844 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:06.844 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:06.844 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE2OjEwOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"08a72dac6184a6eaeaf4aeb8851c1294","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE2OjEwOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:10:06.846 +08:00 [DBG] 5YPLRWGc8BA6z2tJEndyz4pp33RP7DHf2iAeLe/hQqY= found in database: false
2019-08-29 16:10:06.846 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|e1804e85-12e8-40d4-a372-d3fdc276c3d1 not found in store.
2019-08-29 16:10:06.846 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 16:10:06.846 +08:00 [INF] User consented to scopes: ["zero_identity_api"]
2019-08-29 16:10:06.846 +08:00 [DBG] User indicated to remember consent for scopes: ["zero_identity_api"]
2019-08-29 16:10:06.846 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: e1804e85-12e8-40d4-a372-d3fdc276c3d1
2019-08-29 16:10:06.847 +08:00 [DBG] 5YPLRWGc8BA6z2tJEndyz4pp33RP7DHf2iAeLe/hQqY= not found in database
2019-08-29 16:10:06.849 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 16:10:06.850 +08:00 [DBG] Getting claims for access token for client: zero_identity_api_swaggerui
2019-08-29 16:10:06.850 +08:00 [DBG] Getting claims for access token for subject: e1804e85-12e8-40d4-a372-d3fdc276c3d1
2019-08-29 16:10:06.859 +08:00 [INF] {"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","Endpoint":"Authorize","SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","Scopes":"zero_identity_api","GrantType":"implicit","Tokens":[{"TokenType":"access_token","TokenValue":"****1bNA","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000028","TimeStamp":"2019-08-29T08:10:06.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:10:06.859 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","ClientId":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","State":"VGh1IEF1ZyAyOSAyMDE5IDE2OjEwOjA1IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","Scope":"zero_identity_api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 16:10:06.859 +08:00 [DBG] Augmenting SignInContext
2019-08-29 16:10:06.859 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 16:10:21.017 +08:00 [DBG] Request path /connect/endsession matched to endpoint type Endsession
2019-08-29 16:10:21.017 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionEndpoint
2019-08-29 16:10:21.017 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession
2019-08-29 16:10:21.017 +08:00 [DBG] Processing signout request for e1804e85-12e8-40d4-a372-d3fdc276c3d1
2019-08-29 16:10:21.017 +08:00 [DBG] Start end session request validation
2019-08-29 16:10:21.017 +08:00 [DBG] Start identity token validation
2019-08-29 16:10:21.021 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:21.021 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:21.021 +08:00 [DBG] Client found: mvc / MVC Client
2019-08-29 16:10:21.025 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 16:10:21.025 +08:00 [DBG] Token validation success
{"ClientId":"mvc","ClientName":"MVC Client","ValidateLifetime":false,"AccessTokenType":null,"ExpectedScope":null,"TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567066195,"exp":1567066495,"iss":"http://localhost:5000","aud":"mvc","nonce":"637026629907131938.ZWExNTU2YzctMjI1Yi00OGJkLWI0NWMtMjliNmEyYTNiOGFlZWI0NGZlMWQtYThiYS00MTQwLWIyMjItNTFiNDk2MjY4ZTQz","iat":1567066195,"at_hash":"ORIB8mtH3_SwpMlzMhbVbQ","sid":"08a72dac6184a6eaeaf4aeb8851c1294","sub":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","auth_time":1567066193,"idp":"local","amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 16:10:21.025 +08:00 [INF] End session request validation success
{"ClientId":"mvc","ClientName":"MVC Client","SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","PostLogOutUri":"http://localhost:5002/signout-callback-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofM8X5BQmfzMVnw_Rn2Vo8W8lZVFaN5xnH_A3Z7Fttr6FImTwTlO4Hx2RCv0kvo3b6WMqxGWPDpnv7saJOSXa_97P_QPRnYwDr6SmzVAqv2N5rEIhc3tgoXCPz1vuoWaVsic1gHfPTDltViilM4ptBA3","Raw":{"post_logout_redirect_uri":"http://localhost:5002/signout-callback-oidc","id_token_hint":"***REDACTED***","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofM8X5BQmfzMVnw_Rn2Vo8W8lZVFaN5xnH_A3Z7Fttr6FImTwTlO4Hx2RCv0kvo3b6WMqxGWPDpnv7saJOSXa_97P_QPRnYwDr6SmzVAqv2N5rEIhc3tgoXCPz1vuoWaVsic1gHfPTDltViilM4ptBA3","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"EndSessionRequestValidationLog"}
2019-08-29 16:10:21.025 +08:00 [DBG] Success validating end session request from mvc
2019-08-29 16:10:21.032 +08:00 [INF] AuthenticationScheme: Identity.Application signed out.
2019-08-29 16:10:21.032 +08:00 [INF] AuthenticationScheme: Identity.External signed out.
2019-08-29 16:10:21.032 +08:00 [INF] AuthenticationScheme: Identity.TwoFactorUserId signed out.
2019-08-29 16:10:21.032 +08:00 [INF] {"SubjectId":"e1804e85-12e8-40d4-a372-d3fdc276c3d1","DisplayName":"Bob Smith","Category":"Authentication","Name":"User Logout Success","EventType":"Success","Id":1002,"Message":null,"ActivityId":"0HLPCB0DTLHE6:0000002A","TimeStamp":"2019-08-29T08:10:21.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"UserLogoutSuccessEvent"}
2019-08-29 16:10:21.093 +08:00 [DBG] Request path /connect/endsession/callback matched to endpoint type Endsession
2019-08-29 16:10:21.094 +08:00 [DBG] Endpoint enabled: Endsession, successfully created handler: IdentityServer4.Endpoints.EndSessionCallbackEndpoint
2019-08-29 16:10:21.094 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionCallbackEndpoint for /connect/endsession/callback
2019-08-29 16:10:21.094 +08:00 [DBG] Processing signout callback request
2019-08-29 16:10:21.098 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:21.098 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:21.101 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:21.101 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:21.101 +08:00 [DBG] No client front-channel logout URLs
2019-08-29 16:10:21.101 +08:00 [DBG] No client back-channel logout URLs
2019-08-29 16:10:21.101 +08:00 [INF] Successful signout callback.
2019-08-29 16:10:21.101 +08:00 [DBG] No client front-channel iframe urls
2019-08-29 16:10:21.101 +08:00 [DBG] No client back-channel iframe urls
2019-08-29 16:10:23.200 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 16:10:23.201 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 16:10:23.201 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 16:10:23.201 +08:00 [DBG] Start authorize request
2019-08-29 16:10:23.201 +08:00 [DBG] No user present in authorize request
2019-08-29 16:10:23.201 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:23.205 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:23.205 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:23.205 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:10:23.205 +08:00 [DBG] No PKCE used.
2019-08-29 16:10:23.211 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:23.278 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:23.279 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:23.282 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:23.282 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:23.282 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofNIM81nyaotu0Ov-YUEdQeJIAaKJENW-1dQRffKa7Doe8G4h0MWc8pYUq-niZ8HGXtfSksqjiWn1yqw1F0iDTCNM-bLBEdypW-sImKu9EPTBFJqDAt7KfrrmgQzcAiPdH5d2TLbQNfoFwB0AIDYhrO6qJ5QOhHqG4wccylArQnA-eZNXt224PWB_ZD3wsR6YhaYcQTfHSl6gNb7irEaTN3vI8CYSsgm73YteaP8zfp88KadDWdS9_25bkNJXif0TbjbNSaDCYrcE3hvlt8k8Fmbfx8NUv9wrOkcyTJqsbWOZkX3WqPduun7szgEZYGnagQ","UiLocales":null,"Nonce":"637026630231930793.N2M4NTVhNzItMTE5ZS00Y2Q1LTk4ZmQtOWJiOWIwODE1NTQ1MGY1ODVjM2MtMmU5OC00YzFlLTk1MmEtYzgwZjJlNTA3ZmY5","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026630231930793.N2M4NTVhNzItMTE5ZS00Y2Q1LTk4ZmQtOWJiOWIwODE1NTQ1MGY1ODVjM2MtMmU5OC00YzFlLTk1MmEtYzgwZjJlNTA3ZmY5","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofNIM81nyaotu0Ov-YUEdQeJIAaKJENW-1dQRffKa7Doe8G4h0MWc8pYUq-niZ8HGXtfSksqjiWn1yqw1F0iDTCNM-bLBEdypW-sImKu9EPTBFJqDAt7KfrrmgQzcAiPdH5d2TLbQNfoFwB0AIDYhrO6qJ5QOhHqG4wccylArQnA-eZNXt224PWB_ZD3wsR6YhaYcQTfHSl6gNb7irEaTN3vI8CYSsgm73YteaP8zfp88KadDWdS9_25bkNJXif0TbjbNSaDCYrcE3hvlt8k8Fmbfx8NUv9wrOkcyTJqsbWOZkX3WqPduun7szgEZYGnagQ","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:10:23.282 +08:00 [INF] Showing login: User is not authenticated
2019-08-29 16:10:23.288 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:23.291 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:23.291 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:23.291 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:10:23.291 +08:00 [DBG] No PKCE used.
2019-08-29 16:10:23.292 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:23.295 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:23.296 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:23.298 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:23.298 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:23.301 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:23.301 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:30.795 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:10:30.797 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:30.801 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:30.801 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:30.801 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:10:30.801 +08:00 [DBG] No PKCE used.
2019-08-29 16:10:30.803 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:30.805 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:30.807 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:30.809 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:30.809 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:30.820 +08:00 [DBG] Augmenting SignInContext
2019-08-29 16:10:30.820 +08:00 [DBG] Adding idp claim with value: local
2019-08-29 16:10:30.821 +08:00 [DBG] Adding amr claim with value: pwd
2019-08-29 16:10:30.821 +08:00 [DBG] Adding auth_time claim with value: 1567066230
2019-08-29 16:10:30.821 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 16:10:30.822 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","DisplayName":"alice","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:0000002E","TimeStamp":"2019-08-29T08:10:30.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2019-08-29 16:10:30.825 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:30.825 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:30.831 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 16:10:30.832 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 16:10:30.832 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 16:10:30.832 +08:00 [DBG] Start authorize callback request
2019-08-29 16:10:30.832 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:10:30.832 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:30.836 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:30.836 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:30.836 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:10:30.836 +08:00 [DBG] No PKCE used.
2019-08-29 16:10:30.837 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:30.840 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:30.841 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:30.843 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:30.843 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:30.843 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofNIM81nyaotu0Ov-YUEdQeJIAaKJENW-1dQRffKa7Doe8G4h0MWc8pYUq-niZ8HGXtfSksqjiWn1yqw1F0iDTCNM-bLBEdypW-sImKu9EPTBFJqDAt7KfrrmgQzcAiPdH5d2TLbQNfoFwB0AIDYhrO6qJ5QOhHqG4wccylArQnA-eZNXt224PWB_ZD3wsR6YhaYcQTfHSl6gNb7irEaTN3vI8CYSsgm73YteaP8zfp88KadDWdS9_25bkNJXif0TbjbNSaDCYrcE3hvlt8k8Fmbfx8NUv9wrOkcyTJqsbWOZkX3WqPduun7szgEZYGnagQ","UiLocales":null,"Nonce":"637026630231930793.N2M4NTVhNzItMTE5ZS00Y2Q1LTk4ZmQtOWJiOWIwODE1NTQ1MGY1ODVjM2MtMmU5OC00YzFlLTk1MmEtYzgwZjJlNTA3ZmY5","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"bbb63f0cfafd41e1485652a4e777d608","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026630231930793.N2M4NTVhNzItMTE5ZS00Y2Q1LTk4ZmQtOWJiOWIwODE1NTQ1MGY1ODVjM2MtMmU5OC00YzFlLTk1MmEtYzgwZjJlNTA3ZmY5","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofNIM81nyaotu0Ov-YUEdQeJIAaKJENW-1dQRffKa7Doe8G4h0MWc8pYUq-niZ8HGXtfSksqjiWn1yqw1F0iDTCNM-bLBEdypW-sImKu9EPTBFJqDAt7KfrrmgQzcAiPdH5d2TLbQNfoFwB0AIDYhrO6qJ5QOhHqG4wccylArQnA-eZNXt224PWB_ZD3wsR6YhaYcQTfHSl6gNb7irEaTN3vI8CYSsgm73YteaP8zfp88KadDWdS9_25bkNJXif0TbjbNSaDCYrcE3hvlt8k8Fmbfx8NUv9wrOkcyTJqsbWOZkX3WqPduun7szgEZYGnagQ","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:10:30.845 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 16:10:30.845 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 16:10:30.852 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:30.855 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:30.855 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:30.855 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:10:30.855 +08:00 [DBG] No PKCE used.
2019-08-29 16:10:30.857 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:30.859 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:30.861 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:30.864 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:30.864 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:30.868 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:30.868 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:30.874 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:30.942 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:32.091 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:10:32.093 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:32.097 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:32.097 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:32.097 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:10:32.097 +08:00 [DBG] No PKCE used.
2019-08-29 16:10:32.099 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:32.101 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:32.102 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:32.104 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:32.104 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:32.104 +08:00 [INF] {"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000031","TimeStamp":"2019-08-29T08:10:32.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 16:10:32.108 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:32.108 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:32.114 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 16:10:32.115 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 16:10:32.115 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 16:10:32.115 +08:00 [DBG] Start authorize callback request
2019-08-29 16:10:32.115 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:10:32.115 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:32.118 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:32.118 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:32.118 +08:00 [DBG] Checking for PKCE parameters
2019-08-29 16:10:32.119 +08:00 [DBG] No PKCE used.
2019-08-29 16:10:32.120 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:32.123 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:32.124 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:32.126 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:32.126 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:32.126 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofNIM81nyaotu0Ov-YUEdQeJIAaKJENW-1dQRffKa7Doe8G4h0MWc8pYUq-niZ8HGXtfSksqjiWn1yqw1F0iDTCNM-bLBEdypW-sImKu9EPTBFJqDAt7KfrrmgQzcAiPdH5d2TLbQNfoFwB0AIDYhrO6qJ5QOhHqG4wccylArQnA-eZNXt224PWB_ZD3wsR6YhaYcQTfHSl6gNb7irEaTN3vI8CYSsgm73YteaP8zfp88KadDWdS9_25bkNJXif0TbjbNSaDCYrcE3hvlt8k8Fmbfx8NUv9wrOkcyTJqsbWOZkX3WqPduun7szgEZYGnagQ","UiLocales":null,"Nonce":"637026630231930793.N2M4NTVhNzItMTE5ZS00Y2Q1LTk4ZmQtOWJiOWIwODE1NTQ1MGY1ODVjM2MtMmU5OC00YzFlLTk1MmEtYzgwZjJlNTA3ZmY5","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"bbb63f0cfafd41e1485652a4e777d608","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637026630231930793.N2M4NTVhNzItMTE5ZS00Y2Q1LTk4ZmQtOWJiOWIwODE1NTQ1MGY1ODVjM2MtMmU5OC00YzFlLTk1MmEtYzgwZjJlNTA3ZmY5","state":"CfDJ8OFGGNtIXBdCiyPlsKWQofNIM81nyaotu0Ov-YUEdQeJIAaKJENW-1dQRffKa7Doe8G4h0MWc8pYUq-niZ8HGXtfSksqjiWn1yqw1F0iDTCNM-bLBEdypW-sImKu9EPTBFJqDAt7KfrrmgQzcAiPdH5d2TLbQNfoFwB0AIDYhrO6qJ5QOhHqG4wccylArQnA-eZNXt224PWB_ZD3wsR6YhaYcQTfHSl6gNb7irEaTN3vI8CYSsgm73YteaP8zfp88KadDWdS9_25bkNJXif0TbjbNSaDCYrcE3hvlt8k8Fmbfx8NUv9wrOkcyTJqsbWOZkX3WqPduun7szgEZYGnagQ","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:10:32.128 +08:00 [DBG] Scopes contains offline_access, consent is required
2019-08-29 16:10:32.128 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 16:10:32.128 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2019-08-29 16:10:32.128 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:10:32.129 +08:00 [DBG] /8kaAjT/h9Y79NVOTTGYA5yPjxRltlmhK7ZhfQVAVf4= found in database
2019-08-29 16:10:32.133 +08:00 [DBG] Creating Hybrid Flow response.
2019-08-29 16:10:32.134 +08:00 [DBG] WlzT3RoVKM+3S0/3WuQ8XgDeuLY52ID1Q/IaUb5ccv0= not found in database
2019-08-29 16:10:32.135 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 16:10:32.135 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc
2019-08-29 16:10:32.135 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 16:10:32.138 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****1P9Q","$type":"Token"},{"TokenType":"code","TokenValue":"****5954","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000032","TimeStamp":"2019-08-29T08:10:32.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:10:32.138 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8OFGGNtIXBdCiyPlsKWQofNIM81nyaotu0Ov-YUEdQeJIAaKJENW-1dQRffKa7Doe8G4h0MWc8pYUq-niZ8HGXtfSksqjiWn1yqw1F0iDTCNM-bLBEdypW-sImKu9EPTBFJqDAt7KfrrmgQzcAiPdH5d2TLbQNfoFwB0AIDYhrO6qJ5QOhHqG4wccylArQnA-eZNXt224PWB_ZD3wsR6YhaYcQTfHSl6gNb7irEaTN3vI8CYSsgm73YteaP8zfp88KadDWdS9_25bkNJXif0TbjbNSaDCYrcE3hvlt8k8Fmbfx8NUv9wrOkcyTJqsbWOZkX3WqPduun7szgEZYGnagQ","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 16:10:32.138 +08:00 [DBG] Augmenting SignInContext
2019-08-29 16:10:32.139 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2019-08-29 16:10:32.233 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2019-08-29 16:10:32.234 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2019-08-29 16:10:32.234 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2019-08-29 16:10:32.234 +08:00 [DBG] Start token request.
2019-08-29 16:10:32.234 +08:00 [DBG] Start client validation
2019-08-29 16:10:32.234 +08:00 [DBG] Start parsing Basic Authentication secret
2019-08-29 16:10:32.234 +08:00 [DBG] Start parsing for secret in post body
2019-08-29 16:10:32.234 +08:00 [DBG] Parser found secret: PostBodySecretParser
2019-08-29 16:10:32.234 +08:00 [DBG] Secret id found: mvc
2019-08-29 16:10:32.238 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:32.238 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:32.238 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2019-08-29 16:10:32.238 +08:00 [DBG] Client validation success
2019-08-29 16:10:32.238 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000033","TimeStamp":"2019-08-29T08:10:32.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2019-08-29 16:10:32.238 +08:00 [DBG] Start token request validation
2019-08-29 16:10:32.238 +08:00 [DBG] Start validation of authorization code token request
2019-08-29 16:10:32.239 +08:00 [DBG] WlzT3RoVKM+3S0/3WuQ8XgDeuLY52ID1Q/IaUb5ccv0= found in database: true
2019-08-29 16:10:32.240 +08:00 [DBG] removing WlzT3RoVKM+3S0/3WuQ8XgDeuLY52ID1Q/IaUb5ccv0= persisted grant from database
2019-08-29 16:10:32.242 +08:00 [DBG] Validation of authorization code token request success
2019-08-29 16:10:32.242 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"ee8d822d1e2e4a771103b80f0df737b8fdef2d5e32a150700d67d34566755954","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"ee8d822d1e2e4a771103b80f0df737b8fdef2d5e32a150700d67d34566755954","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2019-08-29 16:10:32.246 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:32.246 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:32.252 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:32.321 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:32.321 +08:00 [DBG] Getting claims for access token for client: mvc
2019-08-29 16:10:32.321 +08:00 [DBG] Getting claims for access token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:10:32.326 +08:00 [DBG] Creating refresh token
2019-08-29 16:10:32.326 +08:00 [DBG] Setting an absolute lifetime: 2592000
2019-08-29 16:10:32.327 +08:00 [DBG] q4WLwYuV+Atk+4LZIWakYwI+SLfuxGYfp9IO9BsUf8c= not found in database
2019-08-29 16:10:32.331 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:32.331 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:32.332 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:32.334 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2019-08-29 16:10:32.334 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc
2019-08-29 16:10:32.334 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2019-08-29 16:10:32.338 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****Y8aw","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****bc33","$type":"Token"},{"TokenType":"access_token","TokenValue":"****TNng","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000033","TimeStamp":"2019-08-29T08:10:32.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:10:32.339 +08:00 [DBG] Token request success.
2019-08-29 16:10:32.341 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2019-08-29 16:10:32.341 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2019-08-29 16:10:32.341 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2019-08-29 16:10:32.341 +08:00 [DBG] Start userinfo request
2019-08-29 16:10:32.341 +08:00 [DBG] Bearer token found in header
2019-08-29 16:10:32.347 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:32.347 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:32.350 +08:00 [DBG] mvc found in database: true
2019-08-29 16:10:32.350 +08:00 [DBG] client configuration validation for client mvc succeeded.
2019-08-29 16:10:32.351 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2019-08-29 16:10:32.351 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1567066232,"exp":1567069832,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"c8661ec6-8a4f-44e3-bf1d-031a19934320","auth_time":1567066230,"idp":"local","role":["zero.tenantRole1:3d0a1642-c2e1-4031-96a9-4fc651c245c1","zero.Admin"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2019-08-29 16:10:32.351 +08:00 [DBG] Creating userinfo response
2019-08-29 16:10:32.351 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:10:32.351 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:10:32.353 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:32.353 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2019-08-29 16:10:32.353 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2019-08-29 16:10:32.354 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2019-08-29 16:10:32.355 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2019-08-29 16:10:32.355 +08:00 [DBG] End userinfo request
2019-08-29 16:10:36.902 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2019-08-29 16:10:36.903 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2019-08-29 16:10:36.903 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2019-08-29 16:10:36.903 +08:00 [DBG] Start authorize request
2019-08-29 16:10:36.903 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:10:36.903 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:36.907 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:36.907 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:36.908 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:36.911 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:36.912 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:36.915 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:36.915 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:36.915 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE2OjEwOjM2IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"bbb63f0cfafd41e1485652a4e777d608","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE2OjEwOjM2IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:10:36.917 +08:00 [DBG] 3408VPYI9zAywsHZm2qyGxUv5m7x2/zwKWDgPR+bh/M= found in database: false
2019-08-29 16:10:36.917 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|c8661ec6-8a4f-44e3-bf1d-031a19934320 not found in store.
2019-08-29 16:10:36.917 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 16:10:36.917 +08:00 [INF] Showing consent: User has not yet consented
2019-08-29 16:10:36.924 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:36.927 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:36.927 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:36.928 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:36.931 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:36.931 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:36.933 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:36.933 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:36.936 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:36.936 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:36.937 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:36.939 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:38.009 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2019-08-29 16:10:38.011 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:38.014 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:38.014 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:38.015 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:38.018 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:38.018 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:38.021 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:38.021 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:38.021 +08:00 [INF] {"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"zero_identity_api_swaggerui","RequestedScopes":["zero_identity_api"],"GrantedScopes":["zero_identity_api"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000037","TimeStamp":"2019-08-29T08:10:38.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2019-08-29 16:10:38.024 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:38.024 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:38.030 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2019-08-29 16:10:38.031 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2019-08-29 16:10:38.031 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2019-08-29 16:10:38.031 +08:00 [DBG] Start authorize callback request
2019-08-29 16:10:38.031 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:10:38.031 +08:00 [DBG] Start authorize request protocol validation
2019-08-29 16:10:38.035 +08:00 [DBG] zero_identity_api_swaggerui found in database: true
2019-08-29 16:10:38.035 +08:00 [DBG] client configuration validation for client zero_identity_api_swaggerui succeeded.
2019-08-29 16:10:38.036 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:38.039 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:38.040 +08:00 [DBG] Found [] identity scopes in database
2019-08-29 16:10:38.042 +08:00 [DBG] Found ["zero_identity_api"] API scopes in database
2019-08-29 16:10:38.042 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2019-08-29 16:10:38.042 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","AllowedRedirectUris":["http://localhost:9001/swagger/oauth2-redirect.html"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"token","ResponseMode":"fragment","GrantType":"implicit","RequestedScopes":"zero_identity_api","State":"VGh1IEF1ZyAyOSAyMDE5IDE2OjEwOjM2IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"bbb63f0cfafd41e1485652a4e777d608","Raw":{"response_type":"token","client_id":"zero_identity_api_swaggerui","redirect_uri":"http://localhost:9001/swagger/oauth2-redirect.html","scope":"zero_identity_api","state":"VGh1IEF1ZyAyOSAyMDE5IDE2OjEwOjM2IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ=="},"$type":"AuthorizeRequestValidationLog"}
2019-08-29 16:10:38.044 +08:00 [DBG] 3408VPYI9zAywsHZm2qyGxUv5m7x2/zwKWDgPR+bh/M= found in database: false
2019-08-29 16:10:38.044 +08:00 [DBG] user_consent grant with value: zero_identity_api_swaggerui|c8661ec6-8a4f-44e3-bf1d-031a19934320 not found in store.
2019-08-29 16:10:38.044 +08:00 [DBG] Found no prior consent from consent store, consent is required
2019-08-29 16:10:38.044 +08:00 [INF] User consented to scopes: ["zero_identity_api"]
2019-08-29 16:10:38.044 +08:00 [DBG] User indicated to remember consent for scopes: ["zero_identity_api"]
2019-08-29 16:10:38.044 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:10:38.045 +08:00 [DBG] 3408VPYI9zAywsHZm2qyGxUv5m7x2/zwKWDgPR+bh/M= not found in database
2019-08-29 16:10:38.047 +08:00 [DBG] Creating Implicit Flow response.
2019-08-29 16:10:38.047 +08:00 [DBG] Getting claims for access token for client: zero_identity_api_swaggerui
2019-08-29 16:10:38.047 +08:00 [DBG] Getting claims for access token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2019-08-29 16:10:38.053 +08:00 [INF] {"ClientId":"zero_identity_api_swaggerui","ClientName":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","Endpoint":"Authorize","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"zero_identity_api","GrantType":"implicit","Tokens":[{"TokenType":"access_token","TokenValue":"****-4sA","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLPCB0DTLHE6:00000038","TimeStamp":"2019-08-29T08:10:38.0000000Z","ProcessId":9076,"LocalIpAddress":"127.0.0.1:34573","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2019-08-29 16:10:38.053 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"zero_identity_api_swaggerui","RedirectUri":"http://localhost:9001/swagger/oauth2-redirect.html","State":"VGh1IEF1ZyAyOSAyMDE5IDE2OjEwOjM2IEdNVCswODAwIChDaGluYSBTdGFuZGFyZCBUaW1lKQ==","Scope":"zero_identity_api","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2019-08-29 16:10:38.053 +08:00 [DBG] Augmenting SignInContext
2019-08-29 16:10:38.054 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2020-02-24 16:12:23.206 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2020-02-24 16:12:23.253 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2020-02-24 16:12:23.253 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2020-02-24 16:12:23.253 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2020-02-24 16:12:23.253 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2020-02-24 16:12:23.253 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2020-02-24 16:12:23.254 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2020-02-24 16:12:23.385 +08:00 [DBG] Starting grant removal
2020-02-24 16:12:23.672 +08:00 [DBG] Login Url: /Account/Login
2020-02-24 16:12:23.673 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2020-02-24 16:12:23.673 +08:00 [DBG] Logout Url: /Account/Logout
2020-02-24 16:12:23.673 +08:00 [DBG] ConsentUrl Url: /consent
2020-02-24 16:12:23.673 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2020-02-24 16:12:23.673 +08:00 [DBG] Error Url: /home/error
2020-02-24 16:12:23.673 +08:00 [DBG] Error Id Parameter: errorId
2020-02-24 16:12:23.819 +08:00 [DBG] Stopping grant removal
2020-02-24 16:12:23.821 +08:00 [DBG] TaskCanceledException. Exiting.
2020-02-24 16:12:26.010 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2020-02-24 16:12:26.051 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2020-02-24 16:12:26.051 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2020-02-24 16:12:26.051 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2020-02-24 16:12:26.051 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2020-02-24 16:12:26.051 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2020-02-24 16:12:26.051 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2020-02-24 16:12:26.173 +08:00 [DBG] Starting grant removal
2020-02-24 16:12:26.454 +08:00 [DBG] Login Url: /Account/Login
2020-02-24 16:12:26.455 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2020-02-24 16:12:26.455 +08:00 [DBG] Logout Url: /Account/Logout
2020-02-24 16:12:26.455 +08:00 [DBG] ConsentUrl Url: /consent
2020-02-24 16:12:26.455 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2020-02-24 16:12:26.455 +08:00 [DBG] Error Url: /home/error
2020-02-24 16:12:26.455 +08:00 [DBG] Error Id Parameter: errorId
2020-02-24 16:12:30.323 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2020-02-24 16:12:30.328 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2020-02-24 16:12:30.328 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2020-02-24 16:12:30.332 +08:00 [DBG] Start discovery request
2020-02-24 16:12:32.876 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2020-02-24 16:12:32.979 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2020-02-24 16:12:32.979 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2020-02-24 16:12:32.979 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2020-02-24 16:12:32.982 +08:00 [DBG] Start key discovery request
2020-02-24 16:12:33.054 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2020-02-24 16:12:33.061 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2020-02-24 16:12:33.061 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2020-02-24 16:12:33.064 +08:00 [DBG] Start authorize request
2020-02-24 16:12:33.072 +08:00 [DBG] No user present in authorize request
2020-02-24 16:12:33.076 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:33.296 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:33.304 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:33.316 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:33.317 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:33.361 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:33.467 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:33.475 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:33.478 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:33.485 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:33.495 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpA1XvhXZciUs_b1UvoNih5q7jMJddh79OPWkGznAzLg5Cr_FQ9BNBPbuLlWIVz6nEInYCN5X-SWrBY7v5YA1LKa3Mj9NfOSzfw-GnSRtJdyKNe0RbAlIqfAi2zR9q-24F4GVoNSZMz3WU0-oyVzM0ZWxqPuJ62JzoMsrQdfExAIOO-bc6lOuCWdsrX4CfR1ghB6yKY-b0Nl7lolVmOZOAkb6TWPGyswGBwY1lt_SsXMhGUngIoAyHCgWVH7q3_yET4v3VUWHgYOeI-ZTZx6gFzGxK2u4W37wHUCJYRmMQDJ9pE6dI8W8vJq458sCXY5yw","UiLocales":null,"Nonce":"637181287530077787.Zjc2NmE1NmQtNTg1NC00NWY5LWJmMDktZTI1YTc1OTQzNzdlMmFjM2NlMWUtZjZjZS00ZDkxLWFmNjUtYmNjNDc2ZmIxZGI4","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181287530077787.Zjc2NmE1NmQtNTg1NC00NWY5LWJmMDktZTI1YTc1OTQzNzdlMmFjM2NlMWUtZjZjZS00ZDkxLWFmNjUtYmNjNDc2ZmIxZGI4","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpA1XvhXZciUs_b1UvoNih5q7jMJddh79OPWkGznAzLg5Cr_FQ9BNBPbuLlWIVz6nEInYCN5X-SWrBY7v5YA1LKa3Mj9NfOSzfw-GnSRtJdyKNe0RbAlIqfAi2zR9q-24F4GVoNSZMz3WU0-oyVzM0ZWxqPuJ62JzoMsrQdfExAIOO-bc6lOuCWdsrX4CfR1ghB6yKY-b0Nl7lolVmOZOAkb6TWPGyswGBwY1lt_SsXMhGUngIoAyHCgWVH7q3_yET4v3VUWHgYOeI-ZTZx6gFzGxK2u4W37wHUCJYRmMQDJ9pE6dI8W8vJq458sCXY5yw","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:12:33.505 +08:00 [INF] Showing login: User is not authenticated
2020-02-24 16:12:33.587 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:33.590 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:33.590 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:33.590 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:33.590 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:33.591 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:33.594 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:33.595 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:33.597 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:33.597 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:33.602 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:33.602 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:40.307 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2020-02-24 16:12:40.351 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:40.354 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:40.354 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:40.354 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:40.354 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:40.355 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:40.358 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:40.359 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:40.361 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:40.361 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:40.381 +08:00 [INF] {"Username":"admin","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Failure","EventType":"Failure","Id":1001,"Message":"invalid credentials","ActivityId":"0HLTP054CM9AC:00000002","TimeStamp":"2020-02-24T08:12:40.0000000Z","ProcessId":13012,"LocalIpAddress":"127.0.0.1:45153","RemoteIpAddress":"::1","$type":"UserLoginFailureEvent"}
2020-02-24 16:12:40.383 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:40.386 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:40.386 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:40.386 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:40.386 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:40.387 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:40.390 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:40.391 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:40.393 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:40.393 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:40.396 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:40.396 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:44.368 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2020-02-24 16:12:44.371 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:44.375 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:44.375 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:44.375 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:44.375 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:44.376 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:44.379 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:44.380 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:44.382 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:44.382 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:44.383 +08:00 [INF] {"Username":"admin","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Failure","EventType":"Failure","Id":1001,"Message":"invalid credentials","ActivityId":"0HLTP054CM9A9:00000003","TimeStamp":"2020-02-24T08:12:44.0000000Z","ProcessId":13012,"LocalIpAddress":"127.0.0.1:45153","RemoteIpAddress":"::1","$type":"UserLoginFailureEvent"}
2020-02-24 16:12:44.383 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:44.386 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:44.386 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:44.386 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:44.386 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:44.387 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:44.389 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:44.390 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:44.393 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:44.393 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:44.396 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:44.396 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:46.863 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2020-02-24 16:12:46.864 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:46.868 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:46.868 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:46.868 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:46.868 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:46.870 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:46.872 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:46.873 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:46.875 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:46.875 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:47.006 +08:00 [DBG] Augmenting SignInContext
2020-02-24 16:12:47.008 +08:00 [DBG] Adding idp claim with value: local
2020-02-24 16:12:47.008 +08:00 [DBG] Adding amr claim with value: pwd
2020-02-24 16:12:47.008 +08:00 [DBG] Adding auth_time claim with value: 1582531967
2020-02-24 16:12:47.017 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2020-02-24 16:12:47.020 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","DisplayName":"alice","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLTP054CM9A8:00000003","TimeStamp":"2020-02-24T08:12:47.0000000Z","ProcessId":13012,"LocalIpAddress":"127.0.0.1:45153","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2020-02-24 16:12:47.024 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:47.024 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:47.035 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2020-02-24 16:12:47.037 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2020-02-24 16:12:47.037 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2020-02-24 16:12:47.041 +08:00 [DBG] Start authorize callback request
2020-02-24 16:12:47.046 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:12:47.046 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:47.048 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:47.048 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:47.048 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:47.049 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:47.050 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:47.052 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:47.053 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:47.055 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:47.055 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:47.055 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpA1XvhXZciUs_b1UvoNih5q7jMJddh79OPWkGznAzLg5Cr_FQ9BNBPbuLlWIVz6nEInYCN5X-SWrBY7v5YA1LKa3Mj9NfOSzfw-GnSRtJdyKNe0RbAlIqfAi2zR9q-24F4GVoNSZMz3WU0-oyVzM0ZWxqPuJ62JzoMsrQdfExAIOO-bc6lOuCWdsrX4CfR1ghB6yKY-b0Nl7lolVmOZOAkb6TWPGyswGBwY1lt_SsXMhGUngIoAyHCgWVH7q3_yET4v3VUWHgYOeI-ZTZx6gFzGxK2u4W37wHUCJYRmMQDJ9pE6dI8W8vJq458sCXY5yw","UiLocales":null,"Nonce":"637181287530077787.Zjc2NmE1NmQtNTg1NC00NWY5LWJmMDktZTI1YTc1OTQzNzdlMmFjM2NlMWUtZjZjZS00ZDkxLWFmNjUtYmNjNDc2ZmIxZGI4","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"64eb36e6f3f7240cb47b1c72c0459739","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181287530077787.Zjc2NmE1NmQtNTg1NC00NWY5LWJmMDktZTI1YTc1OTQzNzdlMmFjM2NlMWUtZjZjZS00ZDkxLWFmNjUtYmNjNDc2ZmIxZGI4","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpA1XvhXZciUs_b1UvoNih5q7jMJddh79OPWkGznAzLg5Cr_FQ9BNBPbuLlWIVz6nEInYCN5X-SWrBY7v5YA1LKa3Mj9NfOSzfw-GnSRtJdyKNe0RbAlIqfAi2zR9q-24F4GVoNSZMz3WU0-oyVzM0ZWxqPuJ62JzoMsrQdfExAIOO-bc6lOuCWdsrX4CfR1ghB6yKY-b0Nl7lolVmOZOAkb6TWPGyswGBwY1lt_SsXMhGUngIoAyHCgWVH7q3_yET4v3VUWHgYOeI-ZTZx6gFzGxK2u4W37wHUCJYRmMQDJ9pE6dI8W8vJq458sCXY5yw","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:12:47.082 +08:00 [DBG] Scopes contains offline_access, consent is required
2020-02-24 16:12:47.082 +08:00 [INF] Showing consent: User has not yet consented
2020-02-24 16:12:47.106 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:47.109 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:47.109 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:47.109 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:47.109 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:47.111 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:47.114 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:47.115 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:47.118 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:47.118 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:47.120 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:47.121 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:47.126 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:47.198 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:54.787 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2020-02-24 16:12:54.799 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:54.802 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:54.802 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:54.802 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:54.802 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:54.803 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:54.805 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:54.806 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:54.808 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:54.808 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:54.810 +08:00 [INF] {"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLTP054CM9AC:00000003","TimeStamp":"2020-02-24T08:12:54.0000000Z","ProcessId":13012,"LocalIpAddress":"127.0.0.1:45153","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2020-02-24 16:12:54.822 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:54.822 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:54.829 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2020-02-24 16:12:54.829 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2020-02-24 16:12:54.829 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2020-02-24 16:12:54.830 +08:00 [DBG] Start authorize callback request
2020-02-24 16:12:54.832 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:12:54.833 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:12:54.835 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:54.836 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:54.836 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:12:54.836 +08:00 [DBG] No PKCE used.
2020-02-24 16:12:54.837 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:54.839 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:54.840 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:54.843 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:54.843 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:12:54.843 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpA1XvhXZciUs_b1UvoNih5q7jMJddh79OPWkGznAzLg5Cr_FQ9BNBPbuLlWIVz6nEInYCN5X-SWrBY7v5YA1LKa3Mj9NfOSzfw-GnSRtJdyKNe0RbAlIqfAi2zR9q-24F4GVoNSZMz3WU0-oyVzM0ZWxqPuJ62JzoMsrQdfExAIOO-bc6lOuCWdsrX4CfR1ghB6yKY-b0Nl7lolVmOZOAkb6TWPGyswGBwY1lt_SsXMhGUngIoAyHCgWVH7q3_yET4v3VUWHgYOeI-ZTZx6gFzGxK2u4W37wHUCJYRmMQDJ9pE6dI8W8vJq458sCXY5yw","UiLocales":null,"Nonce":"637181287530077787.Zjc2NmE1NmQtNTg1NC00NWY5LWJmMDktZTI1YTc1OTQzNzdlMmFjM2NlMWUtZjZjZS00ZDkxLWFmNjUtYmNjNDc2ZmIxZGI4","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"64eb36e6f3f7240cb47b1c72c0459739","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181287530077787.Zjc2NmE1NmQtNTg1NC00NWY5LWJmMDktZTI1YTc1OTQzNzdlMmFjM2NlMWUtZjZjZS00ZDkxLWFmNjUtYmNjNDc2ZmIxZGI4","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpA1XvhXZciUs_b1UvoNih5q7jMJddh79OPWkGznAzLg5Cr_FQ9BNBPbuLlWIVz6nEInYCN5X-SWrBY7v5YA1LKa3Mj9NfOSzfw-GnSRtJdyKNe0RbAlIqfAi2zR9q-24F4GVoNSZMz3WU0-oyVzM0ZWxqPuJ62JzoMsrQdfExAIOO-bc6lOuCWdsrX4CfR1ghB6yKY-b0Nl7lolVmOZOAkb6TWPGyswGBwY1lt_SsXMhGUngIoAyHCgWVH7q3_yET4v3VUWHgYOeI-ZTZx6gFzGxK2u4W37wHUCJYRmMQDJ9pE6dI8W8vJq458sCXY5yw","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:12:54.844 +08:00 [DBG] Scopes contains offline_access, consent is required
2020-02-24 16:12:54.849 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2020-02-24 16:12:54.850 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2020-02-24 16:12:54.854 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:12:54.875 +08:00 [DBG] /8kaAjT/h9Y79NVOTTGYA5yPjxRltlmhK7ZhfQVAVf4= found in database
2020-02-24 16:12:54.987 +08:00 [DBG] Creating Hybrid Flow response.
2020-02-24 16:12:54.999 +08:00 [DBG] RWvULbO9x4zU7ErHE921ldCPpCWsJFfRA7CIQ1xmr7g= not found in database
2020-02-24 16:12:55.020 +08:00 [DBG] Creating Implicit Flow response.
2020-02-24 16:12:55.027 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc
2020-02-24 16:12:55.028 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2020-02-24 16:12:55.070 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****TW-g","$type":"Token"},{"TokenType":"code","TokenValue":"****080e","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLTP054CM9A9:00000004","TimeStamp":"2020-02-24T08:12:55.0000000Z","ProcessId":13012,"LocalIpAddress":"127.0.0.1:45153","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2020-02-24 16:12:55.071 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpA1XvhXZciUs_b1UvoNih5q7jMJddh79OPWkGznAzLg5Cr_FQ9BNBPbuLlWIVz6nEInYCN5X-SWrBY7v5YA1LKa3Mj9NfOSzfw-GnSRtJdyKNe0RbAlIqfAi2zR9q-24F4GVoNSZMz3WU0-oyVzM0ZWxqPuJ62JzoMsrQdfExAIOO-bc6lOuCWdsrX4CfR1ghB6yKY-b0Nl7lolVmOZOAkb6TWPGyswGBwY1lt_SsXMhGUngIoAyHCgWVH7q3_yET4v3VUWHgYOeI-ZTZx6gFzGxK2u4W37wHUCJYRmMQDJ9pE6dI8W8vJq458sCXY5yw","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2020-02-24 16:12:55.086 +08:00 [DBG] Augmenting SignInContext
2020-02-24 16:12:55.086 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2020-02-24 16:12:55.238 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2020-02-24 16:12:55.241 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2020-02-24 16:12:55.241 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2020-02-24 16:12:55.247 +08:00 [DBG] Start token request.
2020-02-24 16:12:55.251 +08:00 [DBG] Start client validation
2020-02-24 16:12:55.255 +08:00 [DBG] Start parsing Basic Authentication secret
2020-02-24 16:12:55.258 +08:00 [DBG] Start parsing for secret in post body
2020-02-24 16:12:55.258 +08:00 [DBG] Parser found secret: PostBodySecretParser
2020-02-24 16:12:55.258 +08:00 [DBG] Secret id found: mvc
2020-02-24 16:12:55.261 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:55.262 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:55.268 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2020-02-24 16:12:55.268 +08:00 [DBG] Client validation success
2020-02-24 16:12:55.268 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLTP054CM9A8:00000004","TimeStamp":"2020-02-24T08:12:55.0000000Z","ProcessId":13012,"LocalIpAddress":"127.0.0.1:45153","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2020-02-24 16:12:55.273 +08:00 [DBG] Start token request validation
2020-02-24 16:12:55.281 +08:00 [DBG] Start validation of authorization code token request
2020-02-24 16:12:55.292 +08:00 [DBG] RWvULbO9x4zU7ErHE921ldCPpCWsJFfRA7CIQ1xmr7g= found in database: true
2020-02-24 16:12:55.304 +08:00 [DBG] removing RWvULbO9x4zU7ErHE921ldCPpCWsJFfRA7CIQ1xmr7g= persisted grant from database
2020-02-24 16:12:55.319 +08:00 [DBG] Validation of authorization code token request success
2020-02-24 16:12:55.322 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"ad5bbb29ab9af2e3870abcc747e09eb4aa299b5c47e59883737c21e611c5080e","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"ad5bbb29ab9af2e3870abcc747e09eb4aa299b5c47e59883737c21e611c5080e","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2020-02-24 16:12:55.337 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:55.337 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:55.342 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:55.410 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:55.418 +08:00 [DBG] Getting claims for access token for client: mvc
2020-02-24 16:12:55.419 +08:00 [DBG] Getting claims for access token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:12:55.438 +08:00 [DBG] Creating refresh token
2020-02-24 16:12:55.438 +08:00 [DBG] Setting an absolute lifetime: 2592000
2020-02-24 16:12:55.446 +08:00 [DBG] atsP9WunqykZ/x1yk8GBFUmOUBwvwEP3JyPqCHDRaA4= not found in database
2020-02-24 16:12:55.451 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:55.451 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:55.452 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:55.455 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:12:55.455 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc
2020-02-24 16:12:55.455 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2020-02-24 16:12:55.460 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****EOIA","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****8e21","$type":"Token"},{"TokenType":"access_token","TokenValue":"****gROg","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLTP054CM9A8:00000004","TimeStamp":"2020-02-24T08:12:55.0000000Z","ProcessId":13012,"LocalIpAddress":"127.0.0.1:45153","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2020-02-24 16:12:55.462 +08:00 [DBG] Token request success.
2020-02-24 16:12:55.472 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2020-02-24 16:12:55.473 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2020-02-24 16:12:55.473 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2020-02-24 16:12:55.478 +08:00 [DBG] Start userinfo request
2020-02-24 16:12:55.481 +08:00 [DBG] Bearer token found in header
2020-02-24 16:12:55.502 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:55.502 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:55.507 +08:00 [DBG] mvc found in database: true
2020-02-24 16:12:55.507 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:12:55.511 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2020-02-24 16:12:55.512 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1582531975,"exp":1582535575,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"c8661ec6-8a4f-44e3-bf1d-031a19934320","auth_time":1582531967,"idp":"local","role":["zero.tenantRole1:3d0a1642-c2e1-4031-96a9-4fc651c245c1","zero.Admin"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2020-02-24 16:12:55.521 +08:00 [DBG] Creating userinfo response
2020-02-24 16:12:55.524 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:12:55.526 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:12:55.529 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:55.530 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2020-02-24 16:12:55.530 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:12:55.531 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:12:55.534 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2020-02-24 16:12:55.534 +08:00 [DBG] End userinfo request
2020-02-24 16:22:46.074 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2020-02-24 16:22:46.126 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2020-02-24 16:22:46.126 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2020-02-24 16:22:46.126 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2020-02-24 16:22:46.126 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2020-02-24 16:22:46.126 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2020-02-24 16:22:46.127 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2020-02-24 16:22:46.270 +08:00 [DBG] Starting grant removal
2020-02-24 16:22:46.538 +08:00 [DBG] Login Url: /Account/Login
2020-02-24 16:22:46.540 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2020-02-24 16:22:46.540 +08:00 [DBG] Logout Url: /Account/Logout
2020-02-24 16:22:46.540 +08:00 [DBG] ConsentUrl Url: /consent
2020-02-24 16:22:46.540 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2020-02-24 16:22:46.540 +08:00 [DBG] Error Url: /home/error
2020-02-24 16:22:46.540 +08:00 [DBG] Error Id Parameter: errorId
2020-02-24 16:24:30.886 +08:00 [INF] Starting IdentityServer4 version 2.5.1.0
2020-02-24 16:24:30.928 +08:00 [INF] Using the default authentication scheme Identity.Application for IdentityServer
2020-02-24 16:24:30.928 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for authentication
2020-02-24 16:24:30.928 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-in
2020-02-24 16:24:30.928 +08:00 [DBG] Using Identity.External as default ASP.NET Core scheme for sign-out
2020-02-24 16:24:30.928 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for challenge
2020-02-24 16:24:30.928 +08:00 [DBG] Using Identity.Application as default ASP.NET Core scheme for forbid
2020-02-24 16:24:31.062 +08:00 [DBG] Starting grant removal
2020-02-24 16:24:31.247 +08:00 [DBG] Login Url: /Account/Login
2020-02-24 16:24:31.248 +08:00 [DBG] Login Return Url Parameter: ReturnUrl
2020-02-24 16:24:31.248 +08:00 [DBG] Logout Url: /Account/Logout
2020-02-24 16:24:31.248 +08:00 [DBG] ConsentUrl Url: /consent
2020-02-24 16:24:31.248 +08:00 [DBG] Consent Return Url Parameter: returnUrl
2020-02-24 16:24:31.248 +08:00 [DBG] Error Url: /home/error
2020-02-24 16:24:31.248 +08:00 [DBG] Error Id Parameter: errorId
2020-02-24 16:25:23.474 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2020-02-24 16:25:23.478 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2020-02-24 16:25:23.478 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2020-02-24 16:25:23.482 +08:00 [DBG] Start discovery request
2020-02-24 16:25:23.808 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2020-02-24 16:25:23.888 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2020-02-24 16:25:23.888 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2020-02-24 16:25:23.888 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2020-02-24 16:25:23.891 +08:00 [DBG] Start key discovery request
2020-02-24 16:25:23.934 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2020-02-24 16:25:23.937 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2020-02-24 16:25:23.937 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2020-02-24 16:25:23.940 +08:00 [DBG] Start authorize request
2020-02-24 16:25:23.947 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:25:23.954 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:25:24.083 +08:00 [DBG] mvc found in database: true
2020-02-24 16:25:24.091 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:25:24.107 +08:00 [ERR] Invalid redirect_uri: http://localhost:5003/signin-oidc
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":null,"ResponseMode":null,"GrantType":null,"RequestedScopes":"","State":null,"UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5003/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181295239116056.NDBkMzE4ZDMtNmZiNS00YzNkLWI5NzgtYjRmNjk5ZTkxMDNhOTQyYmI0YWUtMDExMy00MTM3LTk5N2QtYWVhZTNjYjU1MDlj","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpnHr2y0j9cQYA1W5an-FB5G0RolzrCPytmi3kjB-mHyinkFVpmp4pveu8kZZg0_qM8ItijFP4VZHfS5nGYkGQdI8O0keB1hUak7-RupSyI2iq_GqBt6RSZUOI4lBWPMIRORawYdIz6NYE6nX3lWHnNDwS6KHN9HQkzbqwc4VIvhBorYSzW9ZwWARoJ1YoOpcaZzl_nLKfnf2Q0YaUI9H_ux1NRtKXzasGaZu_U7fPCaKy4iDuxOQ_GZvSU9a1FKwc2MU3vABjZDKjpfohRKPPcfcPtVWmfWAn7HGxI8v6S5KW8LR0MpTsVTR1kua9XiQg","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:25:24.112 +08:00 [ERR] Request validation failed
2020-02-24 16:25:24.112 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":null,"ResponseMode":null,"GrantType":null,"RequestedScopes":"","State":null,"UiLocales":null,"Nonce":null,"AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5003/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181295239116056.NDBkMzE4ZDMtNmZiNS00YzNkLWI5NzgtYjRmNjk5ZTkxMDNhOTQyYmI0YWUtMDExMy00MTM3LTk5N2QtYWVhZTNjYjU1MDlj","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpnHr2y0j9cQYA1W5an-FB5G0RolzrCPytmi3kjB-mHyinkFVpmp4pveu8kZZg0_qM8ItijFP4VZHfS5nGYkGQdI8O0keB1hUak7-RupSyI2iq_GqBt6RSZUOI4lBWPMIRORawYdIz6NYE6nX3lWHnNDwS6KHN9HQkzbqwc4VIvhBorYSzW9ZwWARoJ1YoOpcaZzl_nLKfnf2Q0YaUI9H_ux1NRtKXzasGaZu_U7fPCaKy4iDuxOQ_GZvSU9a1FKwc2MU3vABjZDKjpfohRKPPcfcPtVWmfWAn7HGxI8v6S5KW8LR0MpTsVTR1kua9XiQg","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:25:24.119 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Authorize","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"","GrantType":null,"Error":"unauthorized_client","ErrorDescription":"Invalid redirect_uri","Category":"Token","Name":"Token Issued Failure","EventType":"Failure","Id":2001,"Message":null,"ActivityId":"0HLTP0BSCONTF:00000007","TimeStamp":"2020-02-24T08:25:24.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"TokenIssuedFailureEvent"}
2020-02-24 16:26:05.151 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2020-02-24 16:26:05.151 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2020-02-24 16:26:05.151 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2020-02-24 16:26:05.151 +08:00 [DBG] Start discovery request
2020-02-24 16:26:05.156 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2020-02-24 16:26:05.221 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2020-02-24 16:26:05.221 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2020-02-24 16:26:05.222 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2020-02-24 16:26:05.222 +08:00 [DBG] Start key discovery request
2020-02-24 16:26:05.264 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2020-02-24 16:26:05.265 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2020-02-24 16:26:05.265 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2020-02-24 16:26:05.265 +08:00 [DBG] Start authorize request
2020-02-24 16:26:05.265 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:26:05.265 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:05.269 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:05.269 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:05.273 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:05.275 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:05.323 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:05.426 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:05.435 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:05.437 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:05.444 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:05.444 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc2","ClientName":"MVC Client2","RedirectUri":"http://localhost:5003/signin-oidc","AllowedRedirectUris":["http://localhost:5003/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvp-i0YeEi_W76HknV0Cw8eQ2cwX8i0RLRj__DgLr-ih4MTYImx0fCqXGWWfPp_jpHqP2SW_XkuVdPVLFcQEa3Kjmg9cAidkoK3buvntbExWFlkEuWr5qSbBOiOLwExGP-DHMTXHLhkSsUQVUFV34HBGA0WqdDdoAzCIYzf_PCgYXLhvwxy1ikHztuAFnZ13SyusS38fOChi3OO7MyLoM8LYn1VLbRs5ax-JG1hAadUttzq6kSxY2jvHgURglcYor4RHFYQLY_SfNtAzAzPvrWEd4Q9VctpFY4wmYylH8pbC91uiri8G6rdtPQeWKra4a2E","UiLocales":null,"Nonce":"637181295652380112.MGQ0ODM4MjItODlmZC00YWE0LWEzOTgtYTAzYmY2ZDQ1MzIxNTk2YzlkYmYtZGI1Mi00NzBjLWJhMTMtNjk3YjAwNjY5Nzgz","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"64eb36e6f3f7240cb47b1c72c0459739","Raw":{"client_id":"mvc2","redirect_uri":"http://localhost:5003/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181295652380112.MGQ0ODM4MjItODlmZC00YWE0LWEzOTgtYTAzYmY2ZDQ1MzIxNTk2YzlkYmYtZGI1Mi00NzBjLWJhMTMtNjk3YjAwNjY5Nzgz","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvp-i0YeEi_W76HknV0Cw8eQ2cwX8i0RLRj__DgLr-ih4MTYImx0fCqXGWWfPp_jpHqP2SW_XkuVdPVLFcQEa3Kjmg9cAidkoK3buvntbExWFlkEuWr5qSbBOiOLwExGP-DHMTXHLhkSsUQVUFV34HBGA0WqdDdoAzCIYzf_PCgYXLhvwxy1ikHztuAFnZ13SyusS38fOChi3OO7MyLoM8LYn1VLbRs5ax-JG1hAadUttzq6kSxY2jvHgURglcYor4RHFYQLY_SfNtAzAzPvrWEd4Q9VctpFY4wmYylH8pbC91uiri8G6rdtPQeWKra4a2E","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:26:05.480 +08:00 [DBG] Scopes contains offline_access, consent is required
2020-02-24 16:26:05.480 +08:00 [INF] Showing consent: User has not yet consented
2020-02-24 16:26:05.515 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:05.518 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:05.518 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:05.518 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:05.518 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:05.520 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:05.522 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:05.523 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:05.525 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:05.525 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:05.529 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:05.529 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:05.534 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:05.601 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:07.850 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:07.854 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:07.854 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:07.854 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:07.854 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:07.855 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:07.858 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:07.859 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:07.861 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:07.862 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:07.865 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:07.865 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:07.866 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:07.868 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.052 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:08.054 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.054 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.055 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:08.055 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:08.056 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.058 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.059 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.061 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.061 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:08.064 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.064 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.065 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.067 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.229 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:08.233 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.233 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.233 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:08.233 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:08.235 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.238 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.239 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.241 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.241 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:08.244 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.244 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.245 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.248 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.398 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:08.402 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.403 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.403 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:08.403 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:08.404 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.406 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.407 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.410 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.411 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:08.414 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.414 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.415 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.418 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.535 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:08.537 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.538 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.538 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:08.538 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:08.539 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.541 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.542 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.545 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.545 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:08.548 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.548 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.549 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.552 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.760 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:08.764 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.764 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.764 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:08.764 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:08.766 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.768 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.769 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.772 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.772 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:08.775 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.775 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.776 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.779 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.847 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:08.850 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.851 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.851 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:08.851 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:08.852 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.854 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.855 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.857 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:08.858 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:08.860 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:08.861 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:08.862 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:08.864 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:21.023 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2020-02-24 16:26:21.050 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:21.053 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:21.053 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:21.053 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:21.053 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:21.054 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:21.057 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:21.058 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:21.060 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:21.060 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:21.061 +08:00 [INF] {"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc2","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLTP0BSCONTI:00000013","TimeStamp":"2020-02-24T08:26:21.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2020-02-24 16:26:21.075 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:21.075 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:21.084 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2020-02-24 16:26:21.085 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2020-02-24 16:26:21.085 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2020-02-24 16:26:21.090 +08:00 [DBG] Start authorize callback request
2020-02-24 16:26:21.093 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:26:21.093 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:26:21.097 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:21.097 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:21.097 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:26:21.097 +08:00 [DBG] No PKCE used.
2020-02-24 16:26:21.099 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:21.101 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:21.103 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:21.105 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:21.105 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:26:21.105 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc2","ClientName":"MVC Client2","RedirectUri":"http://localhost:5003/signin-oidc","AllowedRedirectUris":["http://localhost:5003/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvp-i0YeEi_W76HknV0Cw8eQ2cwX8i0RLRj__DgLr-ih4MTYImx0fCqXGWWfPp_jpHqP2SW_XkuVdPVLFcQEa3Kjmg9cAidkoK3buvntbExWFlkEuWr5qSbBOiOLwExGP-DHMTXHLhkSsUQVUFV34HBGA0WqdDdoAzCIYzf_PCgYXLhvwxy1ikHztuAFnZ13SyusS38fOChi3OO7MyLoM8LYn1VLbRs5ax-JG1hAadUttzq6kSxY2jvHgURglcYor4RHFYQLY_SfNtAzAzPvrWEd4Q9VctpFY4wmYylH8pbC91uiri8G6rdtPQeWKra4a2E","UiLocales":null,"Nonce":"637181295652380112.MGQ0ODM4MjItODlmZC00YWE0LWEzOTgtYTAzYmY2ZDQ1MzIxNTk2YzlkYmYtZGI1Mi00NzBjLWJhMTMtNjk3YjAwNjY5Nzgz","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"64eb36e6f3f7240cb47b1c72c0459739","Raw":{"client_id":"mvc2","redirect_uri":"http://localhost:5003/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181295652380112.MGQ0ODM4MjItODlmZC00YWE0LWEzOTgtYTAzYmY2ZDQ1MzIxNTk2YzlkYmYtZGI1Mi00NzBjLWJhMTMtNjk3YjAwNjY5Nzgz","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvp-i0YeEi_W76HknV0Cw8eQ2cwX8i0RLRj__DgLr-ih4MTYImx0fCqXGWWfPp_jpHqP2SW_XkuVdPVLFcQEa3Kjmg9cAidkoK3buvntbExWFlkEuWr5qSbBOiOLwExGP-DHMTXHLhkSsUQVUFV34HBGA0WqdDdoAzCIYzf_PCgYXLhvwxy1ikHztuAFnZ13SyusS38fOChi3OO7MyLoM8LYn1VLbRs5ax-JG1hAadUttzq6kSxY2jvHgURglcYor4RHFYQLY_SfNtAzAzPvrWEd4Q9VctpFY4wmYylH8pbC91uiri8G6rdtPQeWKra4a2E","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:26:21.107 +08:00 [DBG] Scopes contains offline_access, consent is required
2020-02-24 16:26:21.111 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2020-02-24 16:26:21.113 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2020-02-24 16:26:21.117 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:26:21.135 +08:00 [DBG] skXvHI6WvJVHy+U6EB1r6kagoJfqzmsa/tD642vA4No= not found in database
2020-02-24 16:26:21.157 +08:00 [DBG] Creating Hybrid Flow response.
2020-02-24 16:26:21.170 +08:00 [DBG] va3jg39dA49vP8AlwImSQFno3aHBEYICc2WsXG1lZkM= not found in database
2020-02-24 16:26:21.175 +08:00 [DBG] Creating Implicit Flow response.
2020-02-24 16:26:21.182 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc2
2020-02-24 16:26:21.184 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2020-02-24 16:26:21.218 +08:00 [INF] {"ClientId":"mvc2","ClientName":"MVC Client2","RedirectUri":"http://localhost:5003/signin-oidc","Endpoint":"Authorize","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****PMXg","$type":"Token"},{"TokenType":"code","TokenValue":"****48b7","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLTP0BSCONTG:00000014","TimeStamp":"2020-02-24T08:26:21.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2020-02-24 16:26:21.220 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc2","RedirectUri":"http://localhost:5003/signin-oidc","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvp-i0YeEi_W76HknV0Cw8eQ2cwX8i0RLRj__DgLr-ih4MTYImx0fCqXGWWfPp_jpHqP2SW_XkuVdPVLFcQEa3Kjmg9cAidkoK3buvntbExWFlkEuWr5qSbBOiOLwExGP-DHMTXHLhkSsUQVUFV34HBGA0WqdDdoAzCIYzf_PCgYXLhvwxy1ikHztuAFnZ13SyusS38fOChi3OO7MyLoM8LYn1VLbRs5ax-JG1hAadUttzq6kSxY2jvHgURglcYor4RHFYQLY_SfNtAzAzPvrWEd4Q9VctpFY4wmYylH8pbC91uiri8G6rdtPQeWKra4a2E","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2020-02-24 16:26:21.237 +08:00 [DBG] Augmenting SignInContext
2020-02-24 16:26:21.244 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2020-02-24 16:26:21.422 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2020-02-24 16:26:21.425 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2020-02-24 16:26:21.425 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2020-02-24 16:26:21.431 +08:00 [DBG] Start token request.
2020-02-24 16:26:21.436 +08:00 [DBG] Start client validation
2020-02-24 16:26:21.440 +08:00 [DBG] Start parsing Basic Authentication secret
2020-02-24 16:26:21.443 +08:00 [DBG] Start parsing for secret in post body
2020-02-24 16:26:21.443 +08:00 [DBG] Parser found secret: PostBodySecretParser
2020-02-24 16:26:21.443 +08:00 [DBG] Secret id found: mvc2
2020-02-24 16:26:21.447 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:21.447 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:21.454 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2020-02-24 16:26:21.454 +08:00 [DBG] Client validation success
2020-02-24 16:26:21.454 +08:00 [INF] {"ClientId":"mvc2","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLTP0BSCONTH:00000014","TimeStamp":"2020-02-24T08:26:21.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2020-02-24 16:26:21.460 +08:00 [DBG] Start token request validation
2020-02-24 16:26:21.468 +08:00 [DBG] Start validation of authorization code token request
2020-02-24 16:26:21.480 +08:00 [DBG] va3jg39dA49vP8AlwImSQFno3aHBEYICc2WsXG1lZkM= found in database: true
2020-02-24 16:26:21.492 +08:00 [DBG] removing va3jg39dA49vP8AlwImSQFno3aHBEYICc2WsXG1lZkM= persisted grant from database
2020-02-24 16:26:21.506 +08:00 [DBG] Validation of authorization code token request success
2020-02-24 16:26:21.510 +08:00 [INF] Token request validation success, {"ClientId":"mvc2","ClientName":"MVC Client2","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"1082f31fa23383fd5d14f54d25ae4c027c918070077b21492dcc0d7788ba48b7","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc2","client_secret":"***REDACTED***","code":"1082f31fa23383fd5d14f54d25ae4c027c918070077b21492dcc0d7788ba48b7","grant_type":"authorization_code","redirect_uri":"http://localhost:5003/signin-oidc"},"$type":"TokenRequestValidationLog"}
2020-02-24 16:26:21.527 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:21.527 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:21.532 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:21.602 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:21.610 +08:00 [DBG] Getting claims for access token for client: mvc2
2020-02-24 16:26:21.611 +08:00 [DBG] Getting claims for access token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:26:21.707 +08:00 [DBG] Creating refresh token
2020-02-24 16:26:21.707 +08:00 [DBG] Setting an absolute lifetime: 2592000
2020-02-24 16:26:21.716 +08:00 [DBG] Fz4z91yQNfKFrqYQ1CTI9Y9wzBahCw6RCKKCewCL+YQ= not found in database
2020-02-24 16:26:21.721 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:21.721 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:21.722 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:21.725 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:26:21.725 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc2
2020-02-24 16:26:21.725 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2020-02-24 16:26:21.730 +08:00 [INF] {"ClientId":"mvc2","ClientName":"MVC Client2","RedirectUri":null,"Endpoint":"Token","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****n04Q","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****e894","$type":"Token"},{"TokenType":"access_token","TokenValue":"****Yclw","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLTP0BSCONTH:00000014","TimeStamp":"2020-02-24T08:26:21.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2020-02-24 16:26:21.732 +08:00 [DBG] Token request success.
2020-02-24 16:26:21.742 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2020-02-24 16:26:21.742 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2020-02-24 16:26:21.743 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2020-02-24 16:26:21.748 +08:00 [DBG] Start userinfo request
2020-02-24 16:26:21.751 +08:00 [DBG] Bearer token found in header
2020-02-24 16:26:21.771 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:21.772 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:21.777 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:26:21.777 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:26:21.781 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2020-02-24 16:26:21.782 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1582532781,"exp":1582536381,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc2","sub":"c8661ec6-8a4f-44e3-bf1d-031a19934320","auth_time":1582531967,"idp":"local","role":["zero.tenantRole1:3d0a1642-c2e1-4031-96a9-4fc651c245c1","zero.Admin"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2020-02-24 16:26:21.788 +08:00 [DBG] Creating userinfo response
2020-02-24 16:26:21.791 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:26:21.793 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:26:21.797 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:21.797 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2020-02-24 16:26:21.797 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:26:21.798 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:26:21.802 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2020-02-24 16:26:21.802 +08:00 [DBG] End userinfo request
2020-02-24 16:30:27.042 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2020-02-24 16:30:27.042 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2020-02-24 16:30:27.042 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2020-02-24 16:30:27.042 +08:00 [DBG] Start discovery request
2020-02-24 16:30:27.046 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2020-02-24 16:30:27.103 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2020-02-24 16:30:27.103 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2020-02-24 16:30:27.103 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2020-02-24 16:30:27.103 +08:00 [DBG] Start key discovery request
2020-02-24 16:30:27.131 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2020-02-24 16:30:27.133 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2020-02-24 16:30:27.133 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2020-02-24 16:30:27.133 +08:00 [DBG] Start authorize request
2020-02-24 16:30:27.133 +08:00 [DBG] No user present in authorize request
2020-02-24 16:30:27.133 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:30:27.137 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:30:27.137 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:30:27.138 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:30:27.138 +08:00 [DBG] No PKCE used.
2020-02-24 16:30:27.139 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:27.142 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:27.143 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:27.146 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:27.146 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:30:27.146 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc2","ClientName":"MVC Client2","RedirectUri":"http://localhost:5003/signin-oidc","AllowedRedirectUris":["http://localhost:5003/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpktumvQNbRAdz_hXDmCLlG4WGTi1cCrcALryBPfL64eUZvXHVSAauXSlIsmnpHXFd9CEj9tOBWporaCWIygQ4_XSkOahUiOblQj5KHXHPaKvdcDCq4NJpoRZP_XDb2PkuiF5MW2jelGbzq8LfZ9mjRxEVBwckcPhAfS_mPTPNPdcYd4mFgfcJVWWzrugNOggpc4-PdCDnYJrbw8_VIqoZkPEzxmzKCZjhDJNpl8VtWyBHIYkR3ct7gyCxcyfME4z-ounvYiYjXIly8QMgp6DMkBoF8Heb9EkDFJmA_DZWt1q1vyRHHUl6WG9V9YfCIn2Q","UiLocales":null,"Nonce":"637181298271162889.YzY5YmU3ZDEtZjQ4OS00ZGNjLWI3MGEtZWI4M2FhN2RlYTM5Y2M5NTBjYWItN2MwMS00NTQ0LWIzZWItMzA2MDFjY2Q1NWNk","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc2","redirect_uri":"http://localhost:5003/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181298271162889.YzY5YmU3ZDEtZjQ4OS00ZGNjLWI3MGEtZWI4M2FhN2RlYTM5Y2M5NTBjYWItN2MwMS00NTQ0LWIzZWItMzA2MDFjY2Q1NWNk","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvpktumvQNbRAdz_hXDmCLlG4WGTi1cCrcALryBPfL64eUZvXHVSAauXSlIsmnpHXFd9CEj9tOBWporaCWIygQ4_XSkOahUiOblQj5KHXHPaKvdcDCq4NJpoRZP_XDb2PkuiF5MW2jelGbzq8LfZ9mjRxEVBwckcPhAfS_mPTPNPdcYd4mFgfcJVWWzrugNOggpc4-PdCDnYJrbw8_VIqoZkPEzxmzKCZjhDJNpl8VtWyBHIYkR3ct7gyCxcyfME4z-ounvYiYjXIly8QMgp6DMkBoF8Heb9EkDFJmA_DZWt1q1vyRHHUl6WG9V9YfCIn2Q","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:30:27.146 +08:00 [INF] Showing login: User is not authenticated
2020-02-24 16:30:27.164 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:30:27.167 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:30:27.167 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:30:27.167 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:30:27.167 +08:00 [DBG] No PKCE used.
2020-02-24 16:30:27.168 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:27.171 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:27.172 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:27.174 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:27.174 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:30:27.178 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:30:27.178 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:30:31.772 +08:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2020-02-24 16:30:31.772 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2020-02-24 16:30:31.772 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2020-02-24 16:30:31.772 +08:00 [DBG] Start discovery request
2020-02-24 16:30:31.775 +08:00 [DBG] Found ["openid","profile","role","IdentityServerApi","zero_identity_api","api1","api2","apiall"] as all scopes in database
2020-02-24 16:30:31.833 +08:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2020-02-24 16:30:31.833 +08:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2020-02-24 16:30:31.833 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2020-02-24 16:30:31.833 +08:00 [DBG] Start key discovery request
2020-02-24 16:30:31.879 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2020-02-24 16:30:31.880 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2020-02-24 16:30:31.880 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2020-02-24 16:30:31.880 +08:00 [DBG] Start authorize request
2020-02-24 16:30:31.880 +08:00 [DBG] No user present in authorize request
2020-02-24 16:30:31.880 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:30:31.884 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:31.884 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:31.884 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:30:31.884 +08:00 [DBG] No PKCE used.
2020-02-24 16:30:31.885 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:31.887 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:31.889 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:31.891 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:31.891 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:30:31.891 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"anonymous","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoS5acSEZxfNu46YpoCgAwb1vVez0zSN8QsgtE4aPTwE2RNzFqa5uyWirmt8Nq3h82y1U2G1i1nw-1IOKY2sSCk3dDrxyXFPPRW2sSo9-ms8h8sbDt0JwiOI9n3wJ5qCxHLuCrJGQVQjCfztSRNgydBcaBk9XvsSg9I1pkMCQm1OlLqHuQIc6ElcdBfS11bm__iOH1MubXGC7Ht-6Dx7OCzpVyzlEl5i_pjodidbkprQUROa7Ucu38_4CHMGsX7TU-23p98kLEir46i6wW7201h4rJEvuoLtwZjSZm6lxBIRZkHwwqLNYLSrste-oPTKUw","UiLocales":null,"Nonce":"637181298318451284.OGQzMDUwNjgtN2FlMy00MGYxLThmZDAtNWJmMjQwZjRmNjg1NzgzZGMwMDUtMDZiZC00N2MyLWI2M2EtZDdlYWUxNzM1Y2Y1","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":null,"Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181298318451284.OGQzMDUwNjgtN2FlMy00MGYxLThmZDAtNWJmMjQwZjRmNjg1NzgzZGMwMDUtMDZiZC00N2MyLWI2M2EtZDdlYWUxNzM1Y2Y1","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoS5acSEZxfNu46YpoCgAwb1vVez0zSN8QsgtE4aPTwE2RNzFqa5uyWirmt8Nq3h82y1U2G1i1nw-1IOKY2sSCk3dDrxyXFPPRW2sSo9-ms8h8sbDt0JwiOI9n3wJ5qCxHLuCrJGQVQjCfztSRNgydBcaBk9XvsSg9I1pkMCQm1OlLqHuQIc6ElcdBfS11bm__iOH1MubXGC7Ht-6Dx7OCzpVyzlEl5i_pjodidbkprQUROa7Ucu38_4CHMGsX7TU-23p98kLEir46i6wW7201h4rJEvuoLtwZjSZm6lxBIRZkHwwqLNYLSrste-oPTKUw","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:30:31.892 +08:00 [INF] Showing login: User is not authenticated
2020-02-24 16:30:31.899 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:30:31.902 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:31.902 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:31.902 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:30:31.902 +08:00 [DBG] No PKCE used.
2020-02-24 16:30:31.903 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:31.906 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:31.907 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:31.910 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:31.910 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:30:31.913 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:31.913 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:33.828 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:30:33.831 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:33.831 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:33.831 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:30:33.831 +08:00 [DBG] No PKCE used.
2020-02-24 16:30:33.832 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:33.835 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:33.836 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:33.838 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:33.838 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:30:33.841 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:33.841 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:36.183 +08:00 [DBG] CORS request made for path: /Account/Login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2020-02-24 16:30:36.198 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:30:36.201 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:36.201 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:36.201 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:30:36.201 +08:00 [DBG] No PKCE used.
2020-02-24 16:30:36.202 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:36.205 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:36.206 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:36.208 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:36.208 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:30:36.237 +08:00 [DBG] Augmenting SignInContext
2020-02-24 16:30:36.238 +08:00 [DBG] Adding idp claim with value: local
2020-02-24 16:30:36.238 +08:00 [DBG] Adding amr claim with value: pwd
2020-02-24 16:30:36.238 +08:00 [DBG] Adding auth_time claim with value: 1582533036
2020-02-24 16:30:36.240 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2020-02-24 16:30:36.243 +08:00 [INF] {"Username":"alice","Provider":null,"ProviderUserId":null,"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","DisplayName":"alice","Endpoint":"UI","ClientId":null,"Category":"Authentication","Name":"User Login Success","EventType":"Success","Id":1000,"Message":null,"ActivityId":"0HLTP0BSCONTM:00000008","TimeStamp":"2020-02-24T08:30:36.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"UserLoginSuccessEvent"}
2020-02-24 16:30:36.245 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:36.245 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:36.261 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2020-02-24 16:30:36.262 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2020-02-24 16:30:36.263 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2020-02-24 16:30:36.263 +08:00 [DBG] Start authorize callback request
2020-02-24 16:30:36.263 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:30:36.263 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:30:36.266 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:36.266 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:36.266 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:30:36.266 +08:00 [DBG] No PKCE used.
2020-02-24 16:30:36.267 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:36.270 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:36.271 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:36.274 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:36.274 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:30:36.274 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoS5acSEZxfNu46YpoCgAwb1vVez0zSN8QsgtE4aPTwE2RNzFqa5uyWirmt8Nq3h82y1U2G1i1nw-1IOKY2sSCk3dDrxyXFPPRW2sSo9-ms8h8sbDt0JwiOI9n3wJ5qCxHLuCrJGQVQjCfztSRNgydBcaBk9XvsSg9I1pkMCQm1OlLqHuQIc6ElcdBfS11bm__iOH1MubXGC7Ht-6Dx7OCzpVyzlEl5i_pjodidbkprQUROa7Ucu38_4CHMGsX7TU-23p98kLEir46i6wW7201h4rJEvuoLtwZjSZm6lxBIRZkHwwqLNYLSrste-oPTKUw","UiLocales":null,"Nonce":"637181298318451284.OGQzMDUwNjgtN2FlMy00MGYxLThmZDAtNWJmMjQwZjRmNjg1NzgzZGMwMDUtMDZiZC00N2MyLWI2M2EtZDdlYWUxNzM1Y2Y1","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"29428208f81b00982aff9ad7acb1f3ee","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181298318451284.OGQzMDUwNjgtN2FlMy00MGYxLThmZDAtNWJmMjQwZjRmNjg1NzgzZGMwMDUtMDZiZC00N2MyLWI2M2EtZDdlYWUxNzM1Y2Y1","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoS5acSEZxfNu46YpoCgAwb1vVez0zSN8QsgtE4aPTwE2RNzFqa5uyWirmt8Nq3h82y1U2G1i1nw-1IOKY2sSCk3dDrxyXFPPRW2sSo9-ms8h8sbDt0JwiOI9n3wJ5qCxHLuCrJGQVQjCfztSRNgydBcaBk9XvsSg9I1pkMCQm1OlLqHuQIc6ElcdBfS11bm__iOH1MubXGC7Ht-6Dx7OCzpVyzlEl5i_pjodidbkprQUROa7Ucu38_4CHMGsX7TU-23p98kLEir46i6wW7201h4rJEvuoLtwZjSZm6lxBIRZkHwwqLNYLSrste-oPTKUw","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:30:36.275 +08:00 [DBG] Scopes contains offline_access, consent is required
2020-02-24 16:30:36.275 +08:00 [INF] Showing consent: User has not yet consented
2020-02-24 16:30:36.282 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:30:36.285 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:36.286 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:36.286 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:30:36.286 +08:00 [DBG] No PKCE used.
2020-02-24 16:30:36.287 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:36.289 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:36.291 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:36.293 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:36.293 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:30:36.295 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:36.295 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:36.297 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:36.299 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:39.049 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2020-02-24 16:30:39.051 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:30:39.055 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:39.055 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:39.055 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:30:39.055 +08:00 [DBG] No PKCE used.
2020-02-24 16:30:39.057 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:39.059 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:39.060 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:39.061 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:39.061 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:30:39.062 +08:00 [INF] {"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLTP0BSCONTL:00000009","TimeStamp":"2020-02-24T08:30:39.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2020-02-24 16:30:39.064 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:39.064 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:39.070 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2020-02-24 16:30:39.071 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2020-02-24 16:30:39.071 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2020-02-24 16:30:39.071 +08:00 [DBG] Start authorize callback request
2020-02-24 16:30:39.072 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:30:39.072 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:30:39.075 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:39.075 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:39.075 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:30:39.075 +08:00 [DBG] No PKCE used.
2020-02-24 16:30:39.076 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:39.078 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:39.079 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:39.081 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:39.081 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:30:39.081 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","AllowedRedirectUris":["http://localhost:5002/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoS5acSEZxfNu46YpoCgAwb1vVez0zSN8QsgtE4aPTwE2RNzFqa5uyWirmt8Nq3h82y1U2G1i1nw-1IOKY2sSCk3dDrxyXFPPRW2sSo9-ms8h8sbDt0JwiOI9n3wJ5qCxHLuCrJGQVQjCfztSRNgydBcaBk9XvsSg9I1pkMCQm1OlLqHuQIc6ElcdBfS11bm__iOH1MubXGC7Ht-6Dx7OCzpVyzlEl5i_pjodidbkprQUROa7Ucu38_4CHMGsX7TU-23p98kLEir46i6wW7201h4rJEvuoLtwZjSZm6lxBIRZkHwwqLNYLSrste-oPTKUw","UiLocales":null,"Nonce":"637181298318451284.OGQzMDUwNjgtN2FlMy00MGYxLThmZDAtNWJmMjQwZjRmNjg1NzgzZGMwMDUtMDZiZC00N2MyLWI2M2EtZDdlYWUxNzM1Y2Y1","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"29428208f81b00982aff9ad7acb1f3ee","Raw":{"client_id":"mvc","redirect_uri":"http://localhost:5002/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181298318451284.OGQzMDUwNjgtN2FlMy00MGYxLThmZDAtNWJmMjQwZjRmNjg1NzgzZGMwMDUtMDZiZC00N2MyLWI2M2EtZDdlYWUxNzM1Y2Y1","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoS5acSEZxfNu46YpoCgAwb1vVez0zSN8QsgtE4aPTwE2RNzFqa5uyWirmt8Nq3h82y1U2G1i1nw-1IOKY2sSCk3dDrxyXFPPRW2sSo9-ms8h8sbDt0JwiOI9n3wJ5qCxHLuCrJGQVQjCfztSRNgydBcaBk9XvsSg9I1pkMCQm1OlLqHuQIc6ElcdBfS11bm__iOH1MubXGC7Ht-6Dx7OCzpVyzlEl5i_pjodidbkprQUROa7Ucu38_4CHMGsX7TU-23p98kLEir46i6wW7201h4rJEvuoLtwZjSZm6lxBIRZkHwwqLNYLSrste-oPTKUw","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:30:39.083 +08:00 [DBG] Scopes contains offline_access, consent is required
2020-02-24 16:30:39.083 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2020-02-24 16:30:39.083 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2020-02-24 16:30:39.083 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:30:39.084 +08:00 [DBG] /8kaAjT/h9Y79NVOTTGYA5yPjxRltlmhK7ZhfQVAVf4= found in database
2020-02-24 16:30:39.090 +08:00 [DBG] Creating Hybrid Flow response.
2020-02-24 16:30:39.091 +08:00 [DBG] 17A2TLZXY+p7uzXf6l1fJnymDRGSLNd2Us3HgLEcHNk= not found in database
2020-02-24 16:30:39.092 +08:00 [DBG] Creating Implicit Flow response.
2020-02-24 16:30:39.092 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc
2020-02-24 16:30:39.092 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2020-02-24 16:30:39.096 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":"http://localhost:5002/signin-oidc","Endpoint":"Authorize","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****W_og","$type":"Token"},{"TokenType":"code","TokenValue":"****7232","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLTP0BSCONTM:0000000B","TimeStamp":"2020-02-24T08:30:39.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2020-02-24 16:30:39.096 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc","RedirectUri":"http://localhost:5002/signin-oidc","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoS5acSEZxfNu46YpoCgAwb1vVez0zSN8QsgtE4aPTwE2RNzFqa5uyWirmt8Nq3h82y1U2G1i1nw-1IOKY2sSCk3dDrxyXFPPRW2sSo9-ms8h8sbDt0JwiOI9n3wJ5qCxHLuCrJGQVQjCfztSRNgydBcaBk9XvsSg9I1pkMCQm1OlLqHuQIc6ElcdBfS11bm__iOH1MubXGC7Ht-6Dx7OCzpVyzlEl5i_pjodidbkprQUROa7Ucu38_4CHMGsX7TU-23p98kLEir46i6wW7201h4rJEvuoLtwZjSZm6lxBIRZkHwwqLNYLSrste-oPTKUw","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2020-02-24 16:30:39.096 +08:00 [DBG] Augmenting SignInContext
2020-02-24 16:30:39.096 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2020-02-24 16:30:39.274 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2020-02-24 16:30:39.274 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2020-02-24 16:30:39.274 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2020-02-24 16:30:39.274 +08:00 [DBG] Start token request.
2020-02-24 16:30:39.274 +08:00 [DBG] Start client validation
2020-02-24 16:30:39.274 +08:00 [DBG] Start parsing Basic Authentication secret
2020-02-24 16:30:39.274 +08:00 [DBG] Start parsing for secret in post body
2020-02-24 16:30:39.275 +08:00 [DBG] Parser found secret: PostBodySecretParser
2020-02-24 16:30:39.275 +08:00 [DBG] Secret id found: mvc
2020-02-24 16:30:39.278 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:39.278 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:39.278 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2020-02-24 16:30:39.278 +08:00 [DBG] Client validation success
2020-02-24 16:30:39.278 +08:00 [INF] {"ClientId":"mvc","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLTP0BSCONTJ:0000000E","TimeStamp":"2020-02-24T08:30:39.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2020-02-24 16:30:39.278 +08:00 [DBG] Start token request validation
2020-02-24 16:30:39.278 +08:00 [DBG] Start validation of authorization code token request
2020-02-24 16:30:39.279 +08:00 [DBG] 17A2TLZXY+p7uzXf6l1fJnymDRGSLNd2Us3HgLEcHNk= found in database: true
2020-02-24 16:30:39.279 +08:00 [DBG] removing 17A2TLZXY+p7uzXf6l1fJnymDRGSLNd2Us3HgLEcHNk= persisted grant from database
2020-02-24 16:30:39.282 +08:00 [DBG] Validation of authorization code token request success
2020-02-24 16:30:39.282 +08:00 [INF] Token request validation success, {"ClientId":"mvc","ClientName":"MVC Client","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"91be3ff45298230a0445128f2a1e28bcaaf0816227596a8d76d538b3da327232","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc","client_secret":"***REDACTED***","code":"91be3ff45298230a0445128f2a1e28bcaaf0816227596a8d76d538b3da327232","grant_type":"authorization_code","redirect_uri":"http://localhost:5002/signin-oidc"},"$type":"TokenRequestValidationLog"}
2020-02-24 16:30:39.286 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:39.286 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:39.287 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:39.290 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:39.290 +08:00 [DBG] Getting claims for access token for client: mvc
2020-02-24 16:30:39.290 +08:00 [DBG] Getting claims for access token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:30:39.294 +08:00 [DBG] Creating refresh token
2020-02-24 16:30:39.294 +08:00 [DBG] Setting an absolute lifetime: 2592000
2020-02-24 16:30:39.295 +08:00 [DBG] vaqkZVMevHQhO09NPm8/z9IgZaPcRT5NRKuLER+ei68= not found in database
2020-02-24 16:30:39.299 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:39.299 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:39.300 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:39.303 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:30:39.303 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc
2020-02-24 16:30:39.303 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2020-02-24 16:30:39.307 +08:00 [INF] {"ClientId":"mvc","ClientName":"MVC Client","RedirectUri":null,"Endpoint":"Token","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****sQGg","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****cf40","$type":"Token"},{"TokenType":"access_token","TokenValue":"****GS5A","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLTP0BSCONTJ:0000000E","TimeStamp":"2020-02-24T08:30:39.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2020-02-24 16:30:39.307 +08:00 [DBG] Token request success.
2020-02-24 16:30:39.318 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2020-02-24 16:30:39.318 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2020-02-24 16:30:39.318 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2020-02-24 16:30:39.318 +08:00 [DBG] Start userinfo request
2020-02-24 16:30:39.318 +08:00 [DBG] Bearer token found in header
2020-02-24 16:30:39.324 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:39.324 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:39.327 +08:00 [DBG] mvc found in database: true
2020-02-24 16:30:39.327 +08:00 [DBG] client configuration validation for client mvc succeeded.
2020-02-24 16:30:39.328 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2020-02-24 16:30:39.328 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1582533039,"exp":1582536639,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc","sub":"c8661ec6-8a4f-44e3-bf1d-031a19934320","auth_time":1582533036,"idp":"local","role":["zero.tenantRole1:3d0a1642-c2e1-4031-96a9-4fc651c245c1","zero.Admin"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2020-02-24 16:30:39.329 +08:00 [DBG] Creating userinfo response
2020-02-24 16:30:39.329 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:30:39.329 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:30:39.330 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:39.330 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2020-02-24 16:30:39.330 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:30:39.331 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:30:39.333 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2020-02-24 16:30:39.333 +08:00 [DBG] End userinfo request
2020-02-24 16:31:02.379 +08:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2020-02-24 16:31:02.380 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2020-02-24 16:31:02.380 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2020-02-24 16:31:02.380 +08:00 [DBG] Start authorize request
2020-02-24 16:31:02.380 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:31:02.380 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:31:02.409 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:02.409 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:02.409 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:31:02.409 +08:00 [DBG] No PKCE used.
2020-02-24 16:31:02.411 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:02.413 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:02.415 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:02.417 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:02.417 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:31:02.417 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc2","ClientName":"MVC Client2","RedirectUri":"http://localhost:5003/signin-oidc","AllowedRedirectUris":["http://localhost:5003/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoJAVDIGKFmZX0AYMoVQJnd-LAc-P3oagbCBZQ5nyle8brz7irI7wTcdASLY5rXEyEVJnvLDqMoXy5uu6kT6SsI89CW4ivWI8SQ8MM9468nr_XFvwM54YAtxHanjpOf6pn79BDp-j0rmfTjKf5Ja7S7zYohlt-HwoutaB0moOXNzmlxzdpnFqs86tkuhzQmPfbeL_h2cNLftosf89nHyBWT9QnCiPYht6oS7fb58FIxgbirpHrlbK-_NbxgSTmGDGcEk3Jw1D3bdEfKnJoS2JVLf4H3Mbnu4BVCCzWhC9VWvtJRWhaapJY7ORRLw8XZrvk","UiLocales":null,"Nonce":"637181298623705242.ZmQ4YmU5MzItNTgwOC00NWM0LWEyOGQtYjU0MmU3YTNlOTUwNmMxOTZmMjQtOGNlYi00Nzk1LWI4MzAtMTMxYzg3OWJlNzJi","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"29428208f81b00982aff9ad7acb1f3ee","Raw":{"client_id":"mvc2","redirect_uri":"http://localhost:5003/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181298623705242.ZmQ4YmU5MzItNTgwOC00NWM0LWEyOGQtYjU0MmU3YTNlOTUwNmMxOTZmMjQtOGNlYi00Nzk1LWI4MzAtMTMxYzg3OWJlNzJi","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoJAVDIGKFmZX0AYMoVQJnd-LAc-P3oagbCBZQ5nyle8brz7irI7wTcdASLY5rXEyEVJnvLDqMoXy5uu6kT6SsI89CW4ivWI8SQ8MM9468nr_XFvwM54YAtxHanjpOf6pn79BDp-j0rmfTjKf5Ja7S7zYohlt-HwoutaB0moOXNzmlxzdpnFqs86tkuhzQmPfbeL_h2cNLftosf89nHyBWT9QnCiPYht6oS7fb58FIxgbirpHrlbK-_NbxgSTmGDGcEk3Jw1D3bdEfKnJoS2JVLf4H3Mbnu4BVCCzWhC9VWvtJRWhaapJY7ORRLw8XZrvk","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:31:02.418 +08:00 [DBG] Scopes contains offline_access, consent is required
2020-02-24 16:31:02.418 +08:00 [INF] Showing consent: User has not yet consented
2020-02-24 16:31:02.426 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:31:02.429 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:02.429 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:02.429 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:31:02.429 +08:00 [DBG] No PKCE used.
2020-02-24 16:31:02.430 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:02.432 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:02.433 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:02.435 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:02.435 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:31:02.437 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:02.437 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:02.438 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:02.440 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:29.043 +08:00 [DBG] CORS request made for path: /Consent from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2020-02-24 16:31:29.045 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:31:29.049 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:29.049 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:29.049 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:31:29.049 +08:00 [DBG] No PKCE used.
2020-02-24 16:31:29.050 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:29.052 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:29.053 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:29.055 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:29.055 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:31:29.055 +08:00 [INF] {"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc2","RequestedScopes":["openid","profile","api1","api2","offline_access","role"],"GrantedScopes":["openid","profile","role","api1","api2","offline_access"],"ConsentRemembered":true,"Category":"Grants","Name":"Consent granted","EventType":"Information","Id":4000,"Message":null,"ActivityId":"0HLTP0BSCONTM:0000000E","TimeStamp":"2020-02-24T08:31:29.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"ConsentGrantedEvent"}
2020-02-24 16:31:29.057 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:29.058 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:29.064 +08:00 [DBG] Request path /connect/authorize/callback matched to endpoint type Authorize
2020-02-24 16:31:29.064 +08:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint
2020-02-24 16:31:29.065 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeCallbackEndpoint for /connect/authorize/callback
2020-02-24 16:31:29.065 +08:00 [DBG] Start authorize callback request
2020-02-24 16:31:29.065 +08:00 [DBG] User in authorize request: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:31:29.065 +08:00 [DBG] Start authorize request protocol validation
2020-02-24 16:31:29.068 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:29.068 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:29.068 +08:00 [DBG] Checking for PKCE parameters
2020-02-24 16:31:29.068 +08:00 [DBG] No PKCE used.
2020-02-24 16:31:29.069 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:29.071 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:29.072 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:29.074 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:29.074 +08:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2020-02-24 16:31:29.074 +08:00 [DBG] ValidatedAuthorizeRequest
{"ClientId":"mvc2","ClientName":"MVC Client2","RedirectUri":"http://localhost:5003/signin-oidc","AllowedRedirectUris":["http://localhost:5003/signin-oidc"],"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ResponseType":"code id_token","ResponseMode":"form_post","GrantType":"hybrid","RequestedScopes":"openid profile api1 api2 offline_access role","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoJAVDIGKFmZX0AYMoVQJnd-LAc-P3oagbCBZQ5nyle8brz7irI7wTcdASLY5rXEyEVJnvLDqMoXy5uu6kT6SsI89CW4ivWI8SQ8MM9468nr_XFvwM54YAtxHanjpOf6pn79BDp-j0rmfTjKf5Ja7S7zYohlt-HwoutaB0moOXNzmlxzdpnFqs86tkuhzQmPfbeL_h2cNLftosf89nHyBWT9QnCiPYht6oS7fb58FIxgbirpHrlbK-_NbxgSTmGDGcEk3Jw1D3bdEfKnJoS2JVLf4H3Mbnu4BVCCzWhC9VWvtJRWhaapJY7ORRLw8XZrvk","UiLocales":null,"Nonce":"637181298623705242.ZmQ4YmU5MzItNTgwOC00NWM0LWEyOGQtYjU0MmU3YTNlOTUwNmMxOTZmMjQtOGNlYi00Nzk1LWI4MzAtMTMxYzg3OWJlNzJi","AuthenticationContextReferenceClasses":null,"DisplayMode":null,"PromptMode":null,"MaxAge":null,"LoginHint":null,"SessionId":"29428208f81b00982aff9ad7acb1f3ee","Raw":{"client_id":"mvc2","redirect_uri":"http://localhost:5003/signin-oidc","response_type":"code id_token","scope":"openid profile api1 api2 offline_access role","response_mode":"form_post","nonce":"637181298623705242.ZmQ4YmU5MzItNTgwOC00NWM0LWEyOGQtYjU0MmU3YTNlOTUwNmMxOTZmMjQtOGNlYi00Nzk1LWI4MzAtMTMxYzg3OWJlNzJi","state":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoJAVDIGKFmZX0AYMoVQJnd-LAc-P3oagbCBZQ5nyle8brz7irI7wTcdASLY5rXEyEVJnvLDqMoXy5uu6kT6SsI89CW4ivWI8SQ8MM9468nr_XFvwM54YAtxHanjpOf6pn79BDp-j0rmfTjKf5Ja7S7zYohlt-HwoutaB0moOXNzmlxzdpnFqs86tkuhzQmPfbeL_h2cNLftosf89nHyBWT9QnCiPYht6oS7fb58FIxgbirpHrlbK-_NbxgSTmGDGcEk3Jw1D3bdEfKnJoS2JVLf4H3Mbnu4BVCCzWhC9VWvtJRWhaapJY7ORRLw8XZrvk","x-client-SKU":"ID_NETSTANDARD2_0","x-client-ver":"5.3.0.0"},"$type":"AuthorizeRequestValidationLog"}
2020-02-24 16:31:29.075 +08:00 [DBG] Scopes contains offline_access, consent is required
2020-02-24 16:31:29.075 +08:00 [INF] User consented to scopes: ["openid","profile","role","api1","api2","offline_access"]
2020-02-24 16:31:29.076 +08:00 [DBG] User indicated to remember consent for scopes: ["openid","profile","role","api1","api2","offline_access"]
2020-02-24 16:31:29.076 +08:00 [DBG] Client allows remembering consent, and consent given. Updating consent store for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:31:29.076 +08:00 [DBG] skXvHI6WvJVHy+U6EB1r6kagoJfqzmsa/tD642vA4No= found in database
2020-02-24 16:31:29.077 +08:00 [DBG] Creating Hybrid Flow response.
2020-02-24 16:31:29.078 +08:00 [DBG] icNZuD2r5uvD8RqhztCYUkOyMq4s5805aLavgx6YVaI= not found in database
2020-02-24 16:31:29.079 +08:00 [DBG] Creating Implicit Flow response.
2020-02-24 16:31:29.079 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc2
2020-02-24 16:31:29.079 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2020-02-24 16:31:29.083 +08:00 [INF] {"ClientId":"mvc2","ClientName":"MVC Client2","RedirectUri":"http://localhost:5003/signin-oidc","Endpoint":"Authorize","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"hybrid","Tokens":[{"TokenType":"id_token","TokenValue":"****5qyQ","$type":"Token"},{"TokenType":"code","TokenValue":"****e598","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLTP0BSCONTK:0000000C","TimeStamp":"2020-02-24T08:31:29.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2020-02-24 16:31:29.083 +08:00 [DBG] Authorize endpoint response
{"SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","ClientId":"mvc2","RedirectUri":"http://localhost:5003/signin-oidc","State":"CfDJ8NVaDxLWcuxGuKDlCOFkCvoJAVDIGKFmZX0AYMoVQJnd-LAc-P3oagbCBZQ5nyle8brz7irI7wTcdASLY5rXEyEVJnvLDqMoXy5uu6kT6SsI89CW4ivWI8SQ8MM9468nr_XFvwM54YAtxHanjpOf6pn79BDp-j0rmfTjKf5Ja7S7zYohlt-HwoutaB0moOXNzmlxzdpnFqs86tkuhzQmPfbeL_h2cNLftosf89nHyBWT9QnCiPYht6oS7fb58FIxgbirpHrlbK-_NbxgSTmGDGcEk3Jw1D3bdEfKnJoS2JVLf4H3Mbnu4BVCCzWhC9VWvtJRWhaapJY7ORRLw8XZrvk","Scope":"openid profile role api1 api2 offline_access","Error":null,"ErrorDescription":null,"$type":"AuthorizeResponseLog"}
2020-02-24 16:31:29.084 +08:00 [DBG] Augmenting SignInContext
2020-02-24 16:31:29.084 +08:00 [INF] AuthenticationScheme: Identity.Application signed in.
2020-02-24 16:31:29.263 +08:00 [DBG] Request path /connect/token matched to endpoint type Token
2020-02-24 16:31:29.263 +08:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2020-02-24 16:31:29.263 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2020-02-24 16:31:29.263 +08:00 [DBG] Start token request.
2020-02-24 16:31:29.263 +08:00 [DBG] Start client validation
2020-02-24 16:31:29.263 +08:00 [DBG] Start parsing Basic Authentication secret
2020-02-24 16:31:29.263 +08:00 [DBG] Start parsing for secret in post body
2020-02-24 16:31:29.263 +08:00 [DBG] Parser found secret: PostBodySecretParser
2020-02-24 16:31:29.263 +08:00 [DBG] Secret id found: mvc2
2020-02-24 16:31:29.266 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:29.266 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:29.266 +08:00 [DBG] Secret validator success: HashedSharedSecretValidator
2020-02-24 16:31:29.266 +08:00 [DBG] Client validation success
2020-02-24 16:31:29.266 +08:00 [INF] {"ClientId":"mvc2","AuthenticationMethod":"SharedSecret","Category":"Authentication","Name":"Client Authentication Success","EventType":"Success","Id":1010,"Message":null,"ActivityId":"0HLTP0BSCONTL:0000000D","TimeStamp":"2020-02-24T08:31:29.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"ClientAuthenticationSuccessEvent"}
2020-02-24 16:31:29.266 +08:00 [DBG] Start token request validation
2020-02-24 16:31:29.266 +08:00 [DBG] Start validation of authorization code token request
2020-02-24 16:31:29.267 +08:00 [DBG] icNZuD2r5uvD8RqhztCYUkOyMq4s5805aLavgx6YVaI= found in database: true
2020-02-24 16:31:29.267 +08:00 [DBG] removing icNZuD2r5uvD8RqhztCYUkOyMq4s5805aLavgx6YVaI= persisted grant from database
2020-02-24 16:31:29.270 +08:00 [DBG] Validation of authorization code token request success
2020-02-24 16:31:29.270 +08:00 [INF] Token request validation success, {"ClientId":"mvc2","ClientName":"MVC Client2","GrantType":"authorization_code","Scopes":null,"AuthorizationCode":"4aa2ff642cdd925a3b6daf60ba06b6e4a59b64cfdd7d5aaa5d09e4064182e598","RefreshToken":null,"UserName":null,"AuthenticationContextReferenceClasses":null,"Tenant":null,"IdP":null,"Raw":{"client_id":"mvc2","client_secret":"***REDACTED***","code":"4aa2ff642cdd925a3b6daf60ba06b6e4a59b64cfdd7d5aaa5d09e4064182e598","grant_type":"authorization_code","redirect_uri":"http://localhost:5003/signin-oidc"},"$type":"TokenRequestValidationLog"}
2020-02-24 16:31:29.272 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:29.272 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:29.274 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:29.276 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:29.276 +08:00 [DBG] Getting claims for access token for client: mvc2
2020-02-24 16:31:29.276 +08:00 [DBG] Getting claims for access token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320
2020-02-24 16:31:29.280 +08:00 [DBG] Creating refresh token
2020-02-24 16:31:29.280 +08:00 [DBG] Setting an absolute lifetime: 2592000
2020-02-24 16:31:29.280 +08:00 [DBG] SG9WoJI4F+q4gv9e2yp5gTUHzmzuBSeTFb3HbxjSwKg= not found in database
2020-02-24 16:31:29.283 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:29.283 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:29.284 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:29.286 +08:00 [DBG] Found ["api1","api2","apiall"] API scopes in database
2020-02-24 16:31:29.286 +08:00 [DBG] Getting claims for identity token for subject: c8661ec6-8a4f-44e3-bf1d-031a19934320 and client: mvc2
2020-02-24 16:31:29.286 +08:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2020-02-24 16:31:29.289 +08:00 [INF] {"ClientId":"mvc2","ClientName":"MVC Client2","RedirectUri":null,"Endpoint":"Token","SubjectId":"c8661ec6-8a4f-44e3-bf1d-031a19934320","Scopes":"openid profile role api1 api2 offline_access","GrantType":"authorization_code","Tokens":[{"TokenType":"id_token","TokenValue":"****6XEQ","$type":"Token"},{"TokenType":"refresh_token","TokenValue":"****5d96","$type":"Token"},{"TokenType":"access_token","TokenValue":"****BAyA","$type":"Token"}],"Category":"Token","Name":"Token Issued Success","EventType":"Success","Id":2000,"Message":null,"ActivityId":"0HLTP0BSCONTL:0000000D","TimeStamp":"2020-02-24T08:31:29.0000000Z","ProcessId":21436,"LocalIpAddress":"127.0.0.1:44339","RemoteIpAddress":"::1","$type":"TokenIssuedSuccessEvent"}
2020-02-24 16:31:29.289 +08:00 [DBG] Token request success.
2020-02-24 16:31:29.295 +08:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2020-02-24 16:31:29.295 +08:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2020-02-24 16:31:29.295 +08:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2020-02-24 16:31:29.295 +08:00 [DBG] Start userinfo request
2020-02-24 16:31:29.295 +08:00 [DBG] Bearer token found in header
2020-02-24 16:31:29.300 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:29.301 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:29.303 +08:00 [DBG] mvc2 found in database: true
2020-02-24 16:31:29.303 +08:00 [DBG] client configuration validation for client mvc2 succeeded.
2020-02-24 16:31:29.304 +08:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2020-02-24 16:31:29.304 +08:00 [DBG] Token validation success
{"ClientId":null,"ClientName":null,"ValidateLifetime":true,"AccessTokenType":"Jwt","ExpectedScope":"openid","TokenHandle":null,"JwtId":null,"Claims":{"nbf":1582533089,"exp":1582536689,"iss":"http://localhost:5000","aud":["http://localhost:5000/resources","api1"],"client_id":"mvc2","sub":"c8661ec6-8a4f-44e3-bf1d-031a19934320","auth_time":1582533036,"idp":"local","role":["zero.tenantRole1:3d0a1642-c2e1-4031-96a9-4fc651c245c1","zero.Admin"],"scope":["openid","profile","role","api1","api2","offline_access"],"amr":"pwd"},"$type":"TokenValidationLog"}
2020-02-24 16:31:29.304 +08:00 [DBG] Creating userinfo response
2020-02-24 16:31:29.304 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:31:29.304 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:31:29.305 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:29.305 +08:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at role
2020-02-24 16:31:29.305 +08:00 [DBG] Scopes in access token: openid profile role api1 api2 offline_access
2020-02-24 16:31:29.306 +08:00 [DBG] Found ["openid","profile","role"] identity scopes in database
2020-02-24 16:31:29.308 +08:00 [INF] Profile service returned the following claim types: sub name given_name family_name website role role preferred_username
2020-02-24 16:31:29.308 +08:00 [DBG] End userinfo request
